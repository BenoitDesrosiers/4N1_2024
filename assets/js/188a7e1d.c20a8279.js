"use strict";(self.webpackChunknotes_de_cours_4_n_1_2024=self.webpackChunknotes_de_cours_4_n_1_2024||[]).push([[4628],{8429:(e,r,i)=>{i.r(r),i.d(r,{assets:()=>o,contentTitle:()=>t,default:()=>u,frontMatter:()=>a,metadata:()=>l,toc:()=>d});var n=i(5893),s=i(1151);const a={sidebar_position:350,draft:!1},t="Localisation du code .cs",l={id:"WPF partie 3/localisation",title:"Localisation du code .cs",description:"Pr\xe9c\xe9demment, nous avons fait la localisation du code de la partie xaml des vues. Nous allons maintenant faire la localisation du code dans les fichiers .cs des vues. Pour faire la localisation dans le code, il faut utiliser la librairie de localisation de .NET.",source:"@site/docs/74-WPF partie 3/localisation.md",sourceDirName:"74-WPF partie 3",slug:"/WPF partie 3/localisation",permalink:"/4N1_2024/docs/WPF partie 3/localisation",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:350,frontMatter:{sidebar_position:350,draft:!1},sidebar:"NotesSidebar",previous:{title:"Validation",permalink:"/4N1_2024/docs/WPF partie 3/validation"},next:{title:"Gestion d'un utilisateur",permalink:"/4N1_2024/docs/WPF partie 3/utilisateur"}},o={},d=[{value:"Installation de la librairie",id:"installation-de-la-librairie",level:2},{value:"Enregistrement du service - App.xaml.cs",id:"enregistrement-du-service---appxamlcs",level:2},{value:"Cr\xe9ation du fichier ressource - ResCategorieValidateur",id:"cr\xe9ation-du-fichier-ressource---rescategorievalidateur",level:2},{value:"Injection du IStringLocalizer - CategorieValidateur",id:"injection-du-istringlocalizer---categorievalidateur",level:2}];function c(e){const r={admonition:"admonition",code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.h1,{id:"localisation-du-code-cs",children:"Localisation du code .cs"}),"\n",(0,n.jsxs)(r.p,{children:["Pr\xe9c\xe9demment, nous avons fait la localisation du code de la partie ",(0,n.jsx)(r.strong,{children:"xaml"})," des vues. Nous allons maintenant faire la localisation du code dans les fichiers ",(0,n.jsx)(r.strong,{children:".cs"})," des vues. Pour faire la localisation dans le code, il faut utiliser la librairie de localisation de ",(0,n.jsx)(r.strong,{children:".NET"}),"."]}),"\n",(0,n.jsxs)(r.p,{children:["Cette librairie donne acc\xe8s \xe0 la classe ",(0,n.jsx)(r.strong,{children:"IStringLocalizer<T>"})," qu'il est possible d'injecter dans une classe."]}),"\n",(0,n.jsxs)(r.p,{children:["Il faut \xe9galement utiliser les fichiers ressources avec cette technique. Le type g\xe9n\xe9rique du ",(0,n.jsx)(r.strong,{children:"IStringLocalizer<T>"})," correspond au fichier ressource."]}),"\n",(0,n.jsx)(r.p,{children:"Il existe plusieurs visions pour la gestion des fichiers ressources. Il est possible d'en faire un par classe qui l'utilise et d'utiliser des fichiers globaux pour les \xe9l\xe9ments g\xe9n\xe9raux qui sont utilis\xe9s par plusieurs classes."}),"\n",(0,n.jsxs)(r.p,{children:["L'exemple ci-dessous est pour la validation du ",(0,n.jsx)(r.strong,{children:"CategorieModel"}),"."]}),"\n",(0,n.jsx)(r.h2,{id:"installation-de-la-librairie",children:"Installation de la librairie"}),"\n",(0,n.jsxs)(r.p,{children:["Dans la ",(0,n.jsx)(r.strong,{children:"Console du Gestionnaire de package"}),", inscrivez la commande ci-dessous."]}),"\n",(0,n.jsx)(r.admonition,{title:"Important",type:"warning",children:(0,n.jsxs)(r.p,{children:["Il est important que le ",(0,n.jsx)(r.strong,{children:"Projet par d\xe9faut"})," soit ",(0,n.jsx)(r.strong,{children:"SuperCarte.Core"}),"."]})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-csharp",metastring:"showLineNumbers",children:"Install-Package Microsoft.Extensions.Localization\n"})}),"\n",(0,n.jsx)(r.h2,{id:"enregistrement-du-service---appxamlcs",children:"Enregistrement du service - App.xaml.cs"}),"\n",(0,n.jsxs)(r.p,{children:["Dans le fichier ",(0,n.jsx)(r.strong,{children:"App.xaml.cs"}),", il faut enregistrer le service pour la localisation."]}),"\n",(0,n.jsx)(r.p,{children:"Modifiez le constructeur par le code ci-dessous."}),"\n",(0,n.jsxs)(r.p,{children:["L'enregistrement se fait \xe0 la ligne 13. ",(0,n.jsx)(r.strong,{children:"services.AddLocalization();"})]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-csharp",metastring:"showLineNumbers",children:'public App()\r\n{\r\n    //Modification de la langue dans l\'extension et du thread principal\r\n    CultureInfo.DefaultThreadCurrentCulture = new CultureInfo("fr-CA");\r\n    WPFLocalizeExtension.Engine.LocalizeDictionary.Instance.SetCurrentThreadCulture = true;\r\n    WPFLocalizeExtension.Engine.LocalizeDictionary.Instance.Culture = CultureInfo.DefaultThreadCurrentCulture;\r\n    \r\n    var builder = Host.CreateDefaultBuilder();\r\n\r\n    //Enregistrement des services\r\n    builder.ConfigureServices((context, services) =>\r\n    {\r\n        //highlight-next-line\r\n        services.AddLocalization();\r\n        services.AddSingleton<MainWindow>(); //Fen\xeatre principale\r\n\r\n        //Enregistrement du contexte    \r\n        services.AddDbContext<SuperCarteContext>(options => options.UseSqlServer(context.Configuration.GetConnectionString("DefaultConnection")));\r\n\r\n        //Enregistrement des classes d\'assistance\r\n        services.AddSingleton<INavigateur, Navigateur>();\r\n\r\n        //Appel des m\xe9thodes d\'extension                        \r\n        services.EnregistrerRepositories();\r\n        services.EnregistrerServices();\r\n        services.EnregistrerValidateurs();\r\n        services.EnregistrerViewModels();\r\n    });\r\n\r\n    _host = builder.Build();\r\n}\n'})}),"\n",(0,n.jsx)(r.h2,{id:"cr\xe9ation-du-fichier-ressource---rescategorievalidateur",children:"Cr\xe9ation du fichier ressource - ResCategorieValidateur"}),"\n",(0,n.jsxs)(r.p,{children:["Dans le projet ",(0,n.jsx)(r.strong,{children:"SuperCarte.Core"}),", cr\xe9ez un dossier ",(0,n.jsx)(r.strong,{children:"Resx"}),"."]}),"\n",(0,n.jsx)(r.admonition,{type:"tip",children:(0,n.jsxs)(r.p,{children:["Le type ",(0,n.jsx)(r.strong,{children:"fichier de ressources"})," se trouve dans \xc9l\xe9ments C#/G\xe9n\xe9ral"]})}),"\n",(0,n.jsxs)(r.p,{children:["Cr\xe9ez le fichier de ressources ",(0,n.jsx)(r.strong,{children:"ResCategorieValidateur.resx"})," dans le dossier ",(0,n.jsx)(r.strong,{children:"Resx"}),"."]}),"\n",(0,n.jsxs)(r.p,{children:["Lors de l'ouverture de l'\xe9diteur de ressource, il faut changer le ",(0,n.jsx)(r.strong,{children:"Modificateur d'acc\xe8s"})," en haut de l'\xe9diteur afin de mettre le fichier ",(0,n.jsx)(r.strong,{children:"Public"}),". Si le fichier ressource n'est pas ",(0,n.jsx)(r.strong,{children:"Public"}),", il ne sera pas utilisable par le ",(0,n.jsx)(r.strong,{children:"IStringLocalizer"}),"."]}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Nom"}),(0,n.jsx)(r.th,{children:"Valeur"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"Nom_Obligatoire"}),(0,n.jsx)(r.td,{children:"Le nom est obligatoire."})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"Nom_LongueurMax"}),(0,n.jsx)(r.td,{children:"Le nom doit avoir 35 caract\xe8res au maximum."})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"Description_LongueurMax"}),(0,n.jsx)(r.td,{children:"La description doit avoir 50 caract\xe8res au maximum."})]})]})]}),"\n",(0,n.jsxs)(r.p,{children:["Cr\xe9ez le fichier ressource anglais ",(0,n.jsx)(r.strong,{children:"ResCategorieValidateur.en.resx"}),"."]}),"\n",(0,n.jsxs)(r.p,{children:["Pour les fichiers des autres langues, ",(0,n.jsx)(r.strong,{children:"il ne faut pas changer le Modificateur d'acc\xe8s"}),". Il faut le laisser \xe0 ",(0,n.jsx)(r.strong,{children:"Pas de g\xe9n\xe9ration de code"}),"."]}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Nom"}),(0,n.jsx)(r.th,{children:"Valeur"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"Nom_Obligatoire"}),(0,n.jsx)(r.td,{children:"The name is mandatory."})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"Nom_LongueurMax"}),(0,n.jsx)(r.td,{children:"The maximum length for the name is 35 characters."})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:"Description_LongueurMax"}),(0,n.jsx)(r.td,{children:"The maximum length for the description is 50 characters."})]})]})]}),"\n",(0,n.jsx)(r.h2,{id:"injection-du-istringlocalizer---categorievalidateur",children:"Injection du IStringLocalizer - CategorieValidateur"}),"\n",(0,n.jsxs)(r.p,{children:["Le service ",(0,n.jsx)(r.strong,{children:"AddLocalization"})," qui a \xe9t\xe9 ajout\xe9 dans le fichier ",(0,n.jsx)(r.strong,{children:"App.xaml.cs"})," permet d'avoir acc\xe8s au service ",(0,n.jsx)(r.strong,{children:"IStringLocalizer"}),"."]}),"\n",(0,n.jsx)(r.p,{children:"Ce service permet d'avoir acc\xe8s au fichier ressource demand\xe9 en fonction de la culture en cours du programme."}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"IStringLocalizer"})," a besoin d'un type lors de son injection. Le type est le nom du fichier ressource."]}),"\n",(0,n.jsxs)(r.p,{children:["Il faut mettre le ",(0,n.jsx)(r.strong,{children:"IStringLocalizer"})," dans les param\xe8tres du constructeur pour toutes classes qui a besoin d'un acc\xe8s \xe0 des fichiers ressources. Il faut un ",(0,n.jsx)(r.strong,{children:"IStringLocalizer"})," par fichier ressource."]}),"\n",(0,n.jsx)(r.p,{children:"Notez que le texte des validateurs (ex: Le nom est obligatoire) est remplac\xe9 par les valeurs du fichier de ressources. Pour \xeatre en mesure de r\xe9cup\xe9rer une valeur du fichier ressource, il faut sp\xe9cifier le nom de la cl\xe9 dans l'index."}),"\n",(0,n.jsxs)(r.p,{children:["Par exemple, ",(0,n.jsx)(r.strong,{children:'_resCategorieValidateur["Nom_Obligatoire"]'})," permet d'obtenir la valeur de la cl\xe9 ",(0,n.jsx)(r.strong,{children:"Nom_Obligatoire"}),"."]}),"\n",(0,n.jsxs)(r.p,{children:["Modifiez la classe ",(0,n.jsx)(r.strong,{children:"SuperCarte.Core/Validateurs/CategorieValidateur"})," par le code ci-dessous."]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-csharp",metastring:"showLineNumbers",children:'using FluentValidation;\r\nusing FluentValidation.Results;\r\n//highlight-next-line\r\nusing Microsoft.Extensions.Localization;\r\nusing SuperCarte.Core.Extensions;\r\nusing SuperCarte.Core.Models;\r\n//highlight-next-line\r\nusing SuperCarte.Core.Repositories;\r\n//highlight-next-line\r\nusing SuperCarte.Core.Resx;\r\n\r\nnamespace SuperCarte.Core.Validateurs;\r\n\r\n/// <summary>\r\n/// Classe qui valide le mod\xe8le CategorieModel\r\n/// </summary>\r\npublic class CategorieValidateur : AbstractValidator<CategorieModel>, IValidateur<CategorieModel>\r\n{    \r\n    //highlight-next-line\r\n    private readonly IStringLocalizer<ResCategorieValidateur> _resCategorieValidateur;\r\n\r\n//highlight-start\r\n    /// <summary>\r\n    /// Constructeur\r\n    /// </summary>    \r\n    /// <param name="resCategorieValidateur">Fichier ressource ResCategorieValidateur</param>\r\n    public CategorieValidateur(IStringLocalizer<ResCategorieValidateur> resCategorieValidateur)\r\n    {        \r\n        _resCategorieValidateur = resCategorieValidateur;\r\n//highlight-end\r\n\r\n        RuleFor(i => i.Nom).Cascade(CascadeMode.Stop)\r\n        //highlight-next-line\r\n            .Must(ValiderStringObligatoire).WithMessage(_resCategorieValidateur["Nom_Obligatoire"])\r\n        //highlight-next-line\r\n            .MaximumLength(35).WithMessage(_resCategorieValidateur["Nom_LongueurMax"]);\r\n\r\n        RuleFor(i => i.Description).Cascade(CascadeMode.Stop)\r\n        //highlight-next-line\r\n            .MaximumLength(50).WithMessage(_resCategorieValidateur["Description_LongueurMax"]);\r\n    }\r\n\r\n    public async Task<ValidationModel> ValiderAsync(CategorieModel modele)\r\n    {\r\n        ValidationResult validationResult = await base.ValidateAsync(modele);\r\n\r\n        return validationResult.VersValidationModel();\r\n    }\r\n\r\n    /// <summary>\r\n    /// Valider une chaine de caract\xe8re qui est obligatoire\r\n    /// </summary>\r\n    /// <param name="valeur">Chaine \xe0 valider</param>\r\n    /// <returns>Vrai si valide, faux si non valide</returns>\r\n    private bool ValiderStringObligatoire(string valeur)\r\n    {\r\n        return !string.IsNullOrWhiteSpace(valeur);\r\n    }\r\n}\n'})}),"\n",(0,n.jsxs)(r.admonition,{type:"info",children:[(0,n.jsxs)(r.p,{children:["\xc9tant donn\xe9 que l'interface fait aussi une validation de la longueur du champ (rappelez-vous que nous avons ajout\xe9 MaxLenght dans le fichier UcGestionCategorie.xaml ), il est pr\xe9sentement impossible de voir le message d'erreur autre que celui pour le nom obligatoire. Si vous voulez le voir en action, changez ",(0,n.jsx)(r.strong,{children:".MaximumLength"})," pour une valeur plus petite."]}),(0,n.jsx)(r.p,{children:"Il est toujours bon de valider les donn\xe9es \xe0 l'aide d'un validateur m\xeame si l'interface fait aussi une validation. De cette facon, si le responsable de l'interface oublie une validation, l'information erron\xe9e ne se rendra pas \xe0 la bd."})]}),"\n",(0,n.jsx)(r.p,{children:"D\xe9marrez le programme et testez en fran\xe7ais et en anglais la validation."}),"\n",(0,n.jsxs)(r.admonition,{type:"tip",children:[(0,n.jsxs)(r.p,{children:["Pour passer de l'anglais au francais, changez la valeur de ",(0,n.jsx)(r.strong,{children:"CultureInfo"})," dans ",(0,n.jsx)(r.strong,{children:"App.xaml.cs"})]}),(0,n.jsx)(r.p,{children:"en-CA pour l'anglais"}),(0,n.jsx)(r.p,{children:"fr-CA pour le francais."})]})]})}function u(e={}){const{wrapper:r}={...(0,s.a)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},1151:(e,r,i)=>{i.d(r,{Z:()=>l,a:()=>t});var n=i(7294);const s={},a=n.createContext(s);function t(e){const r=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),n.createElement(a.Provider,{value:r},e.children)}}}]);