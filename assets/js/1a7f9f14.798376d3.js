"use strict";(self.webpackChunknotes_de_cours_4_n_1_2024=self.webpackChunknotes_de_cours_4_n_1_2024||[]).push([[833],{8898:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>l,toc:()=>c});var i=r(5893),t=r(1151);const s={sidebar_position:440,draft:!1},a="Message \xe0 l'utilisateur - MessageBox",l={id:"WPF partie 4/msg_utilisateur",title:"Message \xe0 l'utilisateur - MessageBox",description:"Il n'y a aucun message pour indiquer \xe0 l'utilisateur qu'il n'a pas acc\xe8s \xe0 la vue. Elle est non fonctionnelle, mais l'utilisateur peut penser qu'il s'agit d'un bug. Il faut donc l'avertir.",source:"@site/docs/76-WPF partie 4/msg_utilisateur.md",sourceDirName:"76-WPF partie 4",slug:"/WPF partie 4/msg_utilisateur",permalink:"/4N1_2024/docs/WPF partie 4/msg_utilisateur",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:440,frontMatter:{sidebar_position:440,draft:!1},sidebar:"NotesSidebar",previous:{title:"Autorisation",permalink:"/4N1_2024/docs/WPF partie 4/autorisation"},next:{title:"Masquer le menu",permalink:"/4N1_2024/docs/WPF partie 4/masquer_menu"}},o={},c=[{value:"Classe d&#39;assistance - Notification",id:"classe-dassistance---notification",level:2},{value:"Enregistrement de la classe d&#39;assistance - App.xaml.cs",id:"enregistrement-de-la-classe-dassistance---appxamlcs",level:2},{value:"Utilisation dans le ViewModel - ListeCategoriesVM",id:"utilisation-dans-le-viewmodel---listecategoriesvm",level:2}];function u(e){const n={code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,t.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"message-\xe0-lutilisateur---messagebox",children:"Message \xe0 l'utilisateur - MessageBox"}),"\n",(0,i.jsxs)(n.p,{children:["Il n'y a aucun message pour indiquer \xe0 l'utilisateur qu'il n'a pas acc\xe8s \xe0 la vue. Elle est non fonctionnelle, mais l'utilisateur peut penser qu'il s'agit d'un ",(0,i.jsx)(n.strong,{children:"bug"}),". Il faut donc l'avertir."]}),"\n",(0,i.jsxs)(n.p,{children:["En programmation native ",(0,i.jsx)(n.strong,{children:"Windows"}),", le composant ",(0,i.jsx)(n.strong,{children:"MessageBox"})," est l'id\xe9al pour ceci. Ce composant permet de faire un ",(0,i.jsx)(n.strong,{children:"popup"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["La notification doit se faire par le ",(0,i.jsx)(n.strong,{children:"ViewModel"}),". Le ",(0,i.jsx)(n.strong,{children:"ViewModel"})," ne doit pas connaitre la technique utilis\xe9e par la vue. Il faut donc cr\xe9er une classe d'assistance."]}),"\n",(0,i.jsx)(n.h2,{id:"classe-dassistance---notification",children:"Classe d'assistance - Notification"}),"\n",(0,i.jsxs)(n.p,{children:["Cr\xe9ez l'interface ",(0,i.jsx)(n.strong,{children:"INotification"})," dans le dossier ",(0,i.jsx)(n.strong,{children:"Aides"})," du projet ",(0,i.jsx)(n.strong,{children:"SuperCarte.WPF"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",metastring:"showLineNumbers",children:"namespace SuperCarte.WPF.Aides;\r\n\r\n/// <summary>\r\n/// Inteface qui repr\xe9sente la classe d'assistance pour les notifications avec l'utilisateur\r\n/// </summary>\r\npublic interface INotification\r\n{\r\n    /// <summary>\r\n    /// Affiche un message d'erreur \xe0 l'utilisateur\r\n    /// </summary>\r\n    /// <param name=\"titre\">Titre du message</param>\r\n    /// <param name=\"message\">Le message d'erreur</param>\r\n    void MessageErreur(string titre, string message);\r\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Cr\xe9ez la classe ",(0,i.jsx)(n.strong,{children:"Notification"})," dans le dossier ",(0,i.jsx)(n.strong,{children:"Aides"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",metastring:"showLineNumbers",children:"using System.Windows;\r\n\r\nnamespace SuperCarte.WPF.Aides;\r\n\r\n/// <summary>\r\n/// Classe qui repr\xe9sente la classe d'assistance pour les notifications avec l'utilisateur\r\n/// </summary>\r\npublic class Notification : INotification\r\n{\r\n    public void MessageErreur(string titre, string message)\r\n    {\r\n        MessageBox.Show(message, titre, MessageBoxButton.OK, MessageBoxImage.Error);\r\n    }\r\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Le composant ",(0,i.jsx)(n.strong,{children:"MessageBox"})," a besoin d'un titre, du message, du type de bouton et de l'ic\xf4ne."]}),"\n",(0,i.jsxs)(n.p,{children:["Dans ce cas-ci, il y aura uniquement le bouton ",(0,i.jsx)(n.strong,{children:"OK"})," et l'ic\xf4ne sera celle d'une erreur."]}),"\n",(0,i.jsx)(n.h2,{id:"enregistrement-de-la-classe-dassistance---appxamlcs",children:"Enregistrement de la classe d'assistance - App.xaml.cs"}),"\n",(0,i.jsx)(n.p,{children:"Il faut enregistrer la classe d'assistance dans les services."}),"\n",(0,i.jsxs)(n.p,{children:["L'enregistrement se fait directement dans la classe ",(0,i.jsx)(n.strong,{children:"App.xaml.cs"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Voici le nouveau constructeur."}),"\n",(0,i.jsxs)(n.p,{children:["\xc0 la ligne 22, l'enregistrement du ",(0,i.jsx)(n.strong,{children:"Notification"})," est fait avec un singleton. Il faut avoir seulement une instance de cette classe."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",metastring:"showLineNumbers",children:'public App()\r\n{\r\n    //Modification de la langue dans l\'extension et du thread principal\r\n    CultureInfo.DefaultThreadCurrentCulture = new CultureInfo("fr-CA");\r\n    WPFLocalizeExtension.Engine.LocalizeDictionary.Instance.SetCurrentThreadCulture = true;\r\n    WPFLocalizeExtension.Engine.LocalizeDictionary.Instance.Culture = CultureInfo.DefaultThreadCurrentCulture;\r\n    \r\n    var builder = Host.CreateDefaultBuilder();\r\n\r\n    //Enregistrement des services\r\n    builder.ConfigureServices((context, services) =>\r\n    {\r\n        services.AddLocalization();\r\n        services.AddSingleton<MainWindow>(); //Fen\xeatre principale\r\n\r\n        //Enregistrement du contexte    \r\n        services.AddDbContext<SuperCarteContext>(options => options.UseSqlServer(context.Configuration.GetConnectionString("DefaultConnection")));\r\n\r\n        //Enregistrement des classes d\'assistance\r\n        services.AddSingleton<INavigateur, Navigateur>();\r\n        services.AddSingleton<IAuthentificateur, Authentificateur>();\r\n        //highlight-next-line\r\n        services.AddSingleton<INotification, Notification>();\r\n\r\n        //Appel des m\xe9thodes d\'extension                        \r\n        services.EnregistrerRepositories();\r\n        services.EnregistrerServices();\r\n        services.EnregistrerValidateurs();\r\n        services.EnregistrerViewModels();\r\n    });\r\n\r\n    _host = builder.Build();\r\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"utilisation-dans-le-viewmodel---listecategoriesvm",children:"Utilisation dans le ViewModel - ListeCategoriesVM"}),"\n",(0,i.jsxs)(n.p,{children:["Modifiez la classe ",(0,i.jsx)(n.strong,{children:"ListeCategoriesVM"})," par celle-ci."]}),"\n",(0,i.jsxs)(n.p,{children:["Il faut injecter l'interface d'assistance ",(0,i.jsx)(n.strong,{children:"INotification"})," dans le ",(0,i.jsx)(n.strong,{children:"ViewModel"})," (lignes 18, 32 et 36)."]}),"\n",(0,i.jsxs)(n.p,{children:["Ensuite, dans le ",(0,i.jsx)(n.strong,{children:"else"})," de la m\xe9thode ",(0,i.jsx)(n.strong,{children:"EstAutorise()"}),", il faut afficher le message d'erreur (lignes 50, 67 et 88)."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",metastring:"showLineNumbers",children:'using CommunityToolkit.Mvvm.Input;\r\nusing SuperCarte.EF.Data;\r\n\r\nnamespace SuperCarte.WPF.ViewModels;\r\n\r\n/// <summary>\r\n/// ViewModel de la vue ListeCategories\r\n/// </summary>\r\npublic class ListeCategoriesVM : BaseVM\r\n{\r\n    //Attributs\r\n    private readonly string[] _rolesAutorises = { "Administrateur" };\r\n\r\n    //D\xe9pendances\r\n    private readonly ICategorieService _categorieService;\r\n    private readonly INavigateur _navigateur;\r\n    private readonly IAuthentificateur _authentificateur;\r\n    //highlight-next-line\r\n    private readonly INotification _notification;\r\n\r\n    //Attributs des propri\xe9t\xe9s\r\n    private List<CategorieModel> _lstCategories;    \r\n    private CategorieModel? _categorieSelection;\r\n    private bool _estEnTravail = false;\r\n\r\n    /// <summary>\r\n    /// Constructeur\r\n    /// </summary>\r\n    /// <param name="authentificateur">La classe d\'assistance d\'authentification</param>\r\n    //highlight-next-line\r\n    /// <param name="notification">La classe d\'assistance pour la notification</param>\r\n    /// <param name="categorieService">Service du mod\xe8le Categorie</param>\r\n    /// <param name="navigateur">La classe d\'assistance Navigateur</param>\r\n//highlight-next-line\r\n    public ListeCategoriesVM(IAuthentificateur authentificateur, INotification notification, ICategorieService categorieService, INavigateur navigateur)\r\n    {\r\n        _authentificateur = authentificateur;\r\n        //highlight-next-line\r\n        _notification = notification;\r\n\r\n        if (_authentificateur.EstAutorise(_rolesAutorises))\r\n        {\r\n            _categorieService = categorieService;\r\n            _navigateur = navigateur;\r\n            ObtenirListeCommande = new AsyncRelayCommand(ObtenirListeAsync);\r\n            SupprimerCommande = new AsyncRelayCommand(SupprimerAsync, PeutSupprimer);\r\n            NouveauCommande = new RelayCommand(() => _navigateur.Naviguer<GestionCategorieVM, int>(0));\r\n            EditerCommande = new RelayCommand(() => _navigateur.Naviguer<GestionCategorieVM, int>(CategorieSelection.CategorieId),\r\n                                              () => CategorieSelection != null);\r\n        }\r\n        //highlight-start\r\n        else\r\n        {\r\n            _notification.MessageErreur("Acc\xe8s non autoris\xe9.", "Vous n\'avez pas acc\xe8s \xe0 cette vue.");\r\n        }\r\n        //highlight-end\r\n    }\r\n\r\n    /// <summary>\r\n    /// Obtenir la liste de cat\xe9gories du service\r\n    /// </summary>    \r\n    private async Task ObtenirListeAsync()\r\n    {\r\n        EstEnTravail = true;\r\n\r\n        if (_authentificateur.EstAutorise(_rolesAutorises))\r\n        {\r\n            ListeCategories = await _categorieService.ObtenirListeAsync();\r\n        }\r\n        //highlight-start\r\n        else\r\n        {\r\n            _notification.MessageErreur("Acc\xe8s non autoris\xe9.", "Vous n\'avez pas acc\xe8s \xe0 cette fonctionnalit\xe9.");\r\n        }\r\n//highlight-end\r\n\r\n        EstEnTravail = false;\r\n    }\r\n\r\n    /// <summary>\r\n    /// Supprimer la cat\xe9gorie s\xe9lectionn\xe9e\r\n    /// </summary>    \r\n    private async Task SupprimerAsync()\r\n    {\r\n        EstEnTravail = true;\r\n\r\n        if (_authentificateur.EstAutorise(_rolesAutorises))\r\n        {\r\n            await _categorieService.SupprimerAsync(CategorieSelection!.CategorieId);\r\n\r\n            await ObtenirListeAsync();\r\n        }\r\n        //highlight-start\r\n        else\r\n        {\r\n            _notification.MessageErreur("Acc\xe8s non autoris\xe9.", "Vous n\'avez pas acc\xe8s \xe0 cette fonctionnalit\xe9.");\r\n        }\r\n//highlight-end\r\n\r\n        EstEnTravail = false;\r\n    }\r\n\r\n    /// <summary>\r\n    /// V\xe9rifier si la commande supprimer peut s\'ex\xe9cuter\r\n    /// </summary>\r\n    /// <returns>Vrai si elle peut s\'ex\xe9cuter, faux si elle ne peut pas</returns>\r\n    private bool PeutSupprimer()\r\n    {        \r\n        //V\xe9rifie si une cat\xe9gorie peut \xeatre supprim\xe9e\r\n        if (CategorieSelection != null)\r\n        {\r\n            //Il y a une cat\xe9gorie est s\xe9lectionn\xe9e\r\n\r\n            //Il faut emp\xeacher la v\xe9rification si l\'op\xe9ration est en cours d\'ex\xe9cution\r\n            //L\'appel se fait en parall\xe8le avec l\'ex\xe9cution et il y a une v\xe9rification dans la BD\r\n            //Entity Framework ne peut pas fonctionner en parall\xe8le avec la m\xeame instance du contexte.\r\n            //Cette v\xe9rification est seulement n\xe9cessaire dans le cas d\'un appel avec la base de donn\xe9es.\r\n            if (SupprimerCommande.IsRunning == false)\r\n            {\r\n                //V\xe9rifie si elle a des d\xe9pendances\r\n                CategorieDependance? categorieDependance =\r\n                    _categorieService.ObtenirDependance(CategorieSelection.CategorieId);\r\n\r\n                //Si aucune cartes, elle peut \xeatre supprim\xe9e\r\n                return categorieDependance?.NbCartes == 0;\r\n            }\r\n            else\r\n            {\r\n                return false;\r\n            }\r\n        }\r\n        else\r\n        {\r\n            //Aucune cat\xe9gorie n\'est s\xe9lectionn\xe9e\r\n            return false;\r\n        }\r\n    }\r\n\r\n    //Commandes\r\n    public IAsyncRelayCommand ObtenirListeCommande { get; private set; }\r\n    \r\n    public IAsyncRelayCommand SupprimerCommande { get; private set; }\r\n\r\n    public IRelayCommand NouveauCommande { get; private set; }\r\n\r\n    public IRelayCommand EditerCommande { get; private set; }\r\n\r\n    //Propri\xe9t\xe9s li\xe9es\r\n    public bool EstEnTravail\r\n    {\r\n        get\r\n        {\r\n            return _estEnTravail;\r\n        }\r\n        set\r\n        {\r\n            SetProperty(ref _estEnTravail, value);\r\n        }\r\n    }\r\n\r\n    public List<CategorieModel> ListeCategories\r\n    {\r\n        get\r\n        {\r\n            return _lstCategories;\r\n        }\r\n        set\r\n        {\r\n            SetProperty(ref _lstCategories, value);\r\n        }\r\n    }\r\n\r\n    public CategorieModel? CategorieSelection\r\n    {\r\n        get\r\n        {\r\n            return _categorieSelection;\r\n        }\r\n        set\r\n        {\r\n            if(SetProperty(ref _categorieSelection, value))\r\n            {\r\n                SupprimerCommande.NotifyCanExecuteChanged();\r\n                EditerCommande.NotifyCanExecuteChanged();\r\n            }\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Testez l'application avec les 2 utilisateurs. Avec ",(0,i.jsx)(n.strong,{children:"fsthilaire"}),", la vue sera accessible et fonctionnelle. Avec ",(0,i.jsx)(n.strong,{children:"tstark"}),", il y aura le message d'erreur."]}),"\n",(0,i.jsxs)(n.p,{children:["Connectez-vous avec l'utilisateur ",(0,i.jsx)(n.strong,{children:"fsthilaire"}),". Modifiez le r\xf4le de l'utilisateur directement dans la bd pendant que l'utilisateur est connect\xe9. Appuyez sur le bouton ",(0,i.jsx)(n.strong,{children:"R"}),". Vous allez recevoir un message."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"UPDATE utilisateur SET RoleId = 2 WHERE UtilisateurId = 1;\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Remettez l'utilisateur ",(0,i.jsx)(n.strong,{children:"fsthilaire"})," en tant qu'administrateur."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"UPDATE utilisateur SET RoleId = 1 WHERE UtilisateurId = 1;\n"})})]})}function d(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},1151:(e,n,r)=>{r.d(n,{Z:()=>l,a:()=>a});var i=r(7294);const t={},s=i.createContext(t);function a(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);