"use strict";(self.webpackChunknotes_de_cours_4_n_1_2024=self.webpackChunknotes_de_cours_4_n_1_2024||[]).push([[1780],{352:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>p,frontMatter:()=>t,metadata:()=>l,toc:()=>c});var s=r(5893),i=r(1151);const t={sidebar_position:140,draft:!1},a="SuperCarte.WPF",l={id:"WPF partie 1/supercarte_wpf",title:"SuperCarte.WPF",description:"Nous avons maintenant le projet .EF servant \xe0 g\xe9rer la bd; le projet .core servant \xe0 faire le lien entre les objets du domaine et les objet de la bd. Il reste \xe0 faire l'interface de l'application.",source:"@site/docs/70-WPF partie 1/supercarte_wpf.md",sourceDirName:"70-WPF partie 1",slug:"/WPF partie 1/supercarte_wpf",permalink:"/4N1_2024/docs/WPF partie 1/supercarte_wpf",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:140,frontMatter:{sidebar_position:140,draft:!1},sidebar:"NotesSidebar",previous:{title:"SuperCarte.Core",permalink:"/4N1_2024/docs/WPF partie 1/supercarte_core"},next:{title:"R\xe9sum\xe9 du code",permalink:"/4N1_2024/docs/WPF partie 1/wpf_resume"}},o={},c=[{value:"Cr\xe9ation du projet dans une solution existante",id:"cr\xe9ation-du-projet-dans-une-solution-existante",level:2},{value:"Ajout des d\xe9pendances de projet",id:"ajout-des-d\xe9pendances-de-projet",level:3},{value:"Fichier Usings.cs",id:"fichier-usingscs",level:3},{value:"Fichier de configuration - appsettings.json",id:"fichier-de-configuration---appsettingsjson",level:3},{value:"Th\xe9orie: comment utiliser l&#39;injection de d\xe9pendances",id:"th\xe9orie-comment-utiliser-linjection-de-d\xe9pendances",level:2},{value:"1) Cr\xe9ation directe (\xe0 ne pas faire)",id:"1-cr\xe9ation-directe-\xe0-ne-pas-faire",level:3},{value:"2) Injection de la classe (\xe0 ne pas faire)",id:"2-injection-de-la-classe-\xe0-ne-pas-faire",level:3},{value:"3) Injection par interface (la bonne solution)",id:"3-injection-par-interface-la-bonne-solution",level:3},{value:"Ajout de la structure pour injection des d\xe9pendances",id:"ajout-de-la-structure-pour-injection-des-d\xe9pendances",level:2},{value:"Enregistrement des services",id:"enregistrement-des-services",level:3},{value:"Cr\xe9ation du Host - App.xaml.cs",id:"cr\xe9ation-du-host---appxamlcs",level:2},{value:"Hello World",id:"hello-world",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"supercartewpf",children:"SuperCarte.WPF"}),"\n",(0,s.jsxs)(n.p,{children:["Nous avons maintenant le projet ",(0,s.jsx)(n.strong,{children:".EF"})," servant \xe0 g\xe9rer la bd; le projet ",(0,s.jsx)(n.strong,{children:".core"})," servant \xe0 faire le lien entre les objets du domaine et les objet de la bd. Il reste \xe0 faire l'interface de l'application."]}),"\n",(0,s.jsx)(n.p,{children:"C'est ici que WPF entre en jeu."}),"\n",(0,s.jsx)(n.h2,{id:"cr\xe9ation-du-projet-dans-une-solution-existante",children:"Cr\xe9ation du projet dans une solution existante"}),"\n",(0,s.jsxs)(n.p,{children:["Il faut ajouter le projet ",(0,s.jsx)(n.strong,{children:"WPF"})," dans la solution."]}),"\n",(0,s.jsxs)(n.p,{children:["Pour ce faire, s\xe9lectionnez la solution ",(0,s.jsx)(n.strong,{children:"SuperCarteApp"})," en haut de l'",(0,s.jsx)(n.strong,{children:"Explorateur de solution"})," et choisissez ",(0,s.jsx)(n.strong,{children:"Ajouter -> Nouveau projet..."})," dans le menu contextuel."]}),"\n",(0,s.jsxs)(n.p,{children:["Cr\xe9ez un projet de type ",(0,s.jsx)(n.strong,{children:"Application WPF"}),"."]}),"\n",(0,s.jsx)(n.admonition,{title:"attention",type:"warning",children:(0,s.jsxs)(n.p,{children:["Il est important ",(0,s.jsx)(n.strong,{children:"de ne pas choisir"})," la version ",(0,s.jsx)(n.strong,{children:".NET Framework"}),"."]})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Nom du projet"})," : SuperCarte.WPF"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Infrastructure"})," : .NET 7"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Pour le champ ",(0,s.jsx)(n.strong,{children:"Solution"}),", indiquez d'",(0,s.jsx)(n.strong,{children:"Ajouter \xe0 la solution"})," et gardez SuperCarteApp."]}),"\n",(0,s.jsxs)(n.p,{children:["Ensuite, s\xe9lectionnez le projet ",(0,s.jsx)(n.strong,{children:"SuperCarte.WPF"})," dans l'",(0,s.jsx)(n.strong,{children:"Explorateur de solution"})," et choisissez ",(0,s.jsx)(n.strong,{children:"D\xe9finir en tant que projet de d\xe9marrage"})," dans le menu contextuel."]}),"\n",(0,s.jsx)(n.h3,{id:"ajout-des-d\xe9pendances-de-projet",children:"Ajout des d\xe9pendances de projet"}),"\n",(0,s.jsxs)(n.p,{children:["Le projet ",(0,s.jsx)(n.strong,{children:"SuperCarte.WPF"})," aura besoin du projet ",(0,s.jsx)(n.strong,{children:"SuperCarte.EF"})," pour initialiser le contexte et ",(0,s.jsx)(n.strong,{children:"SuperCarte.Core"}),", car il utilisera des ",(0,s.jsx)(n.strong,{children:"services"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Il faut l'ajouter dans les d\xe9pendances du projet."}),"\n",(0,s.jsxs)(n.p,{children:["S\xe9lectionnez le dossier ",(0,s.jsx)(n.strong,{children:"D\xe9pendances"})," du projet ",(0,s.jsx)(n.strong,{children:"SuperCarte.WPF"})," et choisissez ",(0,s.jsx)(n.strong,{children:"Ajouter une r\xe9f\xe9rence de projet"})," dans le menu contextuel."]}),"\n",(0,s.jsxs)(n.p,{children:["Dans la fen\xeatre, il faut cocher ",(0,s.jsx)(n.strong,{children:"SuperCarte.EF"})," et ",(0,s.jsx)(n.strong,{children:"SuperCarte.Core"}),". Vous venez d'int\xe9grer 2 librairies internes au projet."]}),"\n",(0,s.jsx)(n.h3,{id:"fichier-usingscs",children:"Fichier Usings.cs"}),"\n",(0,s.jsxs)(n.p,{children:["Afin de r\xe9duire la taille des classes, les ",(0,s.jsx)(n.strong,{children:"using"})," qui seront beaucoup utilis\xe9s dans ce projet seront d\xe9clar\xe9 globalement."]}),"\n",(0,s.jsxs)(n.p,{children:["Cr\xe9ez le fichier ",(0,s.jsx)(n.strong,{children:"Usings.cs"})," \xe0 la racine du projet ",(0,s.jsx)(n.strong,{children:"SuperCarte.WPF"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"global using SuperCarte.WPF; //Les classes \xe0 la racine de l'application WPF\r\nglobal using SuperCarte.EF.Data; //Les classes du mod\xe8le du contexte\r\nglobal using SuperCarte.EF.Data.Context; // La classe du contexte\r\nglobal using System;\r\nglobal using System.Collections.Generic;\r\nglobal using System.Threading.Tasks;\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Au fur et \xe0 mesure que des classes s'ajouteront dans le projet, le fichier ",(0,s.jsx)(n.strong,{children:"Usings.cs"})," sera mis \xe0 jour."]}),"\n",(0,s.jsxs)(n.p,{children:["\xc9galement, le fichier ",(0,s.jsx)(n.strong,{children:"Usings.cs"})," appartient uniquement au projet dans lequel il est cr\xe9\xe9."]}),"\n",(0,s.jsx)(n.h3,{id:"fichier-de-configuration---appsettingsjson",children:"Fichier de configuration - appsettings.json"}),"\n",(0,s.jsxs)(n.p,{children:["La librairie ",(0,s.jsx)(n.strong,{children:"Microsoft.Extensions.Configuration.Json"})," permet de lire un fichier de configuration en ",(0,s.jsx)(n.strong,{children:"json"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Dans la ",(0,s.jsx)(n.strong,{children:"Console du Gestionnaire de package"}),", inscrivez cette ligne. Il est important que le ",(0,s.jsx)(n.strong,{children:"Projet par d\xe9faut"})," soit ",(0,s.jsx)(n.strong,{children:"SuperCarte.WPF"})," dans la console. La librairie s'installera dans le projet indiqu\xe9 dans le champ ",(0,s.jsx)(n.strong,{children:"Projet par d\xe9faut"}),"."]}),"\n",(0,s.jsx)("img",{src:"/4N1_2024/img/13_package_console_1.png"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:"Install-Package Microsoft.Extensions.Configuration.Json\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Cr\xe9ez le fichier ",(0,s.jsx)(n.strong,{children:"appsettings.json"})," \xe0 la racine du projet ",(0,s.jsx)(n.strong,{children:"SuperCarte.WPF"}),". Prenez le mod\xe8le ",(0,s.jsx)(n.strong,{children:"Fichier Texte"}),"."]}),"\n",(0,s.jsxs)(n.admonition,{title:"IMPORTANT",type:"danger",children:[(0,s.jsxs)(n.p,{children:["Pour que le fichier soit pris en compte par le compilateur, il faut indiquer dans ces propri\xe9t\xe9s qu'il doit \xeatre copi\xe9 dans le dossier de compilation. Effectuez un ",(0,s.jsx)(n.strong,{children:"clic droit"})," sur le fichier ",(0,s.jsx)(n.strong,{children:"appsettings.json"})," et s\xe9lectionnez ",(0,s.jsx)(n.strong,{children:"Propri\xe9t\xe9s"}),". Pour le champ ",(0,s.jsx)(n.strong,{children:"Copier dans le r\xe9pertoire de sortie"}),", il faut mettre la valeur ",(0,s.jsx)(n.strong,{children:"Copier si plus r\xe9cent"}),"."]}),(0,s.jsx)("img",{src:"/4N1_2024/img/12_appsettings_01.png"})]}),"\n",(0,s.jsxs)(n.p,{children:["Copiez ce code ",(0,s.jsx)(n.strong,{children:"json"})," dans le fichier."]}),"\n",(0,s.jsxs)(n.p,{children:["Utilisez cette version si vous n'avez pas le message d'erreur du certificat ",(0,s.jsx)(n.strong,{children:"SSL"}),"."]}),"\n",(0,s.jsx)(n.admonition,{title:"Attention",type:"warning",children:(0,s.jsx)(n.p,{children:"Vous devez modifier le nom de la base de donn\xe9es pour celui que vous avez utilis\xe9."})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-powershell",children:'{\r\n  "ConnectionStrings": {\r\n    "DefaultConnection": "Server=localhost\\SQLExpress;Database=eDA_4N1_SuperCarte;Trusted_Connection=True;"\r\n  }\r\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Utilisez cette version avec le param\xe8tre ",(0,s.jsx)(n.strong,{children:"Trust Server Certificate=true;"})," si vous avez le message d'erreur du certificat ",(0,s.jsx)(n.strong,{children:"SSL"}),". Il faut \xe9galement modifier le nom de la base de donn\xe9es pour celui que vous avez utilis\xe9."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'{\r\n  "ConnectionStrings": {\r\n    "DefaultConnection": "Server=localhost\\SQLExpress;Database=eDA_4N1_SuperCarte;Trusted_Connection=True;Trust Server Certificate=true;"\r\n  }\r\n}\n'})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["Dans le fichier ",(0,s.jsx)(n.strong,{children:"SuperCarteContext.cs"}),", la variable ",(0,s.jsx)(n.strong,{children:"chaineConnexion"})," ne sert plus \xe0 rien car une validation est faite \xe0 la ligne 34 afin de savoir si le fichier de configuration est utilis\xe9. Nous verrons plus tard ce qui remplacera la connexion \xe0 la bd."]})}),"\n",(0,s.jsx)(n.h2,{id:"th\xe9orie-comment-utiliser-linjection-de-d\xe9pendances",children:"Th\xe9orie: comment utiliser l'injection de d\xe9pendances"}),"\n",(0,s.jsxs)(n.p,{children:["Nous allons voir 3 fa\xe7ons d'ins\xe9rer un repository dans ",(0,s.jsx)(n.strong,{children:"SuperCarte.WPF"})]}),"\n",(0,s.jsxs)(n.p,{children:["Afin de les d\xe9montrer, nous allons utiliser une classe qui n'est pas introduite encore, mais que nous utiliserons plus tard: la classe ",(0,s.jsx)(n.strong,{children:"CategorieService"}),". Cette classe devra utiliser le repository pour la classe ",(0,s.jsx)(n.strong,{children:"Categorie"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"1-cr\xe9ation-directe-\xe0-ne-pas-faire",children:"1) Cr\xe9ation directe (\xe0 ne pas faire)"}),"\n",(0,s.jsx)(n.p,{children:"La bonne vieille technique de faire un new() lorsqu'on a besoin d'un objet."}),"\n",(0,s.jsxs)(n.p,{children:["Il serait donc possible de cr\xe9er notre repository directement dans le ",(0,s.jsx)(n.strong,{children:"constructeur"})," de la classe ",(0,s.jsx)(n.strong,{children:"CategorieService"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",metastring:'title="NE PAS UTILISER"',children:"public class CategorieService : ICategorieService\r\n{\r\n    private readonly CategorieRepo _categorieRepo;\r\n    ...\r\n    public CategorieService()\r\n    {\r\n        _categorieRepo = new CategorieRepo();\r\n        ...\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Une cr\xe9ation directe rend la classe ",(0,s.jsx)(n.strong,{children:"CategorieService"})," enti\xe8rement d\xe9pendante de la classe ",(0,s.jsx)(n.strong,{children:"CategorieRepo"}),". Si nous voulions utiliser un autre type de repo, il faudrait modifier tous les emplacements appelant new."]}),"\n",(0,s.jsx)(n.h3,{id:"2-injection-de-la-classe-\xe0-ne-pas-faire",children:"2) Injection de la classe (\xe0 ne pas faire)"}),"\n",(0,s.jsx)(n.p,{children:"La 2e technique serait de l'injecter par le constructeur, en utilisant la classe."}),"\n",(0,s.jsxs)(n.p,{children:["Premi\xe8rement, il faudrait enregistrer la classe ",(0,s.jsx)(n.strong,{children:"CategorieRepo"}),".\r\n\xe0 l'aide de ce code:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",metastring:'title="NE PAS UTILISER"',children:"    services.AddTransient<CategorieRepo>();\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Il serait maintenant possible d'injecter le repo dans le constructeur de la classe ",(0,s.jsx)(n.strong,{children:"CategorieService"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",metastring:'title="NE PAS UTILISER"',children:"public class CategorieService : ICategorieService\r\n{\r\n    private readonly CategorieRepo _categorieRepo;\r\n    ...\r\n    public CategorieService(CategorieRepo categorieRepo)\r\n    {\r\n        _categorieRepo = categorieRepo;\r\n        ...\n"})}),"\n",(0,s.jsx)(n.p,{children:"Cette approche utilise l'injection de d\xe9pendances, mais utilise la classe impl\xe9ment\xe9e dans le constructeur. Si on d\xe9sire changer de classe pour CategorieRepo (par exemple CategoriRepo2), il faudra changer tous les constructeurs qui l'utilise."}),"\n",(0,s.jsx)(n.h3,{id:"3-injection-par-interface-la-bonne-solution",children:"3) Injection par interface (la bonne solution)"}),"\n",(0,s.jsxs)(n.p,{children:["La meilleure approche est d'injecter l'interface par le constructeur. ",(0,s.jsx)(n.strong,{children:"CategorieService"})," n'est plus d\xe9pendant de la classe ",(0,s.jsx)(n.strong,{children:"CategorieRepo"}),", mais d'une interface. Il sera maintenant plus facile d'utiliser une 2e version du repo."]}),"\n",(0,s.jsxs)(n.p,{children:["Premi\xe8rement, il faut enregistrer l'interface ",(0,s.jsx)(n.strong,{children:"ICategorieRepo"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",metastring:'title="solution recommand\xe9e"',children:"    services.AddTransient<ICategorieRepo, CategorieRepo>();\n"})}),"\n",(0,s.jsx)(n.p,{children:"Et ensuite l'injecter dans le constructeur :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",metastring:'title="solution recommand\xe9e"',children:"public class CategorieService : ICategorieService\r\n{\r\n    private readonly ICategorieRepo _categorieRepo;\r\n    ...\r\n    public CategorieService(ICategorieRepo categorieRepo)\r\n    {\r\n        _categorieRepo = categorieRepo;\r\n        ...\n"})}),"\n",(0,s.jsx)(n.p,{children:"Avec cette approche, il suffit de changer la classe sur la ligne d'enregistrement de l'interface et toutes les classes recevront maintenant ce nouveau type."}),"\n",(0,s.jsx)(n.h2,{id:"ajout-de-la-structure-pour-injection-des-d\xe9pendances",children:"Ajout de la structure pour injection des d\xe9pendances"}),"\n",(0,s.jsxs)(n.p,{children:["Le projet ",(0,s.jsx)(n.strong,{children:"WPF"})," n'a pas de fichier ",(0,s.jsx)(n.strong,{children:"program.cs"}),". Ce type de projet n'est pas con\xe7u \xe0 la base pour \xeatre dans la structure du ",(0,s.jsx)(n.strong,{children:"hosting"})," de ",(0,s.jsx)(n.strong,{children:".Net Core"}),". Il faut donc l'adapter."]}),"\n",(0,s.jsxs)(n.p,{children:["Le fichier de d\xe9marrage de l'application est ",(0,s.jsx)(n.strong,{children:"App.xaml.cs"}),". Il est inclus dans le fichier ",(0,s.jsx)(n.strong,{children:"App.xaml"}),"."]}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:"Remarquez la fl\xe8che \xe0 c\xf4t\xe9 de App.xaml. Si vous cliquez sur celle-ci, vous y trouverez App.xaml.cs"})}),"\n",(0,s.jsxs)(n.p,{children:["Remarquez que la classe est ",(0,s.jsx)(n.strong,{children:"partial"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"public partial class App : Application\r\n{\r\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Une classe partielle en ",(0,s.jsx)(n.strong,{children:".NET"})," consiste \xe0 cr\xe9er une classe dans plusieurs fichiers. Le fichier ",(0,s.jsx)(n.strong,{children:"App.xaml"})," est aussi une classe, sauf que le langage est ",(0,s.jsx)(n.strong,{children:"XAML"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xaml",metastring:'showLineNumbers title="NE PAS COPIER"',children:'<Application x:Class="SuperCarte.WPF.App"\r\n             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"\r\n             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"\r\n             xmlns:local="clr-namespace:SuperCarte.WPF"\r\n             StartupUri="MainWindow.xaml">\r\n    <Application.Resources>\r\n         \r\n    </Application.Resources>\r\n</Application>\n'})}),"\n",(0,s.jsx)(n.p,{children:"\xc0 la ligne 1, le nom de la classe est indiqu\xe9."}),"\n",(0,s.jsxs)(n.p,{children:["C'est pour cette raison que le fichier ",(0,s.jsx)(n.strong,{children:"App.xaml.cs"})," est un sous-fichier de ",(0,s.jsx)(n.strong,{children:"App.xaml"})," dans l'",(0,s.jsx)(n.strong,{children:"Explorateur de solutions"}),". Si la classe n'\xe9tait pas partielle, il ne serait pas possible d'avoir 2 langages pour une m\xeame classe. La notion de classe partielle sert \xe9galement \xe0 ajouter des fonctionnalit\xe9s dans une classe g\xe9n\xe9r\xe9e automatiquement. Il aurait \xe9t\xe9 possible d'ajouter un 2e fichier interne pour ajouter des \xe9l\xe9ments \xe0 la classe de base."]}),"\n",(0,s.jsxs)(n.p,{children:["\xc0 la ligne 5, c'est la fen\xeatre de d\xe9marrage. Pour une application ",(0,s.jsx)(n.strong,{children:"WPF"}),", la classe ",(0,s.jsx)(n.strong,{children:"App"})," est le conteneur des fen\xeatres. Une fen\xeatre est l'\xe9quivalent d'une page."]}),"\n",(0,s.jsxs)(n.p,{children:["L'application ",(0,s.jsx)(n.strong,{children:"WPF"})," de ce projet sera comme un ",(0,s.jsx)(n.strong,{children:"SPA"})," ou une ",(0,s.jsx)(n.strong,{children:"Application \xe0 page unique"}),". Dans le cas d'une application native, il serait possible de dire un ",(0,s.jsx)(n.strong,{children:"SWA"})," pour une ",(0,s.jsx)(n.strong,{children:"Application \xe0 fen\xeatre unique"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Les applications ",(0,s.jsx)(n.strong,{children:"\xe0 fen\xeatres multiples"})," sont de plus en plus rares, car de nombreux appareils, tel que les tablettes, ne sont pas en mesure de les g\xe9rer correctement. L'approche multi-fen\xeatres est plut\xf4t pour les syst\xe8mes d'exploitation d'ordinateur, comme Windows ou macOS, car ils sont en mesure de g\xe9rer ce type d'application."]}),"\n",(0,s.jsxs)(n.p,{children:["L'application aura une seule fen\xeatre, le classe ",(0,s.jsx)(n.strong,{children:"MainWindow.xaml"}),". \xc0 l'int\xe9rieur de cette classe, il y aura un ",(0,s.jsx)(n.strong,{children:"conteneur"})," qui aura un ",(0,s.jsx)(n.strong,{children:"contr\xf4le utilisateur (user contr\xf4le)"})," qui s'occupera d'une vue sp\xe9cifique. Ce conteneur changera de ",(0,s.jsx)(n.strong,{children:"contr\xf4le utilisateur"})," lorsqu'une nouvelle vue devra \xeatre affich\xe9e. Il s'agit de la m\xeame m\xe9canique que Blazor ou Angular, mais pour une application native."]}),"\n",(0,s.jsx)(n.h3,{id:"enregistrement-des-services",children:"Enregistrement des services"}),"\n",(0,s.jsx)(n.p,{children:"Des classes d'extensions seront utilis\xe9es pour g\xe9rer l'enregistrement des d\xe9pendances."}),"\n",(0,s.jsxs)(n.p,{children:["Cr\xe9ez le dossier ",(0,s.jsx)(n.strong,{children:"Extensions\\ServiceCollections"})," \xe0 la racine du projet ",(0,s.jsx)(n.strong,{children:"SuperCarte.WPF"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Cr\xe9ez la classe ",(0,s.jsx)(n.strong,{children:"SCRepositories.cs"})," dans le dossier."]}),"\n",(0,s.jsxs)(n.p,{children:["Les Repositories ont d\xe9j\xe0 cr\xe9\xe9s dans la section Core. Il faut maintenant les ajouter dans l'enregistrement. Remarquez que l'ajout est en ",(0,s.jsx)(n.strong,{children:"Scoped"}),". L'instance du d\xe9pot sera partag\xe9e entre les diff\xe9rents services qui l'utilisent."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"using Microsoft.Extensions.DependencyInjection;\r\n\r\nnamespace SuperCarte.WPF.Extensions.ServiceCollections;\r\n\r\n/// <summary>\r\n/// Classe d'extension qui permet d'enregistrer les classes de la cat\xe9gorie Repository\r\n/// </summary>\r\npublic static class SCRepositoryExtensions\r\n{\r\n    /// <summary>\r\n    /// M\xe9thode qui permet d'enregistrer les repositories de l'application\r\n    /// </summary>\r\n    /// <param name=\"services\">La collection de services</param>\r\n    public static void EnregistrerRepositories(this IServiceCollection services)\r\n    {\r\n        services.AddScoped<IRoleRepo, RoleRepo>();\r\n        services.AddScoped<IEnsembleRepo, EnsembleRepo>();\r\n        services.AddScoped<ICategorieRepo, CategorieRepo>();\r\n        services.AddScoped<IUtilisateurRepo, UtilisateurRepo>();\r\n        services.AddScoped<ICarteRepo, CarteRepo>();\r\n        services.AddScoped<IUtilisateurCarteRepo, UtilisateurCarteRepo>();\r\n    }\r\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Cr\xe9ez la classe ",(0,s.jsx)(n.strong,{children:"SCServiceExtensions.cs"})," dans le dossier ."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"using Microsoft.Extensions.DependencyInjection;\r\n\r\nnamespace SuperCarte.WPF.Extensions.ServiceCollections;\r\n\r\n/// <summary>\r\n/// Classe d'extension qui permet d'enregistrer les classes de la cat\xe9gorie Service\r\n/// </summary>\r\npublic static class SCServiceExtensions\r\n{\r\n    /// <summary>\r\n    /// M\xe9thode qui permet d'enregistrer les services de l'application\r\n    /// </summary>\r\n    /// <param name=\"services\">La collection de services</param>\r\n    public static void EnregistrerServices(this IServiceCollection services)\r\n    {\r\n                \r\n    }\r\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Cr\xe9ez la classe ",(0,s.jsx)(n.strong,{children:"SCValidateurExtensions.cs"})," dans le dossier . Cette classe s'occupera de l'enregistrement des ",(0,s.jsx)(n.strong,{children:"Validateurs"}),". Ce concept sera pr\xe9sent\xe9 dans un autre document."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"using Microsoft.Extensions.DependencyInjection;\r\n\r\nnamespace SuperCarte.WPF.Extensions.ServiceCollections;\r\n\r\n/// <summary>\r\n/// Classe d'extension qui permet d'enregistrer les classes de la cat\xe9gorie Validateur\r\n/// </summary>\r\npublic static class SCValidateurExtensions\r\n{\r\n    /// <summary>\r\n    /// M\xe9thode qui permet d'enregistrer les validateurs de l'application\r\n    /// </summary>\r\n    /// <param name=\"services\">La collection de services</param>\r\n    public static void EnregistrerValidateurs(this IServiceCollection services)\r\n    {\r\n\r\n    }\r\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Cr\xe9ez la classe ",(0,s.jsx)(n.strong,{children:"SCViewModelExtensions.cs"})," dans le dossier . Cette classe s'occupera de l'enregistrement des ",(0,s.jsx)(n.strong,{children:"ViewModel"}),". Ce concept sera pr\xe9sent\xe9 dans le prochain document."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"using Microsoft.Extensions.DependencyInjection;\r\n\r\nnamespace SuperCarte.WPF.Extensions.ServiceCollections;\r\n\r\n/// <summary>\r\n/// Classe d'extension qui permet d'enregistrer les classes de la cat\xe9gorie Service\r\n/// </summary>\r\npublic static class SCViewModelExtensions\r\n{\r\n    /// <summary>\r\n    /// M\xe9thode qui permet d'enregistrer les ViewModels de l'application\r\n    /// </summary>\r\n    /// <param name=\"services\">La collection de services</param>\r\n    public static void EnregistrerViewModels(this IServiceCollection services)\r\n    {\r\n\r\n    }\r\n}\r\n\n"})}),"\n",(0,s.jsx)(n.h2,{id:"cr\xe9ation-du-host---appxamlcs",children:"Cr\xe9ation du Host - App.xaml.cs"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/fr-fr/dotnet/core/extensions/generic-host?tabs=appbuilder",children:"Pour en savoir plus sur le hosting"})}),"\n",(0,s.jsxs)(n.p,{children:["Dans la ",(0,s.jsx)(n.strong,{children:"Console du Gestionnaire de package"}),", inscrivez cette ligne."]}),"\n",(0,s.jsx)(n.admonition,{title:"attention",type:"warning",children:(0,s.jsxs)(n.p,{children:["Il est important que le ",(0,s.jsx)(n.strong,{children:"Projet par d\xe9faut"})," soit ",(0,s.jsx)(n.strong,{children:"SuperCarte.WPF"})," dans la console. La librairie s'installera dans le projet indiqu\xe9 dans le champ ",(0,s.jsx)(n.strong,{children:"Projet par d\xe9faut"}),"."]})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Install-Package Microsoft.Extensions.Hosting\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Avec cette librairie, il sera possible de configurer l'application ",(0,s.jsx)(n.strong,{children:"WPF"})," avec le ",(0,s.jsx)(n.strong,{children:"hosting"})," d'application de ",(0,s.jsx)(n.strong,{children:".NET Core"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Voici le d\xe9tail de la classe ",(0,s.jsx)(n.strong,{children:"App.xaml.cs"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["\xc0 la ligne 14 du bloc de code ci-dessous, il y a un attribut pour le ",(0,s.jsx)(n.strong,{children:"host"})," de l'application. Le ",(0,s.jsx)(n.strong,{children:"host"}),"  doit \xeatre en attribut, car il sera utilis\xe9 dans plusieurs m\xe9thodes de la classe."]}),"\n",(0,s.jsxs)(n.p,{children:["Ensuite, le constructeur de la classe s'occupe de configurer le ",(0,s.jsx)(n.strong,{children:"host"})," comme il a \xe9t\xe9 fait dans le fichier ",(0,s.jsx)(n.strong,{children:"Program.cs"})," de l'application console."]}),"\n",(0,s.jsxs)(n.p,{children:["\xc0 la ligne 18, le constructeur par d\xe9faut du ",(0,s.jsx)(n.strong,{children:"host"})," est cr\xe9\xe9."]}),"\n",(0,s.jsx)(n.p,{children:"\xc0 la ligne 23, il faut enregistrer la fen\xeatre principale dans les d\xe9pendances de l'application."}),"\n",(0,s.jsx)(n.p,{children:"\xc0 la ligne 26, le contexte est enregistr\xe9 avec le fichier de configuration. C'est ici que la connexion \xe0 la bd est cr\xe9\xe9e, remplacant celle qui \xe9tait faite dans SuperCarteContext.cs."}),"\n",(0,s.jsx)(n.p,{children:"Aux lignes 29 \xe0 32, le service utilise les m\xe9thodes d'extension pour enregistrer les diff\xe9rents concepts."}),"\n",(0,s.jsxs)(n.p,{children:["\xc0 la ligne 35, le ",(0,s.jsx)(n.strong,{children:"host"})," est construit en fonction de la configuration initiale."]}),"\n",(0,s.jsxs)(n.p,{children:["La m\xe9thode ",(0,s.jsx)(n.strong,{children:"OnStartup()"})," est appel\xe9 au d\xe9marrage de l'application, apr\xe8s le constructeur. Elle d\xe9marre le ",(0,s.jsx)(n.strong,{children:"host"})," et ensuite indique au programme d'afficher la fen\xeatre principale de l'application."]}),"\n",(0,s.jsxs)(n.p,{children:["Copiez ce code dans le fichier ",(0,s.jsx)(n.strong,{children:"App.xaml.cs"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",metastring:"showLineNumbers",children:'using Microsoft.EntityFrameworkCore;\r\nusing Microsoft.Extensions.Configuration;\r\nusing Microsoft.Extensions.DependencyInjection;\r\nusing Microsoft.Extensions.Hosting;\r\nusing SuperCarte.WPF.Extensions.ServiceCollections;\r\nusing System.Windows;\r\n\r\nnamespace SuperCarte.WPF;\r\n/// <summary>\r\n/// Interaction logic for App.xaml\r\n/// </summary>\r\npublic partial class App : Application\r\n{\r\n    //highlight-next-line\r\n    private IHost? _host;\r\n\r\n\tpublic App()\r\n\t{\r\n        //highlight-next-line\r\n        var builder = Host.CreateDefaultBuilder();\r\n\r\n        //Enregistrement des services\r\n        builder.ConfigureServices((context, services) =>\r\n        {      \r\n            //highlight-next-line      \r\n            services.AddSingleton<MainWindow>(); //Fen\xeatre principale\r\n\r\n            //Enregistrement du contexte    \r\n            //highlight-next-line\r\n            services.AddDbContext<SuperCarteContext>(options => options.UseSqlServer(context.Configuration.GetConnectionString("DefaultConnection")));\r\n\r\n            //Appel des m\xe9thodes d\'extension    \r\n            //highlight-start                    \r\n            services.EnregistrerRepositories();\r\n            services.EnregistrerServices();            \r\n            services.EnregistrerValidateurs();\r\n            services.EnregistrerViewModels();\r\n            //highlight-end\r\n        });\r\n//highlight-next-line\r\n        _host = builder.Build();\r\n    }\r\n\r\n    /// <summary>\r\n    /// D\xe9marrage de l\'application\r\n    /// </summary>\r\n    /// <param name="e"></param>\r\n    protected override async void OnStartup(StartupEventArgs e)\r\n    {\r\n        await _host!.StartAsync();\r\n\r\n        var fenetreInitiale = _host.Services.GetRequiredService<MainWindow>();\r\n        fenetreInitiale.Show(); //Affiche la fen\xeatre initiale\r\n        //highlight-next-line\r\n        base.OnStartup(e);\r\n    }\r\n\r\n    /// <summary>\r\n    /// Fermeture de l\'application\r\n    /// </summary>\r\n    /// <param name="e"></param>\r\n    protected override async void OnExit(ExitEventArgs e)\r\n    {\r\n        await _host!.StopAsync();\r\n        base.OnExit(e);\r\n    }\r\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"D\xe9marrez l'application."}),"\n",(0,s.jsx)(n.admonition,{title:"ATTENTION",type:"warning",children:(0,s.jsx)(n.p,{children:"Vous obtiendrez 2 fen\xeatres. Il est important d'enlever le 2i\xe8me en suivant ces instructions"})}),"\n",(0,s.jsxs)(n.p,{children:["Ouvrez le fichier ",(0,s.jsx)(n.strong,{children:"App.xaml"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xaml",metastring:'showLineNumbers title="Ne pas copier"',children:'<Application x:Class="SuperCarte.WPF.App"\r\n             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"\r\n             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"\r\n             xmlns:local="clr-namespace:SuperCarte.WPF"\r\n\t\t\t //highlight-next-line\r\n             StartupUri="MainWindow.xaml">\r\n    <Application.Resources>\r\n         \r\n    </Application.Resources>\r\n</Application>\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\xc0 la ligne 5, il y a la propri\xe9t\xe9 ",(0,s.jsx)(n.strong,{children:"StartupUri"}),". Cette propri\xe9t\xe9 indique \xe9galement la fen\xeatre de d\xe9marrage. Il faut retirer cette propri\xe9t\xe9 pour ne pas interf\xe9rer avec l'injection de d\xe9pendances."]}),"\n",(0,s.jsx)(n.p,{children:"Enlevez la ligne 5."}),"\n",(0,s.jsx)(n.p,{children:"D\xe9marrez de nouveau l'application et il aura une seule fen\xeatre."}),"\n",(0,s.jsx)(n.h2,{id:"hello-world",children:"Hello World"}),"\n",(0,s.jsxs)(n.p,{children:["Pour avoir un premier contenu visuel, il faut modifier le fichier ",(0,s.jsx)(n.strong,{children:"MainWindow.xaml"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xaml",metastring:"showLineNumbers",children:'<Window x:Class="SuperCarte.WPF.MainWindow"\r\n        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"\r\n        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"\r\n        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"\r\n        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"\r\n        xmlns:local="clr-namespace:SuperCarte.WPF"\r\n        mc:Ignorable="d"\r\n        //highlight-next-line\r\n        Title="Super Carte App" Height="450" Width="800">\r\n    <Grid>\r\n    //highlight-next-line\r\n        <Label Content="Hello World!!!"></Label>\r\n    </Grid>\r\n</Window>\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\xc0 la ligne 8, la propri\xe9t\xe9 ",(0,s.jsx)(n.strong,{children:"Title"})," de la balise ",(0,s.jsx)(n.strong,{children:"<Window>"})," permet de mettre le titre de la fen\xeatre."]}),"\n",(0,s.jsxs)(n.p,{children:["\xc0 la ligne 10, il y a un ",(0,s.jsx)(n.strong,{children:"Label"})," pour afficher du texte statique.  L'int\xe9rieur de la balise ",(0,s.jsx)(n.strong,{children:"<Grid>"}),", c'est le contenu de la fen\xeatre."]})]})}function p(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},1151:(e,n,r)=>{r.d(n,{Z:()=>l,a:()=>a});var s=r(7294);const i={},t=s.createContext(i);function a(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);