"use strict";(self.webpackChunknotes_de_cours_4_n_1_2024=self.webpackChunknotes_de_cours_4_n_1_2024||[]).push([[1490],{265:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var t=r(5893),s=r(1151);const i={sidebar_position:227,draft:!1},a="Date et Champ texte num\xe9rique",l={id:"WPF partie 2/champ_numerique",title:"Date et Champ texte num\xe9rique",description:"Il n'existe pas de contr\xf4le qui accepte seulement les nombres avec WPF. Les d\xe9veloppeurs peuvent acheter des librairies de composants comme DevExpress et Telerik pour avoir des composants avanc\xe9s. Il est possible de faire une version simple soi-m\xeame, mais elle est limit\xe9e.",source:"@site/docs/72-WPF partie 2/champ_numerique.md",sourceDirName:"72-WPF partie 2",slug:"/WPF partie 2/champ_numerique",permalink:"/4N1_2024/docs/WPF partie 2/champ_numerique",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:227,frontMatter:{sidebar_position:227,draft:!1},sidebar:"NotesSidebar",previous:{title:"Commande",permalink:"/4N1_2024/docs/WPF partie 2/commande"},next:{title:"Seed Categorie, Ensemble, Carte",permalink:"/4N1_2024/docs/WPF partie 2/seed"}},o={},c=[{value:"S\xe9lection d&#39;une date",id:"s\xe9lection-dune-date",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"date-et-champ-texte-num\xe9rique",children:"Date et Champ texte num\xe9rique"}),"\n",(0,t.jsxs)(n.p,{children:["Il n'existe pas de contr\xf4le qui accepte seulement les nombres avec ",(0,t.jsx)(n.strong,{children:"WPF"}),". Les d\xe9veloppeurs peuvent acheter des librairies de composants comme ",(0,t.jsx)(n.strong,{children:"DevExpress"})," et ",(0,t.jsx)(n.strong,{children:"Telerik"})," pour avoir des composants avanc\xe9s. Il est possible de faire une version simple soi-m\xeame, mais elle est limit\xe9e."]}),"\n",(0,t.jsxs)(n.p,{children:["Ajoutez la propri\xe9t\xe9 ",(0,t.jsx)(n.strong,{children:"int Nombre"})," dans ",(0,t.jsx)(n.strong,{children:"HelloWorldVM.cs"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:"    private int _nombre;\n"})}),"\n",(0,t.jsx)(n.p,{children:"et"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:"public int Nombre\r\n{\r\n    get\r\n    {\r\n        return _nombre;\r\n    }\r\n    set\r\n    {\r\n        SetProperty(ref _nombre, value);\r\n    }\r\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Liez la propri\xe9t\xe9 ",(0,t.jsx)(n.strong,{children:"Nombre"})," \xe0 un ",(0,t.jsx)(n.strong,{children:"<Textbox>"})," dans ",(0,t.jsx)(n.strong,{children:"UcHelloWorld.xaml"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xaml",children:'<TextBox Text="{Binding Nombre}" />\n'})}),"\n",(0,t.jsx)(n.p,{children:"D\xe9marrez le programme. Si vous essayez d'inscrire une lettre, elle s'affichera, mais le contr\xf4le sera en rouge pour indiquer que la valeur n'est pas compatible avec le type de la propri\xe9t\xe9 de liaison."}),"\n",(0,t.jsxs)(n.p,{children:["Pour permettre seulement les chiffres, il faut modifier des \xe9v\xe9nements sur le  ",(0,t.jsx)(n.strong,{children:"<Textbox>"})," pour \xeatre en mesure de le faire. L'exemple provient d'une suggestion de ",(0,t.jsx)(n.strong,{children:"StackOverflow"}),". ",(0,t.jsx)(n.a,{href:"https://stackoverflow.com/questions/1268552/how-do-i-get-a-textbox-to-only-accept-numeric-input-in-wpf",children:"https://stackoverflow.com/questions/1268552/how-do-i-get-a-textbox-to-only-accept-numeric-input-in-wpf"})]}),"\n",(0,t.jsxs)(n.p,{children:["L'\xe9v\xe9nement ",(0,t.jsx)(n.strong,{children:"PreviewTextInput"})," permet d'analyser la valeur des caract\xe8res qui sont inscrits dans le composant. G\xe9n\xe9ralement, c'est un seul caract\xe8re, mais il est possible d'en recevoir plusieurs d'un coup."]}),"\n",(0,t.jsxs)(n.p,{children:["Il faut \xe9galement intercepter l'action ",(0,t.jsx)(n.strong,{children:"coller"}),". L'\xe9v\xe9nement ",(0,t.jsx)(n.strong,{children:"DataObject.Pasting"})," permet d'intercepter l'action ",(0,t.jsx)(n.strong,{children:"coller"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Dans le ",(0,t.jsx)(n.strong,{children:"xaml"}),", il faut cr\xe9er les 2 \xe9v\xe9nements."]}),"\n",(0,t.jsxs)(n.p,{children:["Changez le TextBox dans ",(0,t.jsx)(n.strong,{children:"UcHelloWorld.xaml"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xaml",children:'<TextBox Text="{Binding Nombre}" PreviewTextInput="TextBox_PreviewTextInput" DataObject.Pasting="TextBox_Pasting"  />\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Dans le ",(0,t.jsx)(n.strong,{children:"xaml.cs"}),", il faut faire l'impl\xe9mentation de l'\xe9v\xe9nement. L'impl\xe9mentation ne se fait pas dans le ",(0,t.jsx)(n.strong,{children:"ViewModel"}),", car c'est un comportement directement li\xe9 \xe0 la vue. Le ",(0,t.jsx)(n.strong,{children:"ViewModel"})," veut recevoir un nombre, il ne s'int\xe9resse pas comment la vue s'en occupe."]}),"\n",(0,t.jsxs)(n.p,{children:["Pour l'\xe9v\xe9nement ",(0,t.jsx)(n.strong,{children:"PreviewTextInput"}),", il est possible d'utiliser une r\xe8gle ",(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/dotnet/standard/base-types/regular-expressions",children:"Regex"})})," (ou ",(0,t.jsx)(n.a,{href:"https://fr.wikipedia.org/wiki/Expression_r%C3%A9guli%C3%A8re",children:"regex sur wikipedia"}),") pour d\xe9terminer si la chaine contient uniquement des chiffres."]}),"\n",(0,t.jsxs)(n.p,{children:["La propri\xe9t\xe9 ",(0,t.jsx)(n.strong,{children:"e.Handled == false"}),"  indique que l'\xe9v\xe9nement peut continuer son ex\xe9cution. Si ",(0,t.jsx)(n.strong,{children:"e.Handled == true"}),", l'\xe9v\xe9nement est annul\xe9."]}),"\n",(0,t.jsx)(n.p,{children:"Donc si la chaine n'a pas de chiffre, elle fait annuler l'\xe9v\xe9nement."}),"\n",(0,t.jsxs)(n.p,{children:["Ajoutez cette fonction dans ",(0,t.jsx)(n.strong,{children:"UcHelloWorld.xaml.cs"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'private void TextBox_PreviewTextInput(object sender, TextCompositionEventArgs e)\r\n{\r\n    e.Handled = !Regex.IsMatch(e.Text, "^[0-9]");\r\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Pour l'\xe9v\xe9nement ",(0,t.jsx)(n.strong,{children:"DataObject.Pasting"}),", il y a un peu plus d'\xe9tapes."]}),"\n",(0,t.jsxs)(n.p,{children:["Il faut valider si le contenu du ",(0,t.jsx)(n.strong,{children:"coller"})," est du texte. Si c'est le cas, il faut valider \xe0 l'aide d'une r\xe8gle ",(0,t.jsx)(n.strong,{children:"Regex"})," si ce sont que des chiffres. Si ce n'est pas le cas, il faut annuler le ",(0,t.jsx)(n.strong,{children:"coller"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Ajoutez cette fonction dans ",(0,t.jsx)(n.strong,{children:"UcHelloWorld.xaml.cs"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'private void TextBox_Pasting(object sender, DataObjectPastingEventArgs e)\r\n{\r\n    if (e.DataObject.GetDataPresent(typeof(String)))\r\n    {\r\n        String text = (String)e.DataObject.GetData(typeof(String));\r\n        if (!Regex.IsMatch(text, "^[0-9]"))\r\n        {\r\n            e.CancelCommand();\r\n        }\r\n    }\r\n    else\r\n    {\r\n        e.CancelCommand();\r\n    }\r\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Si la propri\xe9t\xe9 li\xe9e est de type ",(0,t.jsx)(n.strong,{children:"int?"}),", donc elle est ",(0,t.jsx)(n.strong,{children:"nullable"}),". Le ",(0,t.jsx)(n.strong,{children:"<textbox>"})," n'acceptera pas le champ vide comme valeur ",(0,t.jsx)(n.strong,{children:"null"}),". Il faut ajouter la propri\xe9t\xe9 ",(0,t.jsx)(n.strong,{children:"TargetNullValue=''"})," dans le ",(0,t.jsx)(n.strong,{children:"Binding"}),". Donc la valeur ",(0,t.jsx)(n.strong,{children:"null"}),"  de la liaison \xe9quivaut \xe0 une chaine vide du ",(0,t.jsx)(n.strong,{children:"<Textbox>"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xaml",children:'<TextBox Text="{Binding Nombre, TargetNullValue=\'\'}" PreviewTextInput="TextBox_PreviewTextInput" DataObject.Pasting="TextBox_Pasting"  />\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Si le nombre est un ",(0,t.jsx)(n.strong,{children:"decimal"}),", il faut utiliser la ",(0,t.jsx)(n.strong,{children:"Regex"})," ci-dessous. L'\xe9v\xe9nement ",(0,t.jsx)(n.strong,{children:"PreviewTextInput"})," valide uniquement le caract\xe8re inscrit et non l'enti\xe8ret\xe9 du nombre. Il est donc possible d'inscrire ",(0,t.jsx)(n.strong,{children:"12,,,,564,10"}),". Les composants payants n'ont pas ce genre de probl\xe8me."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'"^[0-9.]+" //Anglais, car le s\xe9parateur est un point\r\n"^[0-9,]+" //Fran\xe7ais, car le s\xe9parateur est une virgule\n'})}),"\n",(0,t.jsx)(n.p,{children:"Pour le rendre ind\xe9pendant de la culture, il faut d\xe9terminer quel est le s\xe9parateur de la culture en cours d'ex\xe9cution."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'string separateur = NumberFormatInfo.CurrentInfo.NumberDecimalSeparator;\r\nstring regex = $"^[0-9{separateur}]+");\n'})}),"\n",(0,t.jsx)(n.p,{children:"S'il faut avoir un nombre n\xe9gatif."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'string separateur = NumberFormatInfo.CurrentInfo.NumberDecimalSeparator;\r\nstring decregex = $"^[0-9{separateur}-]+"); //decimal n\xe9gatif\r\nstring intregex = "^[0-9-]"; //int n\xe9gatif\n'})}),"\n",(0,t.jsx)(n.h2,{id:"s\xe9lection-dune-date",children:"S\xe9lection d'une date"}),"\n",(0,t.jsxs)(n.p,{children:["Le composant ",(0,t.jsx)(n.strong,{children:"<DatePicker>"})," permet d'avoir un contr\xf4le de s\xe9lection d'une date."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xaml",children:'<DatePicker SelectedDate="{Binding MaDate}" />\n'})})]})}function u(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},1151:(e,n,r)=>{r.d(n,{Z:()=>l,a:()=>a});var t=r(7294);const s={},i=t.createContext(s);function a(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);