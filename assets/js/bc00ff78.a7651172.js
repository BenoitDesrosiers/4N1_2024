"use strict";(self.webpackChunknotes_de_cours_4_n_1_2024=self.webpackChunknotes_de_cours_4_n_1_2024||[]).push([[9386],{1703:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>o,contentTitle:()=>a,default:()=>u,frontMatter:()=>t,metadata:()=>l,toc:()=>c});var s=n(5893),i=n(1151);const t={sidebar_position:4},a="SuperCarte.Core",l={id:"04 WPF/supercarte_core",title:"SuperCarte.Core",description:"Cr\xe9ation du projet",source:"@site/docs/04 WPF/supercarte_core.md",sourceDirName:"04 WPF",slug:"/04 WPF/supercarte_core",permalink:"/4N1_2024/docs/04 WPF/supercarte_core",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"NotesSidebar",previous:{title:"SuperCarte.EF",permalink:"/4N1_2024/docs/04 WPF/supercarte_ef"},next:{title:"planning",permalink:"/4N1_2024/docs/planning"}},o={},c=[{value:"Cr\xe9ation du projet",id:"cr\xe9ation-du-projet",level:2},{value:"Ajout des d\xe9pendances de projet",id:"ajout-des-d\xe9pendances-de-projet",level:2},{value:"Classe et m\xe9thode g\xe9n\xe9rique - Th\xe9orie",id:"classe-et-m\xe9thode-g\xe9n\xe9rique---th\xe9orie",level:2},{value:"G\xe9n\xe9ralisation du contexte",id:"g\xe9n\xe9ralisation-du-contexte",level:2},{value:"Obtenir un enregistrement sp\xe9cifique par sa cl\xe9",id:"obtenir-un-enregistrement-sp\xe9cifique-par-sa-cl\xe9",level:3},{value:"Utilisation du Repository - Th\xe9orie",id:"utilisation-du-repository---th\xe9orie",level:3},{value:"Cr\xe9ation des Repositories sp\xe9cifiques",id:"cr\xe9ation-des-repositories-sp\xe9cifiques",level:2},{value:"RoleRepo",id:"rolerepo",level:3},{value:"UtilisateurRepo",id:"utilisateurrepo",level:3},{value:"EnsembleRepo",id:"ensemblerepo",level:3},{value:"CategorieRepo",id:"categorierepo",level:3},{value:"CarteRepo",id:"carterepo",level:3},{value:"UtilisateurCarteRepo",id:"utilisateurcarterepo",level:3},{value:"Cr\xe9ation du projet dans une solution existante",id:"cr\xe9ation-du-projet-dans-une-solution-existante",level:2},{value:"Ajout des d\xe9pendances de projet",id:"ajout-des-d\xe9pendances-de-projet-1",level:2},{value:"Fichier Usings.cs",id:"fichier-usingscs",level:2},{value:"Fichier de configuration - appsettings.json",id:"fichier-de-configuration---appsettingsjson",level:2},{value:"Ajout de la structure pour injection des d\xe9pendances",id:"ajout-de-la-structure-pour-injection-des-d\xe9pendances",level:2},{value:"Classes d&#39;extension de m\xe9thodes",id:"classes-dextension-de-m\xe9thodes",level:3},{value:"Cr\xe9ation du Host - App.xaml.cs",id:"cr\xe9ation-du-host---appxamlcs",level:3},{value:"Hello World",id:"hello-world",level:2}];function d(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.h1,{id:"supercartecore",children:"SuperCarte.Core"}),"\n",(0,s.jsx)(r.h2,{id:"cr\xe9ation-du-projet",children:"Cr\xe9ation du projet"}),"\n",(0,s.jsxs)(r.p,{children:["Il faut ajouter le projet ",(0,s.jsx)(r.strong,{children:"Core"})," dans la solution."]}),"\n",(0,s.jsxs)(r.p,{children:["Ce projet aura les classes de type ",(0,s.jsx)(r.strong,{children:"Service"}),", de type ",(0,s.jsx)(r.strong,{children:"Repository"}),", de type ",(0,s.jsx)(r.strong,{children:"Validateur"})," et les mod\xe8les du domaine."]}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez un projet de type ",(0,s.jsx)(r.strong,{children:"Biblioth\xe8que de classe"}),". Il est important ",(0,s.jsx)(r.strong,{children:"de ne pas choisir"})," la version ",(0,s.jsx)(r.strong,{children:".NET Framework"}),"."]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Nom du projet"})," : SuperCarte.Core"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Infrastructure"})," : .NET 7"]}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:["Supprimez le fichier ",(0,s.jsx)(r.strong,{children:"Class1.cs"}),"."]}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez un dossier ",(0,s.jsx)(r.strong,{children:"Models"})," \xe0 la racine du projet. Ce dossier contient les classes du mod\xe8le du domaine."]}),"\n",(0,s.jsx)(r.p,{children:"Il faut diff\xe9rencier les classes du mod\xe8le de donn\xe9es et du mod\xe8le du domaine."}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Mod\xe8le de donn\xe9es"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Il s'agit d'une classe qui repr\xe9sente une entit\xe9 de la base de donn\xe9es. (Table ou Vue)."}),"\n",(0,s.jsx)(r.li,{children:"L'application ne doit pas travailler directement avec cette classe."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Mod\xe8le du domaine"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Il s'agit d'une classe qui repr\xe9sente un \xe9l\xe9ment du domaine de l'application. Elle peut \xeatre tr\xe8s similaire \xe0 une classe du mod\xe8le de donn\xe9es, mais peut \xe9galement contenir des champs de plusieurs tables et de la logique propre."}),"\n",(0,s.jsx)(r.li,{children:"La logique applicative travaille avec la classe du mod\xe8le de domaine."}),"\n",(0,s.jsxs)(r.li,{children:["Le ",(0,s.jsx)(r.strong,{children:"Service"})," s'occupe de faire la transition (",(0,s.jsx)(r.strong,{children:"mapping"}),") entre la classe du mod\xe8le de donn\xe9es et la classe du domaine du domaine."]}),"\n",(0,s.jsxs)(r.li,{children:["Le ",(0,s.jsx)(r.strong,{children:"Repository"})," peut \xe9galement utiliser les classes du domaine pour ins\xe9rer les donn\xe9es de plusieurs tables dans un seul objet."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:["Avec ",(0,s.jsx)(r.strong,{children:"Entity Framework"}),", il n'est pas recommand\xe9 que la classe du mod\xe8le de donn\xe9es soit \xe9galement la classe du mod\xe8le du domaine. ",(0,s.jsx)(r.strong,{children:"Dapper"})," offre un plus grand contr\xf4le sur la cr\xe9ation de l'objet, il serait possible de donner les 2 r\xf4les \xe0 la m\xeame classe."]}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez un dossier ",(0,s.jsx)(r.strong,{children:"Repositories"})," \xe0 la racine du projet. Ce dossier contiendra les classes de type ",(0,s.jsx)(r.strong,{children:"Repository"}),". Ce sont les classes qui contiennent les requ\xeates pour communiquer avec la base de donn\xe9es."]}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez un dossier ",(0,s.jsx)(r.strong,{children:"Services"})," \xe0 la racine du projet. Ce dossier contiendra les services de l'application. Les classes de type ",(0,s.jsx)(r.strong,{children:"Service"})," contiennent la logique de l'application. Elles s'occuperont de convertir les objets de donn\xe9es en objet du domaine et vice-versa dans un certain cas \xe9galement."]}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez le dossier ",(0,s.jsx)(r.strong,{children:"Validateurs"}),". Les classes de type ",(0,s.jsx)(r.strong,{children:"Validateur"})," s'occupent de valider les donn\xe9es. Ce sont des outils que le service utilisera pour s'assurer que l'objet du domaine est conforme aux exigences du logiciel. Avant d'envoyer un objet \xe0 la base de donn\xe9es, il doit respecter les contraintes."]}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez le dossier ",(0,s.jsx)(r.strong,{children:"Extensions"}),". Il y aura des extensions pour faire la conversion entre les objets du mod\xe8le de donn\xe9es et du mod\xe8le du domaine."]}),"\n",(0,s.jsxs)(r.p,{children:["Voici la structure compl\xe8te des dossiers du projet ",(0,s.jsx)(r.strong,{children:"SuperCarte.Core"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"SuperCarte.Core\r\n\t- Extensions\r\n\t- Models\r\n\t- Repositories\r\n\t- Services\r\n\t- Validateurs\n"})}),"\n",(0,s.jsx)(r.h2,{id:"ajout-des-d\xe9pendances-de-projet",children:"Ajout des d\xe9pendances de projet"}),"\n",(0,s.jsxs)(r.p,{children:["Le projet ",(0,s.jsx)(r.strong,{children:"SuperCarte.Core"})," aura besoin du projet ",(0,s.jsx)(r.strong,{children:"SuperCarte.EF"})," pour utiliser le contexte."]}),"\n",(0,s.jsx)(r.p,{children:"Il faut l'ajouter dans les d\xe9pendances du projet."}),"\n",(0,s.jsxs)(r.p,{children:["S\xe9lectionnez le dossier ",(0,s.jsx)(r.strong,{children:"D\xe9pendances"})," du projet ",(0,s.jsx)(r.strong,{children:"SuperCarte.Core"})," et choisissez ",(0,s.jsx)(r.strong,{children:"Ajouter une r\xe9f\xe9rence de projet"})," dans le menu contextuel."]}),"\n",(0,s.jsxs)(r.p,{children:["Dans la fen\xeatre, il faut cocher ",(0,s.jsx)(r.strong,{children:"SuperCarte.EF"}),". Vous venez d'int\xe9grer une librairie interne au projet."]}),"\n",(0,s.jsx)(r.h2,{id:"classe-et-m\xe9thode-g\xe9n\xe9rique---th\xe9orie",children:"Classe et m\xe9thode g\xe9n\xe9rique - Th\xe9orie"}),"\n",(0,s.jsxs)(r.p,{children:["Pour plus d'information : ",(0,s.jsx)(r.a,{href:"https://learn.microsoft.com/fr-fr/dotnet/csharp/fundamentals/types/generics",children:"https://learn.microsoft.com/fr-fr/dotnet/csharp/fundamentals/types/generics"})]}),"\n",(0,s.jsx)(r.p,{children:"L'utilisation de classe g\xe9n\xe9rique permet de g\xe9n\xe9raliser les classes afin d'\xe9viter de cr\xe9er plusieurs classes sp\xe9cifiques et de m\xe9thodes sp\xe9cifiques."}),"\n",(0,s.jsxs)(r.p,{children:["Les classes et les m\xe9thodes g\xe9n\xe9riques ont \xe0 la fin de leur nom le ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"<>"})}),". Le ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"<>"})})," permet d'indiquer le type r\xe9el qui doit \xeatre utilis\xe9 pour l'instance de la classe ou pour l'utilisation de la m\xe9thode."]}),"\n",(0,s.jsxs)(r.p,{children:["La classe g\xe9n\xe9rique la plus populaire en ",(0,s.jsx)(r.strong,{children:"C#"})," est ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"List<T>"})}),". La lettre ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"T"})})," est la norme pour indiquer que le type est g\xe9n\xe9rique."]}),"\n",(0,s.jsxs)(r.p,{children:["Prenez par exemple qu'il faut avoir une collection de la classe ",(0,s.jsx)(r.strong,{children:"Personne"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"public class Personne\r\n{\r\n    public string Prenom { get; set; }\r\n    public string Nom { get; set; }\r\n    public int Age { get; set; }\r\n}\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Avant d'avoir une collection de type ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"List<T>"})}),", il avait 2 options."]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Cr\xe9er une collection d'objets"})}),"\n",(0,s.jsxs)(r.p,{children:["Par exemple, en ",(0,s.jsx)(r.strong,{children:"C#"}),", il y a la collection ",(0,s.jsx)(r.strong,{children:"ArrayList"}),". Voici la signature de la m\xe9thode ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"Add(objet? value)"})}),". Cette collection permet d'ajouter des classes du type ",(0,s.jsx)(r.strong,{children:"objet"}),", donc tous les types de classes."]}),"\n",(0,s.jsx)(r.p,{children:"Il est possible d'ajouter plusieurs types de donn\xe9es dans la m\xeame collection. C'est rarement un comportement d\xe9sir\xe9 dans une liste."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:'ArrayList listePersonne = new ArrayList();\r\nliste.Add(1); //Un entier\r\nliste.Add("une string"); //Une string\r\nliste.Add(3.04m); //Un decimal\r\nliste.Add(new DateTime(2011,11,11)); //Un objet DateTime\r\nliste.Add(new Personne() {Prenom = "Francois", Nom = "St-Hilaire", Age = 21}); //Un objet de type personne\r\n\n'})}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Cr\xe9er une classe Collection sp\xe9cifique \xe0 un type."})}),"\n",(0,s.jsxs)(r.p,{children:["Cette approche permet de cr\xe9er une classe qui s'occupera d'ajouter des objets d'un seul type. Cette classe permet d'encapsuler la m\xe9canique interne pour ajouter, pour enlever et pour obtenir uniquement pour le type ",(0,s.jsx)(r.strong,{children:"Personne"}),". Le gros d\xe9savantage est qu'il faut cr\xe9er une classe ",(0,s.jsx)(r.strong,{children:"Collection"})," sp\xe9cifique pour toutes les classes de l'application qui n\xe9cessite une collection."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:'public class CollectionPersonne\r\n{\r\n    private ArrayList _arrPersonne = new ArrayList();\r\n\r\n    public void Ajouter(Personne personne)\r\n    {\r\n        _arrPersonne.Add(personne);\r\n    }\r\n\r\n    public Personne Obtenir(int index)\r\n    {\r\n        if (index < _arrPersonne.Count)\r\n        {\r\n            return (Personne)_arrPersonne[index];\r\n        }\r\n        else\r\n        {\r\n            throw new Exception($"La liste a {_arrPersonne.Count} \xe9l\xe9ment(s)");\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,s.jsx)(r.p,{children:"Voici comment l'utiliser."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:'CollectionPersonne liste = new CollectionPersonne();\r\n\r\nliste.Ajouter(new Personne() { Prenom = "Francois", Nom = "St-Hilaire", Age = 21 });\r\nliste.Ajouter(new Personne() { Prenom = "St\xe9phane", Nom = "Janvier", Age = 61 });\r\n\r\nPersonne p2 = liste.Obtenir(1);\r\n\r\nConsole.WriteLine($"La personne est {p2.Prenom} { p2.Nom }.");\r\n\r\nliste.Ajouter(4); //Erreur du compilateur. Seulement le type **Personne** qui est accept\xe9.\n'})}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Classe g\xe9n\xe9rique"})}),"\n",(0,s.jsx)(r.p,{children:"Les classes g\xe9n\xe9riques permettent de g\xe9n\xe9raliser un comportement et de sp\xe9cifier un type \xe0 une instance pr\xe9cise."}),"\n",(0,s.jsxs)(r.p,{children:["Voici une simplification de la classe ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"List<T>"})}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:'public class ListeGenerique<T>\r\n{\r\n    private ArrayList _arr = new ArrayList();\r\n\r\n    public void Ajouter(T valeur)\r\n    {\r\n        _arr.Add(valeur);\r\n    }\r\n\r\n    public T Obtenir(int index)\r\n    {\r\n        if (index < _arr.Count)\r\n        {\r\n            return (T)_arr[index];\r\n        }\r\n        else\r\n        {\r\n            throw new Exception($"La liste a {_arr.Count} \xe9l\xe9ment(s)");\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,s.jsxs)(r.p,{children:["Dans la d\xe9claration de la classe, il y a le ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"<T>"})})," qui indique qu'il faut obligatoirement sp\xe9cifier un type lors de la cr\xe9ation d'un objet."]}),"\n",(0,s.jsxs)(r.p,{children:["Le type g\xe9n\xe9rique ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"T"})})," est utilis\xe9 comme type pour le param\xe8tre de la m\xe9thode ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"void Ajouter(T valeur)"})}),"."]}),"\n",(0,s.jsxs)(r.p,{children:["Le type g\xe9n\xe9rique ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"T"})})," est utilis\xe9 comme type de retour de la m\xe9thode ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"T Obtenir(int index)"})}),"."]}),"\n",(0,s.jsxs)(r.p,{children:["Donc, si un objet est cr\xe9\xe9 avec le type ",(0,s.jsx)(r.strong,{children:"Personne"})," ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"new ListeGenerique<Personne>()"})})," , le compilateur va voir ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"void Ajouter(Personne valeur)"})})," et  ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"Personne Obtenir(int index)"})}),"."]}),"\n",(0,s.jsx)(r.p,{children:"Voici comment l'utiliser."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:'ListeGenerique<Personne> liste = new ListeGenerique<Personne>();\r\n\r\nliste.Ajouter(new Personne() { Prenom = "Francois", Nom = "St-Hilaire", Age = 21 });\r\nliste.Ajouter(new Personne() { Prenom = "St\xe9phane", Nom = "Janvier", Age = 61 });\r\n\r\nPersonne p2 = liste.Obtenir(1);\r\n\r\nConsole.WriteLine($"La personne est {p2.Prenom} { p2.Nom }.");\r\n\r\nliste.Ajouter(4); //Erreur du compilateur\n'})}),"\n",(0,s.jsxs)(r.p,{children:["Avec la m\xeame liste, il est possible de faire des ajouts de ",(0,s.jsx)(r.strong,{children:"DateTime"})," par exemple."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:'ListeGenerique<DateTime> listeDate = new ListeGenerique<DateTime>();\r\n\r\nlisteDate.Ajouter(new DateTime(1967, 2, 1));\r\nlisteDate.Ajouter(new DateTime(1957, 6, 29));\r\n\r\nDateTime d2 = listeDate.Obtenir(1);\r\n\r\nConsole.WriteLine($"La date est {d2}.");\r\n\r\nlisteDate.Ajouter(4); //Erreur du compilateur\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"g\xe9n\xe9ralisation-du-contexte",children:"G\xe9n\xe9ralisation du contexte"}),"\n",(0,s.jsxs)(r.p,{children:["Les m\xe9thodes de base de la classe ",(0,s.jsx)(r.strong,{children:"DBContext"})," utilisent les types g\xe9n\xe9riques. Il est donc possible de g\xe9n\xe9raliser les requ\xeates de base et r\xe9p\xe9titives dans le ",(0,s.jsx)(r.strong,{children:"Repository"}),"."]}),"\n",(0,s.jsxs)(r.p,{children:["Voici une liste de requ\xeates ",(0,s.jsx)(r.strong,{children:"classiques"})," qui sont g\xe9n\xe9ralement identiques."]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Obtenir tous les \xe9l\xe9ments de la table"}),"\n",(0,s.jsx)(r.li,{children:"Ajouter un ou des \xe9l\xe9ments"}),"\n",(0,s.jsx)(r.li,{children:"Supprimer un ou des \xe9l\xe9ments"}),"\n",(0,s.jsx)(r.li,{children:"Enregistrer les modifications"}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez le dossier ",(0,s.jsx)(r.strong,{children:"Bases"})," dans le dossier ",(0,s.jsx)(r.strong,{children:"Repositories"}),". Ce dossier contiendra les classes g\xe9n\xe9riques de base."]}),"\n",(0,s.jsxs)(r.p,{children:["L'injection de d\xe9pendances du ",(0,s.jsx)(r.strong,{children:"Repository"})," se fait par les interfaces. Il faut donc que les classes de base poss\xe8dent une interface."]}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez l'interface ",(0,s.jsx)(r.strong,{children:"IBaseRepo"})," dans le dossier ",(0,s.jsx)(r.strong,{children:"Repositories\\Bases"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:'namespace SuperCarte.Core.Repositories.Bases;\r\n\r\n/// <summary>\r\n/// Interface g\xe9n\xe9rique qui contient les op\xe9rations de base des tables de la base de donn\xe9es\r\n/// </summary>\r\n/// <typeparam name="TData">Type du mod\xe8le de donn\xe9es / table</typeparam>\r\npublic interface IBaseRepo<TData> where TData : class\r\n{\r\n    /// <summary>\r\n    /// Obtenir la liste de tous les items en asynchrone.\r\n    /// </summary>\r\n    /// <returns>Liste des items</returns>\r\n    Task<List<TData>> ObtenirListeAsync();\r\n\r\n    /// <summary>\r\n    /// Obtenir la liste de tous les items.\r\n    /// </summary>\r\n    /// <returns>Liste des items</returns>\r\n    List<TData> ObtenirListe();\r\n\r\n    /// <summary>\r\n    /// Ajouter une liste d\'items dans la base de donn\xe9es en asynchrone.\r\n    /// </summary>\r\n    /// <param name="lstItem">Liste des items \xe0 ajouter</param>\r\n    /// <param name="enregistrer">Enregistrer imm\xe9diatement ou non dans la base de donn\xe9es</param>\r\n    Task AjouterAsync(List<TData> lstItem, bool enregistrer);\r\n\r\n    /// <summary>\r\n    /// Ajouter une liste d\'items dans la base de donn\xe9es.\r\n    /// </summary>\r\n    /// <param name="lstItem">Liste des items \xe0 ajouter</param>\r\n    /// <param name="enregistrer">Enregistrer imm\xe9diatement ou non dans la base de donn\xe9es</param>\r\n    void Ajouter(List<TData> lstItem, bool enregistrer);\r\n\r\n    /// <summary>\r\n    /// Ajouter un item dans la base de donn\xe9es en asynchrone.\r\n    /// </summary>\r\n    /// <param name="item">L\'item \xe0 ajouter</param>\r\n    /// <param name="enregistrer">Enregistrer imm\xe9diatement ou non dans la base de donn\xe9es</param>\r\n    Task AjouterAsync(TData item, bool enregistrer);\r\n\r\n    /// <summary>\r\n    /// Ajouter un item dans la base de donn\xe9es.\r\n    /// </summary>\r\n    /// <param name="item">L\'item \xe0 ajouter</param>\r\n    /// <param name="enregistrer">Enregistrer imm\xe9diatement ou non dans la base de donn\xe9es</param>\r\n    void Ajouter(TData item, bool enregistrer);\r\n\r\n    /// <summary>\r\n    /// Supprimer une liste d\'items dans la base de donn\xe9es en asynchrone.\r\n    /// </summary>\r\n    /// <param name="lstItem">Liste des items \xe0 supprimer</param>\r\n    /// <param name="enregistrer">Enregistrer imm\xe9diatement ou non dans la base de donn\xe9es</param>\r\n    Task SupprimerAsync(List<TData> lstItem, bool enregistrer);\r\n\r\n    /// <summary>\r\n    /// Supprimer une liste d\'items dans la base de donn\xe9es.\r\n    /// </summary>\r\n    /// <param name="lstItem">Liste des items \xe0 supprimer</param>\r\n    /// <param name="enregistrer">Enregistrer imm\xe9diatement ou non dans la base de donn\xe9es</param>\r\n    void Supprimer(List<TData> lstItem, bool enregistrer);\r\n\r\n    /// <summary>\r\n    /// Supprimer un item dans la base de donn\xe9es en asynchrone.\r\n    /// </summary>\r\n    /// <param name="item">L\'item \xe0 supprimer</param>\r\n    /// <param name="enregistrer">Enregistrer imm\xe9diatement ou non dans la base de donn\xe9es</param>\r\n    Task SupprimerAsync(TData item, bool enregistrer);\r\n\r\n    /// <summary>\r\n    /// Supprimer un item dans la base de donn\xe9es.\r\n    /// </summary>\r\n    /// <param name="item">L\'item \xe0 supprimer</param>\r\n    /// <param name="enregistrer">Enregistrer imm\xe9diatement ou non dans la base de donn\xe9es</param>\r\n    void Supprimer(TData item, bool enregistrer);\r\n\r\n    /// <summary>\r\n    /// Enregistrer l\'\xe9tat actuel du contexte dans la base de donn\xe9es en asynchrone.\r\n    /// </summary>\r\n    Task EnregistrerAsync();\r\n\r\n    /// <summary>\r\n    /// Enregistrer l\'\xe9tat actuel du contexte dans la base de donn\xe9es.\r\n    /// </summary>\r\n    void Enregistrer();\r\n}\n'})}),"\n",(0,s.jsxs)(r.p,{children:["\xc0 la ligne 7, il y a la d\xe9claration de l'interface avec un type g\xe9n\xe9rique.  Il est possible de renommer le ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"T"})})," pour un nom plus sp\xe9cifique ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"TData"})}),". Par convention, le type g\xe9n\xe9rique d\xe9bute toujours avec le pr\xe9fixe ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"T"})}),"."]}),"\n",(0,s.jsxs)(r.p,{children:["Il est possible de mettre des contraintes au type g\xe9n\xe9rique. Le mot-cl\xe9 ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"where"})})," permet de sp\xe9cifier les contraintes. Dans ce cas-ci, il est seulement possible de sp\xe9cifier un type qui est une classe. Donc, il n'est pas possible de sp\xe9cifier ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"IBaseRepo<int>"})}),", car le type ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"int"})})," n'est pas une classe, mais un type primitif."]}),"\n",(0,s.jsxs)(r.p,{children:["Pour plus d'information pour le ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"where"})})," ",(0,s.jsx)(r.a,{href:"https://learn.microsoft.com/fr-ca/dotnet/csharp/language-reference/keywords/where-generic-type-constraint",children:"https://learn.microsoft.com/fr-ca/dotnet/csharp/language-reference/keywords/where-generic-type-constraint"})]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"public interface IBaseRepo<TData> where TData : class\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Pour chacune des m\xe9thodes, il y a le ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"TData"})})," pour le type d'un param\xe8tre ou pour le retour."]}),"\n",(0,s.jsxs)(r.p,{children:["\xc9galement, l'application doit pouvoir fonctionner en ",(0,s.jsx)(r.strong,{children:"asynchrone"}),". Par convention en ",(0,s.jsx)(r.strong,{children:"C#"}),", une m\xe9thode ",(0,s.jsx)(r.strong,{children:"asynchrone"})," doit avoir le suffixe ",(0,s.jsx)(r.strong,{children:"Async"}),", mais ce n'est pas obligatoire. De plus, les m\xe9thodes doivent retourner un type ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"Task"})})," ou ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"Task<T>"})}),". L'explication du fonctionnement de l'asynchrone sera expliqu\xe9e dans la partie 2. Il faut \xe9galement le m\xe9thode ",(0,s.jsx)(r.strong,{children:"synchrone"}),", car selon le cas d'utilisation, l'appel peut \xeatre obligatoirement synchrone."]}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez la classe ",(0,s.jsx)(r.strong,{children:"BaseRepo"})," dans le dossier ",(0,s.jsx)(r.strong,{children:"Repositories\\Bases"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"using Microsoft.EntityFrameworkCore;\r\nusing SuperCarte.EF.Data.Context;\r\n\r\nnamespace SuperCarte.Core.Repositories.Bases;\r\n\r\n/// <summary>\r\n/// Classe abstraite g\xe9n\xe9rique qui contient les op\xe9rations de base des tables de la base de donn\xe9es\r\n/// </summary>\r\n/// <typeparam name=\"TData\">Type du mod\xe8le de donn\xe9es / table</typeparam>\r\npublic class BaseRepo<TData> : IBaseRepo<TData> where TData : class\r\n{\r\n    protected readonly SuperCarteContext _bd;\r\n\r\n    /// <summary>\r\n    /// Constructeur\r\n    /// </summary>\r\n    /// <param name=\"bd\">Contexte de la base de donn\xe9es</param>\r\n    public BaseRepo(SuperCarteContext bd)\r\n    {\r\n        _bd = bd;\r\n    }\r\n\r\n    public async Task<List<TData>> ObtenirListeAsync()\r\n    {\r\n        //\xc9quivalent \xe0 _db.TData.ToListAsync();\r\n        return await _bd.Set<TData>().ToListAsync();\r\n    }\r\n\r\n    public List<TData> ObtenirListe()\r\n    {\r\n        //\xc9quivalent \xe0 _db.TData.ToList();\r\n        return _bd.Set<TData>().ToList();\r\n    }\r\n\r\n    public async Task AjouterAsync(TData item, bool enregistrer)\r\n    {\r\n        //Add est d\xe9j\xe0 g\xe9n\xe9rique.\r\n        //Sa d\xe9finition r\xe9elle est _bd.Add<TData>().\r\n        _bd.Add(item);\r\n\r\n        //V\xe9rifie si l'ajout doit \xeatre appliqu\xe9 dans la base de donn\xe9es imm\xe9diatement\r\n        if (enregistrer == true)\r\n        {\r\n            //L'ajout doit \xeatre appliqu\xe9 dans la base de donn\xe9es imm\xe9diatement\r\n            await _bd.SaveChangesAsync();\r\n        }\r\n        else\r\n        {\r\n            //L'ajout est seulement en m\xe9moire\r\n            await Task.CompletedTask;\r\n        }\r\n    }\r\n\r\n    public void Ajouter(TData item, bool enregistrer)\r\n    {\r\n        //Add est d\xe9j\xe0 g\xe9n\xe9rique.\r\n        //Sa d\xe9finition r\xe9elle est _bd.Add<TData>().\r\n        _bd.Add(item);\r\n\r\n        //V\xe9rifie si l'ajout doit \xeatre appliqu\xe9 dans la base de donn\xe9es imm\xe9diatement\r\n        if (enregistrer == true)\r\n        {\r\n            //L'ajout doit \xeatre appliqu\xe9 dans la base de donn\xe9es imm\xe9diatement\r\n            _bd.SaveChanges();\r\n        }\r\n    }\r\n\r\n    public async Task AjouterAsync(List<TData> lstItem, bool enregistrer)\r\n    {\r\n        //AddRange est d\xe9j\xe0 g\xe9n\xe9rique.\r\n        //Sa d\xe9finition r\xe9elle est _bd.AddRange<TData>().\r\n        _bd.AddRange(lstItem);\r\n\r\n        //V\xe9rifie si l'ajout doit \xeatre appliqu\xe9 dans la base de donn\xe9es imm\xe9diatement\r\n        if (enregistrer == true)\r\n        {\r\n            //L'ajout doit \xeatre appliqu\xe9 dans la base de donn\xe9es imm\xe9diatement\r\n            await _bd.SaveChangesAsync();\r\n        }\r\n        else\r\n        {\r\n            //L'ajout est seulement en m\xe9moire\r\n            await Task.CompletedTask;\r\n        }\r\n    }\r\n\r\n    public void Ajouter(List<TData> lstItem, bool enregistrer)\r\n    {\r\n        //AddRange est d\xe9j\xe0 g\xe9n\xe9rique.\r\n        //Sa d\xe9finition r\xe9elle est _bd.AddRange<TData>().\r\n        _bd.AddRange(lstItem);\r\n\r\n        //V\xe9rifie si l'ajout doit \xeatre appliqu\xe9 dans la base de donn\xe9es imm\xe9diatement\r\n        if (enregistrer == true)\r\n        {\r\n            //L'ajout doit \xeatre appliqu\xe9 dans la base de donn\xe9es imm\xe9diatement\r\n            _bd.SaveChanges();\r\n        }\r\n    }\r\n\r\n    public async Task SupprimerAsync(TData item, bool enregistrer)\r\n    {\r\n        //Remove est d\xe9j\xe0 g\xe9n\xe9rique.\r\n        //Sa d\xe9finition r\xe9elle est _bd.Remove<TData>().\r\n        _bd.Remove(item);\r\n\r\n        //V\xe9rifie si la suppression doit \xeatre appliqu\xe9e dans la base de donn\xe9es imm\xe9diatement\r\n        if (enregistrer == true)\r\n        {\r\n            //La suppression doit \xeatre appliqu\xe9e dans la base de donn\xe9es imm\xe9diatement\r\n            await _bd.SaveChangesAsync();\r\n        }\r\n        else\r\n        {\r\n            //La suppression est seulement en m\xe9moire\r\n            await Task.CompletedTask;\r\n        }\r\n    }\r\n\r\n    public void Supprimer(TData item, bool enregistrer)\r\n    {\r\n        //Remove est d\xe9j\xe0 g\xe9n\xe9rique.\r\n        //Sa d\xe9finition r\xe9elle est _bd.Remove<TData>().\r\n        _bd.Remove(item);\r\n\r\n        //V\xe9rifie si la suppression doit \xeatre appliqu\xe9e dans la base de donn\xe9es imm\xe9diatement\r\n        if (enregistrer == true)\r\n        {\r\n            //La suppression doit \xeatre appliqu\xe9e dans la base de donn\xe9es imm\xe9diatement\r\n            _bd.SaveChanges();\r\n        }\r\n    }\r\n\r\n    public async Task SupprimerAsync(List<TData> lstItem, bool enregistrer)\r\n    {\r\n        //RemoveRange est d\xe9j\xe0 g\xe9n\xe9rique.\r\n        //Sa d\xe9finition r\xe9elle est _bd.RemoveRange<TData>().        \r\n        _bd.RemoveRange(lstItem);\r\n\r\n        //V\xe9rifie si la suppression doit \xeatre appliqu\xe9e dans la base de donn\xe9es imm\xe9diatement\r\n        if (enregistrer == true)\r\n        {\r\n            //La suppression doit \xeatre appliqu\xe9e dans la base de donn\xe9es imm\xe9diatement\r\n            await _bd.SaveChangesAsync();\r\n        }\r\n        else\r\n        {\r\n            //La suppression est seulement en m\xe9moire\r\n            await Task.CompletedTask;\r\n        }\r\n    }\r\n\r\n    public void Supprimer(List<TData> lstItem, bool enregistrer)\r\n    {\r\n        //RemoveRange est d\xe9j\xe0 g\xe9n\xe9rique.\r\n        //Sa d\xe9finition r\xe9elle est _bd.RemoveRange<TData>().        \r\n        _bd.RemoveRange(lstItem);\r\n\r\n        //V\xe9rifie si la suppression doit \xeatre appliqu\xe9e dans la base de donn\xe9es imm\xe9diatement\r\n        if (enregistrer == true)\r\n        {\r\n            //La suppression doit \xeatre appliqu\xe9e dans la base de donn\xe9es imm\xe9diatement\r\n            _bd.SaveChanges();\r\n        }\r\n    }\r\n    public async Task EnregistrerAsync()\r\n    {\r\n        //Enregistre les ajouts, modifications et suppression en attente dans la m\xe9moire du contexte\r\n        await _bd.SaveChangesAsync();\r\n    }\r\n\r\n    public void Enregistrer()\r\n    {\r\n        //Enregistre les ajouts, modifications et suppressions en attente dans la m\xe9moire du contexte\r\n        _bd.SaveChanges();\r\n    }\r\n}\n"})}),"\n",(0,s.jsx)(r.p,{children:"Les m\xe9thodes ressemblent \xe0 ce que vous avez d\xe9j\xe0 fait, mais elles sont g\xe9n\xe9riques."}),"\n",(0,s.jsxs)(r.p,{children:["\xc9galement, le contexte utilise des m\xe9thodes ",(0,s.jsx)(r.strong,{children:"asynchrones"}),". Pour y avoir acc\xe8s, il faut inclure ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"using Microsoft.EntityFrameworkCore;"})}),"."]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"ToListAsync()"})})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"SaveChangesAsync()"})})}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:["La d\xe9claration de la classe ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"public class BaseRepo<TData> : IBaseRepo<TData> where TData : class"})})," doit \xe9galement inclure le ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"<TData>"})}),". Elle doit la r\xe9pliquer dans l'impl\xe9mentation de l'interface avec la m\xeame contrainte ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"where"})}),". Retirez le ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"where"})})," et le compilateur indiquera que la classe est en erreur."]}),"\n",(0,s.jsx)(r.h3,{id:"obtenir-un-enregistrement-sp\xe9cifique-par-sa-cl\xe9",children:"Obtenir un enregistrement sp\xe9cifique par sa cl\xe9"}),"\n",(0,s.jsx)(r.p,{children:"Une op\xe9ration de base dans les op\xe9rations de la base de donn\xe9es est d'obtenir un enregistrement sp\xe9cifique en fonction de sa cl\xe9 primaire."}),"\n",(0,s.jsx)(r.p,{children:"Le nom du champ de la cl\xe9 primaire change pour chacune des tables. G\xe9n\xe9ralement, le type de la cl\xe9 primaire un entier, mais ce n'est pas une garantie."}),"\n",(0,s.jsx)(r.p,{children:"Il y a aussi le cas d'une cl\xe9 primaire compos\xe9e."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"//Cl\xe9 avec nom diff\xe9rent\r\nCarte carte = _bd.CarteTb.Where(c => c.CarteId == carteId).FirtOrDefault();\r\nUtilisateur utilisateur = _bd.UtilisateurTb.Where(c => c.UtilisateurId == utilisateurId).FirtOrDefault();\r\n\r\n//Cl\xe9 pas un entier. DA est une string, car les DA peuvent d\xe9buter par 0, pour ceux qui ont \xe9t\xe9 inscrits entre 2000 et 2009\r\nEtudiant etudiant = _bd.EtudiantTb.Where(e => e.DA == da).FirstOrDefault();\r\n\r\n//Cl\xe9 compos\xe9e\r\nUtilisateurCarte utilisateurCarte = _bd.UtilisateurCarteTb.Where(uc => uc.CarteId == carteId && uc.utilisateurId == UtilisateurId).FirtOrDefault();\n"})}),"\n",(0,s.jsx)(r.p,{children:"Est-ce possible de g\xe9n\xe9raliser ceci ? Oui et non."}),"\n",(0,s.jsxs)(r.p,{children:["Le ",(0,s.jsx)(r.strong,{children:"contexte"})," poss\xe8de une m\xe9thode ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"Find()"})})," ou ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"FindAsync()"})}),". Cette m\xe9thode permet de recevoir un enregistrement en fonction de sa cl\xe9 primaire."]}),"\n",(0,s.jsxs)(r.p,{children:["Cette m\xe9thode peut recevoir un ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"params object?[]? keyValues "})}),". Le type est ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"object"})}),", donc il peut recevoir une cl\xe9 en ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"int"})}),", en ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"string"})}),", etc. selon le cas."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"//Cl\xe9 avec nom diff\xe9rent\r\nCarte carte = _bd.CarteTb.Find(carteId).FirtOrDefault();\r\nUtilisateur utilisateur = _bd.UtilisateurTb.Find(utilisateurId).FirtOrDefault();\r\n\r\n//Cl\xe9 pas un entier. DA est une string, car les DA peuvent d\xe9buter par 0, pour ceux qui ont \xe9t\xe9 inscrits entre 2000 et 2009\r\nEtudiant etudiant = _bd.EtudiantTb.Find(da).FirstOrDefault();\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Le mot-cl\xe9 ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"params"})})," d'ajouter des param\xe8tres illimit\xe9s (max r\xe9el de 65 535) \xe0 la m\xe9thode. Donc il est possible de faire ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:'Find(1, "2", new DateTime(2022, 1, 3), 10.3m, true)'})})," ou ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"Find(1, 2, 3)"})}),".  En r\xe9alit\xe9, il faudrait envoyer un tableau ",(0,s.jsx)(r.strong,{children:"object[]"})," en param\xe8tre, mais le mot-cl\xe9 ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"params"})})," permet de le cr\xe9er lors de l'appel de la m\xe9thode en fusionnant les param\xe8tres. Donc **",(0,s.jsx)(r.code,{children:"Find(1, 2, 3)"})," ** est en r\xe9alit\xe9 ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"Find(new object{1, 2, 3})"})}),". Pour plus d'information pour le ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"params"})})," ",(0,s.jsx)(r.a,{href:"https://learn.microsoft.com/fr-ca/dotnet/csharp/language-reference/keywords/params",children:"https://learn.microsoft.com/fr-ca/dotnet/csharp/language-reference/keywords/params"})]}),"\n",(0,s.jsx)(r.p,{children:"Il est donc possible de r\xe9cup\xe9rer un enregistrement qui a une cl\xe9 primaire compos\xe9e."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"UtilisateurCarte utilisateurCarte1 = _bd.UtilisateurCarteTb.Find(carteId, utilisateurId).FirtOrDefault();\r\nUtilisateurCarte utilisateurCarte2 = _bd.UtilisateurCarteTb.Find(utilisateurId, carte).FirtOrDefault();\n"})}),"\n",(0,s.jsxs)(r.p,{children:["L'ordre des cl\xe9s a-t-il son importance ? La r\xe9ponse est ",(0,s.jsx)(r.strong,{children:"oui"}),". Lequel des 2 appels est la bonne ? Il faut retourner dans la m\xe9thode ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"OnModelCreating"})})," du ",(0,s.jsx)(r.strong,{children:"contexte"})," pour voir dans quel ordre les cl\xe9s ont \xe9t\xe9 sp\xe9cifi\xe9es."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"entity.HasKey(t => new { t.UtilisateurId, t.CarteId });\n"})}),"\n",(0,s.jsxs)(r.p,{children:["C'est donc ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"UtilisateurCarte utilisateurCarte2 = _bd.UtilisateurCarteTb.Find(utilisateurId, carte).FirtOrDefault();"})})," qui serait la bonne. Il est possible de g\xe9n\xe9raliser la m\xe9thode ",(0,s.jsx)(r.strong,{children:"Find"})," dans le ",(0,s.jsx)(r.strong,{children:"Repo"}),", mais il faut l'encadrer."]}),"\n",(0,s.jsxs)(r.p,{children:["Le ",(0,s.jsx)(r.strong,{children:"Repo"})," g\xe9n\xe9rique ne permettra pas la gestion des cl\xe9s multiples, car il y a trop de risque d'erreur que le programmeur doive toujours valider l'ordre des cl\xe9s primaires. Ce sera une m\xe9thode sp\xe9cifique pour les tables qui ont une cl\xe9 primaire compos\xe9e."]}),"\n",(0,s.jsx)(r.p,{children:"La m\xe9thode g\xe9n\xe9rique ressemblerait \xe0 celle-ci."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"public Task<TData?> ObtenirParCleAsync(int id)\r\n{\r\n\treturn await _bd.FindAsync<TData>(id);\r\n}\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Il y a 1 probl\xe8me dans cette m\xe9thode. Elle fonctionne uniquement pour une cl\xe9 primaire qui est un ",(0,s.jsx)(r.strong,{children:"entier"}),"."]}),"\n",(0,s.jsx)(r.p,{children:"Il est possible de mettre plusieurs types g\xe9n\xe9riques dans une classe."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"public class BaseRepo<TData, TClePrimaire> : IBaseRepo<TData, TClePrimaire> where TData : class\r\n{\r\n    /**\r\n     Code retir\xe9 pour simplifier\r\n    */\r\n    public Task<TData?> ObtenirParCleAsync(TClePrimaire clePrimaire)\r\n    {\r\n        return await _bd.FindAsync<TData>(clePrimaire);\r\n    }\r\n}\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Le nombre de types g\xe9n\xe9riques d'une classe n'est pas limit\xe9 \xe0 1 uniquement. Il suffit de mettre une virgule dans le **",(0,s.jsx)(r.code,{children:"<>"})," ** pour ajouter des types g\xe9n\xe9riques, par exemple  ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"<T1, T2, T3, T4>"})})," . Lorsqu'il y a plusieurs types g\xe9n\xe9riques, il est important de les nommer avec un nom significatif."]}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"TClePrimaire"})})," sert uniquement pour le param\xe8tre de la m\xe9thode ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"ObtenirParCleAsync()"})}),"."]}),"\n",(0,s.jsxs)(r.p,{children:["Mais est-ce le bon endroit pour mettre cette m\xe9thode ? Que devra-t-il \xeatre sp\xe9cifi\xe9 pour la table ",(0,s.jsx)(r.strong,{children:"UtilisateurCarte"})," ? Dans le cas ci-dessous, ce sera ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"int"})}),", mais si le programmeur utilise quand m\xeame la m\xe9thode ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"ObtenirParCleAsync()"})}),", il y aura une exception."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"var utilisateurCarteRepo BaseRepo<UtilisateurCarte, int>();\r\n\r\n//La valeur 1 est-ce carteId ou utilisateurId ???\r\nutilisateurCarteRepo.ObtenirParCleAsync(1); //Il y aura une exception \"System.ArgumentException\xa0: 'Entity type 'UtilisateurCarte' is defined with a 2-part composite key, but 1 values were passed to the 'Find' method.'\r\n\"\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Cette approche va contre les principes ",(0,s.jsx)(r.strong,{children:"SOLID"}),". Il s'agit du ",(0,s.jsx)(r.strong,{children:"L (Liskov substitution)"}),". \xc7a ne s'applique pas n\xe9cessairement au type g\xe9n\xe9rique dans sa d\xe9finition pure, mais l'id\xe9e est tout de m\xeame respect\xe9e. Ce principe consiste qu'une classe de **Base ** doit fonctionner pour tous les types de donn\xe9es. Il ne doit pas avoir de m\xe9thode disponible dans une classe dont le programmeur sait qu'un cas particulier va g\xe9n\xe9rer une exception si elle est utilis\xe9e. Donc par conception, le programmeur concepteur sait que la m\xe9thode ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"ObtenirParCleAsync()"})})," va g\xe9n\xe9rer une exception pour le mod\xe8le de donn\xe9es ",(0,s.jsx)(r.strong,{children:"UtilisateurCarte"}),". Le programmeur qui n'est pas concepteur et qui voit cette m\xe9thode disponible, ne saura pas n\xe9cessairement qu'il ne peut pas l'utiliser, d'o\xf9 l'importance de respecter le ",(0,s.jsx)(r.strong,{children:"L"})," de ",(0,s.jsx)(r.strong,{children:"SOLID"}),"."]}),"\n",(0,s.jsx)(r.p,{children:"La solution a ce probl\xe8me est de cr\xe9er une classe de base interm\xe9diaire."}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez l'interface ",(0,s.jsx)(r.strong,{children:"IBasePKUniqueRepo"})," dans le dossier ",(0,s.jsx)(r.strong,{children:"Repositories\\Bases"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:'namespace SuperCarte.Core.Repositories.Bases;\r\n\r\n/// <summary>\r\n/// Interface g\xe9n\xe9rique qui contient les op\xe9rations de base des tables de la base de donn\xe9es pour une table \xe0 cl\xe9 primaire unique\r\n/// </summary>\r\n/// <typeparam name="TData">Type du mod\xe8le de donn\xe9es / table</typeparam>\r\n/// <typeparam name="TClePrimaire">Type de la cl\xe9 primaire</typeparam>\r\npublic interface IBasePKUniqueRepo<TData, TClePrimaire> : IBaseRepo<TData> where TData : class\r\n{\r\n    /// <summary>\r\n    /// Obtenir un item sp\xe9cifique en fonction de sa cl\xe9 primaire en asynchrone.\r\n    /// </summary>\r\n    /// <param name="clePrimaire">Valeur de la cl\xe9 primaire</param>\r\n    /// <returns>L\'item ou null si non trouv\xe9</returns>\r\n    Task<TData?> ObtenirParCleAsync(TClePrimaire clePrimaire);\r\n\r\n    /// <summary>\r\n    /// Obtenir un item sp\xe9cifique en fonction de sa cl\xe9 primaire.\r\n    /// </summary>\r\n    /// <param name="clePrimaire">Valeur de la cl\xe9 primaire</param>\r\n    /// <returns>L\'item ou null si non trouv\xe9</returns>\r\n    TData? ObtenirParCle(TClePrimaire clePrimaire);\r\n\r\n    /// <summary>\r\n    /// Suprimer un item sp\xe9cifique en fonction de sa cl\xe9 primaire en asynchrone.\r\n    /// </summary>\r\n    /// <param name="clePrimaire">Valeur de la cl\xe9 primaire</param>    \r\n    /// <param name="enregistrer">Enregistrer imm\xe9diatement ou non dans la base de donn\xe9es</param>\r\n    Task SupprimerParCleAsync(TClePrimaire clePrimaire, bool enregistrer);\r\n\r\n    /// <summary>\r\n    /// Suprimer un item sp\xe9cifique en fonction de sa cl\xe9 primaire.\r\n    /// </summary>\r\n    /// <param name="clePrimaire">Valeur de la cl\xe9 primaire</param>    \r\n    /// <param name="enregistrer">Enregistrer imm\xe9diatement ou non dans la base de donn\xe9es</param>\r\n    void SupprimerParCle(TClePrimaire clePrimaire, bool enregistrer);\r\n}\n'})}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez la classe ",(0,s.jsx)(r.strong,{children:"BasePKUniqueRepo"})," dans le dossier ",(0,s.jsx)(r.strong,{children:"Repositories\\Bases"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:'using SuperCarte.EF.Data.Context;\r\n\r\nnamespace SuperCarte.Core.Repositories.Bases;\r\n\r\n// <summary>\r\n/// Classe abstraite g\xe9n\xe9rique qui contient les op\xe9rations de base des tables de la base de donn\xe9es pour une table \xe0 cl\xe9 primaire unique\r\n/// </summary>\r\n/// <typeparam name="TData">Type du mod\xe8le de donn\xe9es / table</typeparam>\r\n/// <typeparam name="TClePrimaire">Type de la cl\xe9 primaire</typeparam>\r\npublic abstract class BasePKUniqueRepo<TData, TClePrimaire> : BaseRepo<TData>, IBasePKUniqueRepo<TData, TClePrimaire> where TData : class\r\n{\r\n    /// <summary>\r\n    /// Constructeur\r\n    /// </summary>\r\n    /// <param name="bd">Contexte de la base de donn\xe9es</param>\r\n    public BasePKUniqueRepo(SuperCarteContext bd) : base(bd)\r\n    {\r\n        //Vide, il sert uniquement a recevoir le contexte et \xe0 l\'envoyer \xe0 la classe parent.\r\n    }\r\n\r\n    public async Task<TData?> ObtenirParCleAsync(TClePrimaire clePrimaire)\r\n    {\r\n        return await _bd.FindAsync<TData>(clePrimaire);\r\n    }\r\n\r\n    public TData? ObtenirParCle(TClePrimaire clePrimaire)\r\n    {\r\n        return _bd.Find<TData>(clePrimaire);\r\n    }\r\n\r\n    public async Task SupprimerParCleAsync(TClePrimaire clePrimaire, bool enregistrer)\r\n    {\r\n        TData? item = await ObtenirParCleAsync(clePrimaire);\r\n\r\n        //V\xe9rifie si un item a \xe9t\xe9 trouv\xe9 avec la cl\xe9 sp\xe9cifi\xe9e\r\n        if (item != null)\r\n        {\r\n            //Il y a un item avec la cl\xe9 sp\xe9cifi\xe9e\r\n            await SupprimerAsync(item, enregistrer);\r\n        }\r\n        else\r\n        {\r\n            //Il n\'y a pas d\'item avec la cl\xe9 sp\xe9cifi\xe9e\r\n            throw new Exception("Impossible de trouver l\'item \xe0 supprimer avec la cl\xe9 sp\xe9cifi\xe9e.");\r\n        }\r\n    }\r\n\r\n    public void SupprimerParCle(TClePrimaire clePrimaire, bool enregistrer)\r\n    {\r\n        TData? item = ObtenirParCle(clePrimaire);\r\n\r\n        //V\xe9rifie si un item a \xe9t\xe9 trouv\xe9 avec la cl\xe9 sp\xe9cifi\xe9e\r\n        if (item != null)\r\n        {\r\n            //Il y a un item avec la cl\xe9 sp\xe9cifi\xe9e\r\n            Supprimer(item, enregistrer);\r\n        }\r\n        else\r\n        {\r\n            //Il n\'y a pas d\'item avec la cl\xe9 sp\xe9cifi\xe9e\r\n            throw new Exception("Impossible de trouver l\'item \xe0 supprimer avec la cl\xe9 sp\xe9cifi\xe9e.");\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,s.jsxs)(r.p,{children:["La classe a 2 m\xe9thodes sp\xe9cifiques aux tables avec une cl\xe9 primaire unique. Il est possible d'obtenir un item \xe0 partir de sa cl\xe9 primaire et de le supprimer. Il y la version ",(0,s.jsx)(r.strong,{children:"synchrone"})," et ",(0,s.jsx)(r.strong,{children:"asynchrone"}),"."]}),"\n",(0,s.jsx)(r.h3,{id:"utilisation-du-repository---th\xe9orie",children:"Utilisation du Repository - Th\xe9orie"}),"\n",(0,s.jsxs)(r.p,{children:["Pour utiliser un ",(0,s.jsx)(r.strong,{children:"Repository"})," g\xe9n\xe9rique, il faut l'injecter comme ceci. Voici l'exemple pour ",(0,s.jsx)(r.strong,{children:"Carte"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"public classe CarteService\r\n{\r\n\tprivate readonly IBasePKUniqueRepo<Carte, int> _baseRepoCarte;\r\n    \r\n\tpublic CarteService(IBasePKUniqueRepo<Carte, int> baseRepoCarte)\r\n\t{\r\n\t\t_baseRepoCarte = baseRepoCarte;\r\n\t}\r\n}\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Par contre, si le logiciel doit obtenir les cartes qui ont plus de 10 points de vie, il faut une requ\xeate sp\xe9cifique dans le ",(0,s.jsx)(r.strong,{children:"Repository"}),"."]}),"\n",(0,s.jsxs)(r.p,{children:["Il faut avoir une classe ",(0,s.jsx)(r.strong,{children:"CarteRepo"}),"."]}),"\n",(0,s.jsx)(r.p,{children:"Il y a 2 options."}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsxs)(r.p,{children:["Utiliser 2 ",(0,s.jsx)(r.strong,{children:"Repositories"})," par mod\xe8le de donn\xe9es."]}),"\n",(0,s.jsxs)(r.p,{children:["Pour les mod\xe8les qui n\xe9cessitent des requ\xeates sp\xe9cifiques, il serait possible d'injecter les 2 ",(0,s.jsx)(r.strong,{children:"Repositories"})," dans le ",(0,s.jsx)(r.strong,{children:"Service"}),"."]}),"\n",(0,s.jsxs)(r.p,{children:["Voici l'interface et la classe du ",(0,s.jsx)(r.strong,{children:"Repository"})," sp\xe9cifique."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"public interface ICarteRepo\r\n{\r\n\tList<Carte> ObtenirListeParPointVieMin(int vie);\r\n}\r\n\r\npublic classe CarteRepoICarteService\r\n{\r\n    private readonly SuperCarteContext _bd;\r\n    \r\n    public CarteRepo(SuperCarteContext bd)\r\n    {\r\n        _bd = bd;\r\n    }\r\n    \r\n\tpublic List<Carte> ObtenirListeParPointVieMin(int vie)\r\n    {\r\n        return _bd.CarteTb.Where(c => c.vie >= vie).ToList();\r\n    }\r\n}\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Et l'injection dans le ",(0,s.jsx)(r.strong,{children:"Service"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"public classe CarteService\r\n{\r\n\tprivate readonly IBaseRepo<Carte> _carteBaseRepo;\r\n\tprivate readonly ICarteRepo _carteSpecificRepo;\r\n    \r\n\tpublic CarteService(IBaseRepo<Carte> _carteBaseRepo, ICarteRepo _carteSpecificRepo)\r\n\t{\r\n\t\t_carteBaseRepo = carteBaseRepo;\r\n\t\t_carteSpecificRepo = carteSpecificRepo;\r\n\t}\r\n}\n"})}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsxs)(r.p,{children:["H\xe9riter de ",(0,s.jsx)(r.strong,{children:"BaseRepo"}),"."]}),"\n",(0,s.jsxs)(r.p,{children:["Il y aurait seulement un ",(0,s.jsx)(r.strong,{children:"Repository"}),". Le ",(0,s.jsx)(r.strong,{children:"Repository"})," sp\xe9cifique h\xe9riterait du ",(0,s.jsx)(r.strong,{children:"Repository"})," g\xe9n\xe9rique de base."]}),"\n",(0,s.jsxs)(r.p,{children:["Voici l'interface et la classe du ",(0,s.jsx)(r.strong,{children:"Repository"})," sp\xe9cifique."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"public interface ICarteRepo : IBasePKUniqueRepo<Carte,int>\r\n{\r\n\tList<Carte> ObtenirListeParPointVieMin(int vie);\r\n}\r\n\r\npublic classe CarteRepo : BasePKUniqueRepo<Carte,int>, ICarteService\r\n{   \r\n    public CarteRepo(SuperCarteContext bd) : base(bd)\r\n    {\r\n        \r\n    }\r\n    \r\n\tpublic List<Carte> ObtenirListeParPointVieMin(int vie)\r\n    {\r\n        return _bd.CarteTb.Where(c => c.vie >= vie).ToList();\r\n    }\r\n}\r\n\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Et l'injection dans le ",(0,s.jsx)(r.strong,{children:"Service"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"public classe CarteService\r\n{\r\n\tprivate readonly ICarteRepo _carteRepo;\r\n    \r\n\tpublic CarteService(ICarteRepo _carteRepo)\r\n\t{\r\n\t\t_carteRepo = carteRepo;\r\n\t}\r\n}\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:"Les 2 approches ont leurs avantages et leurs inconv\xe9nients."}),"\n",(0,s.jsxs)(r.p,{children:["L'approche par h\xe9ritage permet d'avoir un seul ",(0,s.jsx)(r.strong,{children:"Repository"})," qui contient toutes les m\xe9thodes n\xe9cessaires \xe0 l'entit\xe9. Par contre, ce n'est pas tous les ",(0,s.jsx)(r.strong,{children:"Repository"})," qui n\xe9cessitent des requ\xeates sp\xe9cifiques. Dans une approche standardis\xe9e, il pourrait \xeatre exig\xe9 au programmeur de cr\xe9er des classes sp\xe9cifiques, m\xeame s'il n'y a pas de requ\xeate sp\xe9cifique."]}),"\n",(0,s.jsxs)(r.p,{children:["Dans une approche non standardis\xe9e, il faudrait injecter le ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"BaseRepo<TData>"})})," dans le service lorsqu'il n'y a pas de requ\xeates sp\xe9cifiques. Si un jour, il faut ajouter une requ\xeate sp\xe9cifique, il faut cr\xe9er le ",(0,s.jsx)(r.strong,{children:"Repository"})," sp\xe9cifique et modifier tous les services qui utilisaient le ",(0,s.jsx)(r.strong,{children:"Repository"})," de base. Ceci peut demander beaucoup de refactorisation. Donc, si l'approche par"]}),"\n",(0,s.jsxs)(r.p,{children:["L'approche avec 2 ",(0,s.jsx)(r.strong,{children:"Repositories"})," a l'avantage de cr\xe9er uniquement un ",(0,s.jsx)(r.strong,{children:"Repo"})," sp\xe9cialis\xe9 lorsque n\xe9cessaire. Par contre, le programmeur doit basculer d'un ",(0,s.jsx)(r.strong,{children:"Repository"})," \xe0 l'autre selon le contexte. Aussi, \xe0 chaque fois qu'il faut injecter le ",(0,s.jsx)(r.strong,{children:"Repository"})," de base, il faut s'assurer de sp\xe9cifier le type de la bonne cl\xe9 primaire. Rien n'emp\xeache \xe9galement d'injecter la mauvaise classe de base, par exemple ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"BaseRepo<Carte>"})}),"."]}),"\n",(0,s.jsx)(r.p,{children:"Si l'enregistrement des services est bien fait dans l'injection des d\xe9pendances, le programme g\xe9n\xe8rera une exception lorsque la mauvaise classe de base sera utilis\xe9e. Par contre, si le programmeur l'ajoute dans l'enregistrement sans valider l'existence des autres, le programme va devenir non uniforme et moins maintenable dans le temps."}),"\n",(0,s.jsxs)(r.p,{children:["Principalement pour la derni\xe8re raison, l'approche par h\xe9ritage sera utilis\xe9e et il faudra cr\xe9er la classe et l'interface sp\xe9cifique en tout temps, m\xeame si elle est vide. Le programme sera plus uniforme et plus facilement maintenable \xe0 long terme.  De plus, dans les applications d'envergure, les ",(0,s.jsx)(r.strong,{children:"entit\xe9s"})," sans aucune requ\xeate sp\xe9cifique sont assez rares."]}),"\n",(0,s.jsxs)(r.p,{children:["Remarquez que les classes ",(0,s.jsx)(r.strong,{children:"BaseRepo"})," et ",(0,s.jsx)(r.strong,{children:"BasePKUniqueRepo"})," ont \xe9t\xe9 d\xe9clar\xe9es d\xe8s le d\xe9part ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"abstract"})})," pour \xe9viter l'utilisation directe sans h\xe9ritage."]}),"\n",(0,s.jsx)(r.h2,{id:"cr\xe9ation-des-repositories-sp\xe9cifiques",children:"Cr\xe9ation des Repositories sp\xe9cifiques"}),"\n",(0,s.jsx)(r.p,{children:"Il faut cr\xe9er les classes sp\xe9cifiques qui h\xe9riteront de la classe de base correspondante."}),"\n",(0,s.jsx)(r.p,{children:"Pour l'instant, toutes les classes seront vides."}),"\n",(0,s.jsxs)(r.p,{children:["Toutes les classes et interfaces doivent \xeatre cr\xe9\xe9es dans le dossier ",(0,s.jsx)(r.strong,{children:"Repositories"}),"."]}),"\n",(0,s.jsx)(r.h3,{id:"rolerepo",children:"RoleRepo"}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez l'interface ",(0,s.jsx)(r.strong,{children:"IRoleRepo"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"using SuperCarte.Core.Repositories.Bases;\r\nusing SuperCarte.EF.Data;\r\n\r\nnamespace SuperCarte.Core.Repositories;\r\n\r\n/// <summary>\r\n/// Interface qui contient les m\xe9thodes de communication avec la base de donn\xe9es pour la table Role\r\n/// </summary>\r\npublic interface IRoleRepo : IBasePKUniqueRepo<Role,int>\r\n{\r\n}\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez la classe ",(0,s.jsx)(r.strong,{children:"RoleRepo"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:'using SuperCarte.Core.Repositories.Bases;\r\nusing SuperCarte.EF.Data;\r\nusing SuperCarte.EF.Data.Context;\r\n\r\nnamespace SuperCarte.Core.Repositories;\r\n\r\n/// <summary>\r\n/// Classe qui contient les m\xe9thodes de communication avec la base de donn\xe9es pour la table Role\r\n/// </summary>\r\npublic class RoleRepo : BasePKUniqueRepo<Role,int>, IRoleRepo\r\n{\r\n    /// <summary>\r\n    /// Constructeur\r\n    /// </summary>\r\n    /// <param name="bd">Contexte de la base de donn\xe9es</param>\r\n    public RoleRepo(SuperCarteContext bd) : base(bd)\r\n\t{\r\n        //Vide, il sert uniquement a recevoir le contexte et \xe0 l\'envoyer \xe0 la classe parent.\r\n    }\r\n}\n'})}),"\n",(0,s.jsxs)(r.p,{children:["La classe h\xe9rite de ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"BasePKUniqueRepo<Role,int>"})}),", car il y a seulement une cl\xe9 primaire et c'est un entier."]}),"\n",(0,s.jsx)(r.h3,{id:"utilisateurrepo",children:"UtilisateurRepo"}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez l'interface ",(0,s.jsx)(r.strong,{children:"IUtilisateurRepo"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"using SuperCarte.Core.Repositories.Bases;\r\nusing SuperCarte.EF.Data;\r\n\r\nnamespace SuperCarte.Core.Repositories;\r\n\r\n/// <summary>\r\n/// Interface qui contient les m\xe9thodes de communication avec la base de donn\xe9es pour la table Utilisateur\r\n/// </summary>\r\npublic interface IUtilisateurRepo : IBasePKUniqueRepo<Utilisateur, int>\r\n{\r\n}\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez la classe ",(0,s.jsx)(r.strong,{children:"UtilisateurRepo"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:'using SuperCarte.Core.Repositories.Bases;\r\nusing SuperCarte.EF.Data;\r\nusing SuperCarte.EF.Data.Context;\r\n\r\nnamespace SuperCarte.Core.Repositories;\r\n\r\n/// <summary>\r\n/// Classe qui contient les m\xe9thodes de communication avec la base de donn\xe9es pour la table Utilisateur\r\n/// </summary>\r\npublic class UtilisateurRepo : BasePKUniqueRepo<Utilisateur, int>, IUtilisateurRepo\r\n{\r\n    /// <summary>\r\n    /// Constructeur\r\n    /// </summary>\r\n    /// <param name="bd">Contexte de la base de donn\xe9es</param>\r\n    public UtilisateurRepo(SuperCarteContext bd) : base(bd)\r\n    {\r\n        //Vide, il sert uniquement a recevoir le contexte et \xe0 l\'envoyer \xe0 la classe parent.\r\n    }\r\n}\n'})}),"\n",(0,s.jsxs)(r.p,{children:["La classe h\xe9rite de ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"BasePKUniqueRepo<Utilisateur,int>"})}),", car il y a seulement une cl\xe9 primaire et c'est un entier."]}),"\n",(0,s.jsx)(r.h3,{id:"ensemblerepo",children:"EnsembleRepo"}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez l'interface ",(0,s.jsx)(r.strong,{children:"IEnsembleRepo"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"using SuperCarte.Core.Repositories.Bases;\r\nusing SuperCarte.EF.Data;\r\n\r\nnamespace SuperCarte.Core.Repositories;\r\n\r\n/// <summary>\r\n/// Interface qui contient les m\xe9thodes de communication avec la base de donn\xe9es pour la table Ensemble\r\n/// </summary>\r\npublic interface IEnsembleRepo : IBasePKUniqueRepo<Ensemble, int>\r\n{\r\n}\r\n\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez la classe ",(0,s.jsx)(r.strong,{children:"EnsembleRepo"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:'using SuperCarte.Core.Repositories.Bases;\r\nusing SuperCarte.EF.Data;\r\nusing SuperCarte.EF.Data.Context;\r\n\r\nnamespace SuperCarte.Core.Repositories;\r\n\r\n/// <summary>\r\n/// Classe qui contient les m\xe9thodes de communication avec la base de donn\xe9es pour la table Ensemble\r\n/// </summary>\r\npublic class EnsembleRepo : BasePKUniqueRepo<Ensemble, int>, IEnsembleRepo\r\n{\r\n    /// <summary>\r\n    /// Constructeur\r\n    /// </summary>\r\n    /// <param name="bd">Contexte de la base de donn\xe9es</param>\r\n    public EnsembleRepo(SuperCarteContext bd) : base(bd)\r\n    {\r\n        //Vide, il sert uniquement a recevoir le contexte et \xe0 l\'envoyer \xe0 la classe parent.\r\n    }\r\n}\n'})}),"\n",(0,s.jsxs)(r.p,{children:["La classe h\xe9rite de ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"BasePKUniqueRepo<Ensemble,int>"})}),", car il y a seulement une cl\xe9 primaire et c'est un entier."]}),"\n",(0,s.jsx)(r.h3,{id:"categorierepo",children:"CategorieRepo"}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez l'interface ",(0,s.jsx)(r.strong,{children:"ICategorieRepo"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"using SuperCarte.Core.Repositories.Bases;\r\nusing SuperCarte.EF.Data;\r\n\r\nnamespace SuperCarte.Core.Repositories;\r\n\r\n/// <summary>\r\n/// Interface qui contient les m\xe9thodes de communication avec la base de donn\xe9es pour la table Categorie\r\n/// </summary>\r\npublic interface ICategorieRepo : IBasePKUniqueRepo<Categorie, int>\r\n{\r\n}\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez la classe ",(0,s.jsx)(r.strong,{children:"CategorieRepo"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:'using SuperCarte.Core.Repositories.Bases;\r\nusing SuperCarte.EF.Data;\r\nusing SuperCarte.EF.Data.Context;\r\n\r\nnamespace SuperCarte.Core.Repositories;\r\n\r\n/// <summary>\r\n/// Classe qui contient les m\xe9thodes de communication avec la base de donn\xe9es pour la table Categorie\r\n/// </summary>\r\npublic class CategorieRepo : BasePKUniqueRepo<Categorie, int>, ICategorieRepo\r\n{\r\n    /// <summary>\r\n    /// Constructeur\r\n    /// </summary>\r\n    /// <param name="bd">Contexte de la base de donn\xe9es</param>\r\n    public CategorieRepo(SuperCarteContext bd) : base(bd)\r\n    {\r\n        //Vide, il sert uniquement a recevoir le contexte et \xe0 l\'envoyer \xe0 la classe parent.\r\n    }\r\n}\r\n\n'})}),"\n",(0,s.jsxs)(r.p,{children:["La classe h\xe9rite de ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"BasePKUniqueRepo<Categorie,int>"})}),", car il y a seulement une cl\xe9 primaire et c'est un entier."]}),"\n",(0,s.jsx)(r.h3,{id:"carterepo",children:"CarteRepo"}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez l'interface ",(0,s.jsx)(r.strong,{children:"ICarteRepo"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"using SuperCarte.Core.Repositories.Bases;\r\nusing SuperCarte.EF.Data;\r\n\r\nnamespace SuperCarte.Core.Repositories;\r\n\r\n/// <summary>\r\n/// Interface qui contient les m\xe9thodes de communication avec la base de donn\xe9es pour la table Carte\r\n/// </summary>\r\npublic interface ICarteRepo : IBasePKUniqueRepo<Carte, int>\r\n{\r\n}\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez la classe ",(0,s.jsx)(r.strong,{children:"CarteRepo"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:'using SuperCarte.Core.Repositories.Bases;\r\nusing SuperCarte.EF.Data;\r\nusing SuperCarte.EF.Data.Context;\r\n\r\nnamespace SuperCarte.Core.Repositories;\r\n\r\n/// <summary>\r\n/// Classe qui contient les m\xe9thodes de communication avec la base de donn\xe9es pour la table Carte\r\n/// </summary>\r\npublic class CarteRepo : BasePKUniqueRepo<Carte, int>, ICarteRepo\r\n{\r\n    /// <summary>\r\n    /// Constructeur\r\n    /// </summary>\r\n    /// <param name="bd">Contexte de la base de donn\xe9es</param>\r\n    public CarteRepo(SuperCarteContext bd) : base(bd)\r\n    {\r\n        //Vide, il sert uniquement a recevoir le contexte et \xe0 l\'envoyer \xe0 la classe parent.\r\n    }\r\n}\n'})}),"\n",(0,s.jsxs)(r.p,{children:["La classe h\xe9rite de ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"BasePKUniqueRepo<Carte,int>"})}),", car il y a seulement une cl\xe9 primaire et c'est un entier."]}),"\n",(0,s.jsx)(r.h3,{id:"utilisateurcarterepo",children:"UtilisateurCarteRepo"}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez l'interface ",(0,s.jsx)(r.strong,{children:"IUtilisateurCarteRepoRepo"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"using SuperCarte.Core.Repositories.Bases;\r\nusing SuperCarte.EF.Data;\r\n\r\nnamespace SuperCarte.Core.Repositories;\r\n\r\n/// <summary>\r\n/// Interface qui contient les m\xe9thodes de communication avec la base de donn\xe9es pour la table Role\r\n/// </summary>\r\npublic interface IUtilisateurCarteRepo : IBaseRepo<UtilisateurCarte>\r\n{\r\n\r\n}\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez la classe ",(0,s.jsx)(r.strong,{children:"UtilisateurCarteRepoRepo"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:'using SuperCarte.Core.Repositories.Bases;\r\nusing SuperCarte.EF.Data;\r\nusing SuperCarte.EF.Data.Context;\r\n\r\nnamespace SuperCarte.Core.Repositories;\r\n\r\n/// <summary>\r\n/// Classe qui contient les m\xe9thodes de communication avec la base de donn\xe9es pour la table UtilisateurCarte\r\n/// </summary>\r\npublic class UtilisateurCarteRepo : BaseRepo<UtilisateurCarte>, IUtilisateurCarteRepo\r\n{\r\n    /// <summary>\r\n    /// Constructeur\r\n    /// </summary>\r\n    /// <param name="bd">Contexte de la base de donn\xe9es</param>\r\n    public UtilisateurCarteRepo(SuperCarteContext bd) : base(bd)\r\n    {\r\n        //Vide, il sert uniquement a recevoir le contexte et \xe0 l\'envoyer \xe0 la classe parent.\r\n    }\r\n}\n'})}),"\n",(0,s.jsxs)(r.p,{children:["La classe h\xe9rite de ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"BaseRepo<UtilisateurCarte>"})}),", car elle n'a pas de cl\xe9 primaire unique."]}),"\n",(0,s.jsx)(r.h1,{id:"pr\xe9paration-du-projet-wpf",children:"Pr\xe9paration du projet WPF"}),"\n",(0,s.jsx)(r.h2,{id:"cr\xe9ation-du-projet-dans-une-solution-existante",children:"Cr\xe9ation du projet dans une solution existante"}),"\n",(0,s.jsxs)(r.p,{children:["Il faut ajouter le projet ",(0,s.jsx)(r.strong,{children:"WPF"})," dans la solution."]}),"\n",(0,s.jsxs)(r.p,{children:["Pour ce faire, s\xe9lectionnez la solution ",(0,s.jsx)(r.strong,{children:"SuperCarteApp"})," en haut de l'",(0,s.jsx)(r.strong,{children:"Explorateur de solution"})," et choisissez ",(0,s.jsx)(r.strong,{children:"Ajouter -> Nouveau projet..."})," dans le menu contextuel."]}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez un projet de type ",(0,s.jsx)(r.strong,{children:"Application WPF"}),". Il est important ",(0,s.jsx)(r.strong,{children:"de ne pas choisir"})," la version ",(0,s.jsx)(r.strong,{children:".NET Framework"}),"."]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Nom du projet"})," : SuperCarte.WPF"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Infrastructure"})," : .NET 7"]}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:["Ensuite, s\xe9lectionnez le projet ",(0,s.jsx)(r.strong,{children:"SuperCarte.WPF"})," en haut de l'",(0,s.jsx)(r.strong,{children:"Explorateur de solution"})," et choisissez ",(0,s.jsx)(r.strong,{children:"D\xe9finir en tant que projet de d\xe9marrage"})," dans le menu contextuel."]}),"\n",(0,s.jsx)(r.h2,{id:"ajout-des-d\xe9pendances-de-projet-1",children:"Ajout des d\xe9pendances de projet"}),"\n",(0,s.jsxs)(r.p,{children:["Le projet ",(0,s.jsx)(r.strong,{children:"SuperCarte.WPF"})," aura besoin du projet ",(0,s.jsx)(r.strong,{children:"SuperCarte.EF"})," pour initialiser le contexte et ",(0,s.jsx)(r.strong,{children:"SuperCarte.Core"}),", car il utilisera des ",(0,s.jsx)(r.strong,{children:"services"}),"."]}),"\n",(0,s.jsx)(r.p,{children:"Il faut l'ajouter dans les d\xe9pendances du projet."}),"\n",(0,s.jsxs)(r.p,{children:["S\xe9lectionnez le dossier ",(0,s.jsx)(r.strong,{children:"D\xe9pendances"})," du projet ",(0,s.jsx)(r.strong,{children:"SuperCarte.WPF"})," et choisissez ",(0,s.jsx)(r.strong,{children:"Ajouter une r\xe9f\xe9rence de projet"})," dans le menu contextuel."]}),"\n",(0,s.jsxs)(r.p,{children:["Dans la fen\xeatre, il faut cocher ",(0,s.jsx)(r.strong,{children:"SuperCarte.EF"})," et ",(0,s.jsx)(r.strong,{children:"SuperCarte.Core"}),". Vous venez d'int\xe9grer 2 librairies internes au projet."]}),"\n",(0,s.jsx)(r.h2,{id:"fichier-usingscs",children:"Fichier Usings.cs"}),"\n",(0,s.jsxs)(r.p,{children:["Afin de r\xe9duire la taille des classes, les ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"using"})})," qui seront beaucoup utilis\xe9s dans ce projet seront d\xe9clar\xe9 globalement."]}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez le fichier ",(0,s.jsx)(r.strong,{children:"Usings.cs"})," \xe0 la racine du projet ",(0,s.jsx)(r.strong,{children:"SuperCarte.WPF"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"global using SuperCarte.WPF; //Les classes \xe0 la racine de l'application WPF\r\nglobal using SuperCarte.EF.Data; //Les classes du mod\xe8le du contexte\r\nglobal using SuperCarte.EF.Data.Context; // La classe du contexte\r\nglobal using System;\r\nglobal using System.Collections.Generic;\r\nglobal using System.Threading.Tasks;\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Au fur et \xe0 mesure que des classes s'ajouteront dans le projet, le fichier ",(0,s.jsx)(r.strong,{children:"Usings.cs"})," sera mis \xe0 jour."]}),"\n",(0,s.jsxs)(r.p,{children:["\xc9galement, le fichier ",(0,s.jsx)(r.strong,{children:"Usings.cs"})," appartient uniquement au projet dans lequel il est cr\xe9\xe9."]}),"\n",(0,s.jsx)(r.h2,{id:"fichier-de-configuration---appsettingsjson",children:"Fichier de configuration - appsettings.json"}),"\n",(0,s.jsxs)(r.p,{children:["La librairie ",(0,s.jsx)(r.strong,{children:"Microsoft.Extensions.Configuration.Json"})," permet de lire un fichier de configuration en ",(0,s.jsx)(r.strong,{children:"json"}),"."]}),"\n",(0,s.jsxs)(r.p,{children:["Dans la ",(0,s.jsx)(r.strong,{children:"Console du Gestionnaire de package"}),", inscrivez cette ligne. Il est important que le ",(0,s.jsx)(r.strong,{children:"Projet par d\xe9faut"})," soit ",(0,s.jsx)(r.strong,{children:"SuperCarte.WPF"})," dans la console. La librairie s'installera dans le projet indiqu\xe9 dans le champ ",(0,s.jsx)(r.strong,{children:"Projet par d\xe9faut"}),"."]}),"\n",(0,s.jsx)("img",{src:"/4N1_2024/img/13_package_console_1.png"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-powershell",children:"Install-Package Microsoft.Extensions.Configuration.Json\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez le fichier ",(0,s.jsx)(r.strong,{children:"appsettings.json"})," \xe0 la racine du projet ",(0,s.jsx)(r.strong,{children:"SuperCarte.WPF"}),". Prenez le mod\xe8le ",(0,s.jsx)(r.strong,{children:"Fichier Texte"}),"."]}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"IMPORTANT"})," : Pour que le fichier soit pris en compte par le compilateur, il faut indiquer dans ces propri\xe9t\xe9s qu'il doit \xeatre copi\xe9 dans le dossier de compilation. Effectuez un ",(0,s.jsx)(r.strong,{children:"clic droit"})," sur le fichier ",(0,s.jsx)(r.strong,{children:"appsettings.json"})," et s\xe9lectionnez ",(0,s.jsx)(r.strong,{children:"Propri\xe9t\xe9s"}),". Pour le champ ",(0,s.jsx)(r.strong,{children:"Copier dans le r\xe9pertoire de sortie"}),", il faut mettre la valeur ",(0,s.jsx)(r.strong,{children:"Copier si plus r\xe9cent"}),"."]}),"\n",(0,s.jsx)("img",{src:"/4N1_2024/img/12_appsettings_01.png"}),"\n",(0,s.jsxs)(r.p,{children:["Copiez ce code ",(0,s.jsx)(r.strong,{children:"json"})," dans le fichier."]}),"\n",(0,s.jsxs)(r.p,{children:["Utilisez cette version si vous n'avez pas le message d'erreur du certificat ",(0,s.jsx)(r.strong,{children:"SSL"}),". Il faut \xe9galement modifier le nom de la base de donn\xe9es pour celui que vous avez utilis\xe9."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-powershell",children:'{\r\n  "ConnectionStrings": {\r\n    "DefaultConnection": "Server=localhost\\SQLExpress;Database=eDA_4N1_SuperCarte;Trusted_Connection=True;"\r\n  }\r\n}\n'})}),"\n",(0,s.jsxs)(r.p,{children:["Utilisez cette version avec le param\xe8tre ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"Trust Server Certificate=true;"})})," si vous avez le message d'erreur du certificat ",(0,s.jsx)(r.strong,{children:"SSL"}),". Il faut \xe9galement modifier le nom de la base de donn\xe9es pour celui que vous avez utilis\xe9."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:'{\r\n  "ConnectionStrings": {\r\n    "DefaultConnection": "Server=localhost\\SQLExpress;Database=eDA_4N1_SuperCarte;Trusted_Connection=True;Trust Server Certificate=true;"\r\n  }\r\n}\n'})}),"\n",(0,s.jsx)(r.h2,{id:"ajout-de-la-structure-pour-injection-des-d\xe9pendances",children:"Ajout de la structure pour injection des d\xe9pendances"}),"\n",(0,s.jsxs)(r.p,{children:["Le projet ",(0,s.jsx)(r.strong,{children:"WPF"})," n'a pas de fichier ",(0,s.jsx)(r.strong,{children:"program.cs"}),". Ce type de projet n'est pas con\xe7u \xe0 la base pour \xeatre dans la structure du ",(0,s.jsx)(r.strong,{children:"hosting"})," de ",(0,s.jsx)(r.strong,{children:".Net Core"}),". Il faut donc l'adapter."]}),"\n",(0,s.jsxs)(r.p,{children:["Le fichier de d\xe9marrage de l'application est ",(0,s.jsx)(r.strong,{children:"App.xaml.cs"}),". Il est inclus dans le fichier ",(0,s.jsx)(r.strong,{children:"App.xaml"}),"."]}),"\n",(0,s.jsxs)(r.p,{children:["Remarquez que la classe est ",(0,s.jsx)(r.strong,{children:"partial"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"public partial class App : Application\r\n{\r\n}\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Une classe partielle en ",(0,s.jsx)(r.strong,{children:".NET"})," consiste \xe0 cr\xe9er une classe dans plusieurs fichiers. Le fichier ",(0,s.jsx)(r.strong,{children:"App.xaml"})," est aussi une classe, sauf que le langage est ",(0,s.jsx)(r.strong,{children:"XAML"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-xaml",children:'<Application x:Class="SuperCarte.WPF.App"\r\n             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"\r\n             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"\r\n             xmlns:local="clr-namespace:SuperCarte.WPF"\r\n             StartupUri="MainWindow.xaml">\r\n    <Application.Resources>\r\n         \r\n    </Application.Resources>\r\n</Application>\n'})}),"\n",(0,s.jsx)(r.p,{children:"\xc0 la ligne 1, le nom de la classe est indiqu\xe9."}),"\n",(0,s.jsxs)(r.p,{children:["C'est pour cette raison que le fichier ",(0,s.jsx)(r.strong,{children:"App.xaml.cs"})," est un sous-fichier de ",(0,s.jsx)(r.strong,{children:"App.xaml"})," dans l'",(0,s.jsx)(r.strong,{children:"Explorateur de solutions"}),". Si la classe n'\xe9tait pas partielle, il ne serait pas possible d'avoir 2 langages pour une m\xeame classe. La notion de classe partielle sert \xe9galement \xe0 ajouter des fonctionnalit\xe9s dans une classe g\xe9n\xe9r\xe9e automatiquement. Dans le ",(0,s.jsx)(r.strong,{children:"TP 2"}),", les classes du mod\xe8le sont ",(0,s.jsx)(r.strong,{children:"partial"}),". Il aurait \xe9t\xe9 possible d'ajouter un 2e fichier interne pour ajouter des \xe9l\xe9ments \xe0 la classe de base."]}),"\n",(0,s.jsxs)(r.p,{children:["\xc0 la ligne 5, c'est la fen\xeatre de d\xe9marrage. Pour une application ",(0,s.jsx)(r.strong,{children:"WPF"}),", la classe ",(0,s.jsx)(r.strong,{children:"App"})," est le conteneur des fen\xeatres. Une fen\xeatre est l'\xe9quivalent d'une page."]}),"\n",(0,s.jsxs)(r.p,{children:["L'application ",(0,s.jsx)(r.strong,{children:"WPF"})," de ce projet sera comme un ",(0,s.jsx)(r.strong,{children:"SPA"})," ou une ",(0,s.jsx)(r.strong,{children:"Application \xe0 page unique"}),". Dans le cas d'une application native, il serait possible de dire un ",(0,s.jsx)(r.strong,{children:"SWA"})," pour une ",(0,s.jsx)(r.strong,{children:"Application \xe0 fen\xeatre unique"}),"."]}),"\n",(0,s.jsxs)(r.p,{children:["Les applications ",(0,s.jsx)(r.strong,{children:"\xe0 fen\xeatres multiples"})," sont de plus en plus rares, car de nombreux appareils ne sont pas en mesure de les g\xe9rer correctement. C'est une approche pour les syst\xe8mes d'exploitation ordinateur, comme ",(0,s.jsx)(r.strong,{children:"Windows"})," ou ",(0,s.jsx)(r.strong,{children:"macOS"}),", car ils sont en mesure de g\xe9rer le ",(0,s.jsx)(r.strong,{children:"multifen\xeatre"}),"."]}),"\n",(0,s.jsxs)(r.p,{children:["L'application aura seulement une seule fen\xeatre, le classe ",(0,s.jsx)(r.strong,{children:"MainWindow.xaml"}),". \xc0 l'int\xe9rieur de cette classe, il y aura un ",(0,s.jsx)(r.strong,{children:"conteneur"})," qui aura un ",(0,s.jsx)(r.strong,{children:"contr\xf4le utilisateur (user contr\xf4le)"})," qui s'occupera d'une vue sp\xe9cifique. Ce conteneur changera de ",(0,s.jsx)(r.strong,{children:"contr\xf4le utilisateur"})," lorsqu'une nouvelle vue devra \xeatre affich\xe9e. Il s'agit de la m\xeame m\xe9ganique que Blazor ou Angular, mais pour une application native."]}),"\n",(0,s.jsx)(r.h3,{id:"classes-dextension-de-m\xe9thodes",children:"Classes d'extension de m\xe9thodes"}),"\n",(0,s.jsxs)(r.p,{children:["Comme pour le projet de ",(0,s.jsx)(r.strong,{children:"GestionPersonnage"}),", des extensions seront utilis\xe9es pour g\xe9rer l'enregistrement des d\xe9pendances."]}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez les dossiers ",(0,s.jsx)(r.strong,{children:"Extensions\\ServiceCollections"})," \xe0 la racine du projet ",(0,s.jsx)(r.strong,{children:"SuperCarte.WPF"}),"."]}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez la classe ",(0,s.jsx)(r.strong,{children:"SCRepositories.cs"})," dans le dossier."]}),"\n",(0,s.jsxs)(r.p,{children:["Les ",(0,s.jsx)(r.strong,{children:"Repositories"})," sont d\xe9j\xe0 cr\xe9\xe9s, alors il faut les ajouter dans l'enregistrement. Remarquez que la cr\xe9ation est maintenant en ",(0,s.jsx)(r.strong,{children:"Scoped"}),". L'instance du ",(0,s.jsx)(r.strong,{children:"Repo"})," sera partag\xe9e entre les diff\xe9rents services qui l'utilisent."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"using Microsoft.Extensions.DependencyInjection;\r\n\r\nnamespace SuperCarte.WPF.Extensions.ServiceCollections;\r\n\r\n/// <summary>\r\n/// Classe d'extension qui permet d'enregistrer les classes de la cat\xe9gorie Repository\r\n/// </summary>\r\npublic static class SCRepositoryExtensions\r\n{\r\n    /// <summary>\r\n    /// M\xe9thode qui permet d'enregistrer les repositories de l'application\r\n    /// </summary>\r\n    /// <param name=\"services\">La collection de services</param>\r\n    public static void EnregistrerRepositories(this IServiceCollection services)\r\n    {\r\n        services.AddScoped<IRoleRepo, RoleRepo>();\r\n        services.AddScoped<IEnsembleRepo, EnsembleRepo>();\r\n        services.AddScoped<ICategorieRepo, CategorieRepo>();\r\n        services.AddScoped<IUtilisateurRepo, UtilisateurRepo>();\r\n        services.AddScoped<ICarteRepo, CarteRepo>();\r\n        services.AddScoped<IUtilisateurCarteRepo, UtilisateurCarteRepo>();\r\n    }\r\n}\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez la classe ",(0,s.jsx)(r.strong,{children:"SCServiceExtensions.cs"})," dans le dossier ."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"using Microsoft.Extensions.DependencyInjection;\r\n\r\nnamespace SuperCarte.WPF.Extensions.ServiceCollections;\r\n\r\n/// <summary>\r\n/// Classe d'extension qui permet d'enregistrer les classes de la cat\xe9gorie Service\r\n/// </summary>\r\npublic static class SCServiceExtensions\r\n{\r\n    /// <summary>\r\n    /// M\xe9thode qui permet d'enregistrer les services de l'application\r\n    /// </summary>\r\n    /// <param name=\"services\">La collection de services</param>\r\n    public static void EnregistrerServices(this IServiceCollection services)\r\n    {\r\n                \r\n    }\r\n}\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez la classe ",(0,s.jsx)(r.strong,{children:"SCValidateurExtensions.cs"})," dans le dossier . Cette classe s'occupera de l'enregistrement des ",(0,s.jsx)(r.strong,{children:"Validateurs"}),". Ce concept sera pr\xe9sent\xe9 dansun autre document."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"using Microsoft.Extensions.DependencyInjection;\r\n\r\nnamespace SuperCarte.WPF.Extensions.ServiceCollections;\r\n\r\n/// <summary>\r\n/// Classe d'extension qui permet d'enregistrer les classes de la cat\xe9gorie Validateur\r\n/// </summary>\r\npublic static class SCValidateurExtensions\r\n{\r\n    /// <summary>\r\n    /// M\xe9thode qui permet d'enregistrer les validateurs de l'application\r\n    /// </summary>\r\n    /// <param name=\"services\">La collection de services</param>\r\n    public static void EnregistrerValidateurs(this IServiceCollection services)\r\n    {\r\n\r\n    }\r\n}\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez la classe ",(0,s.jsx)(r.strong,{children:"SCViewModelExtensions.cs"})," dans le dossier . Cette classe s'occupera de l'enregistrement des ",(0,s.jsx)(r.strong,{children:"ViewModel"}),". Ce concept sera pr\xe9sent\xe9 dans le prochain document."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"using Microsoft.Extensions.DependencyInjection;\r\n\r\nnamespace SuperCarte.WPF.Extensions.ServiceCollections;\r\n\r\n/// <summary>\r\n/// Classe d'extension qui permet d'enregistrer les classes de la cat\xe9gorie Service\r\n/// </summary>\r\npublic static class SCViewModelExtensions\r\n{\r\n    /// <summary>\r\n    /// M\xe9thode qui permet d'enregistrer les ViewModels de l'application\r\n    /// </summary>\r\n    /// <param name=\"services\">La collection de services</param>\r\n    public static void EnregistrerViewModels(this IServiceCollection services)\r\n    {\r\n\r\n    }\r\n}\r\n\n"})}),"\n",(0,s.jsx)(r.h3,{id:"cr\xe9ation-du-host---appxamlcs",children:"Cr\xe9ation du Host - App.xaml.cs"}),"\n",(0,s.jsxs)(r.p,{children:["Dans la ",(0,s.jsx)(r.strong,{children:"Console du Gestionnaire de package"}),", inscrivez cette ligne. Il est important que le ",(0,s.jsx)(r.strong,{children:"Projet par d\xe9faut"})," soit ",(0,s.jsx)(r.strong,{children:"SuperCarte.WPF"})," dans la console. La librairie s'installera dans le projet indiqu\xe9 dans le champ ",(0,s.jsx)(r.strong,{children:"Projet par d\xe9faut"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"Install-Package Microsoft.Extensions.Hosting\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Avec cette librairie, il sera possible de configurer l'application ",(0,s.jsx)(r.strong,{children:"WPF"})," avec le ",(0,s.jsx)(r.strong,{children:"hosting"})," d'application de ",(0,s.jsx)(r.strong,{children:".NET Core"}),"."]}),"\n",(0,s.jsxs)(r.p,{children:["Copiez ce code dans le fichier ",(0,s.jsx)(r.strong,{children:"App.xaml.cs"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:'using Microsoft.EntityFrameworkCore;\r\nusing Microsoft.Extensions.Configuration;\r\nusing Microsoft.Extensions.DependencyInjection;\r\nusing Microsoft.Extensions.Hosting;\r\nusing SuperCarte.WPF.Extensions.ServiceCollections;\r\nusing System.Windows;\r\n\r\nnamespace SuperCarte.WPF;\r\n/// <summary>\r\n/// Interaction logic for App.xaml\r\n/// </summary>\r\npublic partial class App : Application\r\n{\r\n    private IHost? _host;\r\n\r\n\tpublic App()\r\n\t{\r\n        var builder = Host.CreateDefaultBuilder();\r\n\r\n        //Enregistrement des services\r\n        builder.ConfigureServices((context, services) =>\r\n        {            \r\n            services.AddSingleton<MainWindow>(); //Fen\xeatre principale\r\n\r\n            //Enregistrement du contexte    \r\n            services.AddDbContext<SuperCarteContext>(options => options.UseSqlServer(context.Configuration.GetConnectionString("DefaultConnection")));\r\n\r\n            //Appel des m\xe9thodes d\'extension                        \r\n            services.EnregistrerRepositories();\r\n            services.EnregistrerServices();            \r\n            services.EnregistrerValidateurs();\r\n            services.EnregistrerViewModels();\r\n        });\r\n\r\n        _host = builder.Build();\r\n    }\r\n\r\n    /// <summary>\r\n    /// D\xe9marrage de l\'application\r\n    /// </summary>\r\n    /// <param name="e"></param>\r\n    protected override async void OnStartup(StartupEventArgs e)\r\n    {\r\n        await _host!.StartAsync();\r\n\r\n        var fenetreInitiale = _host.Services.GetRequiredService<MainWindow>();\r\n        fenetreInitiale.Show(); //Affiche la fen\xeatre initiale\r\n        base.OnStartup(e);\r\n    }\r\n\r\n    /// <summary>\r\n    /// Fermeture de l\'application\r\n    /// </summary>\r\n    /// <param name="e"></param>\r\n    protected override async void OnExit(ExitEventArgs e)\r\n    {\r\n        await _host!.StopAsync();\r\n        base.OnExit(e);\r\n    }\r\n}\n'})}),"\n",(0,s.jsx)(r.p,{children:"Voici le d\xe9tail de la classe."}),"\n",(0,s.jsxs)(r.p,{children:["\xc0 la ligne 1 du bloc de code ci-dessous, il y a un attribut pour le ",(0,s.jsx)(r.strong,{children:"host"})," de l'application. Le ",(0,s.jsx)(r.strong,{children:"host"}),"  doit \xeatre en attribut, car il sera utilis\xe9 dans plusieurs m\xe9thodes de la classe."]}),"\n",(0,s.jsxs)(r.p,{children:["Ensuite, le constructeur de la classe s'occupe de configurer le ",(0,s.jsx)(r.strong,{children:"host"})," comme il a \xe9t\xe9 fait dans le fichier ",(0,s.jsx)(r.strong,{children:"Program.cs"})," de l'application console."]}),"\n",(0,s.jsxs)(r.p,{children:["\xc0 la ligne 5, le constructeur par d\xe9faut du ",(0,s.jsx)(r.strong,{children:"host"})," est cr\xe9\xe9."]}),"\n",(0,s.jsx)(r.p,{children:"\xc0 la ligne 10, il faut enregistrer la fen\xeatre principale dans les d\xe9pendances de l'application."}),"\n",(0,s.jsx)(r.p,{children:"\xc0 la ligne 13, le contexte est enregistr\xe9 avec le fichier de configuration."}),"\n",(0,s.jsx)(r.p,{children:"Aux lignes 16 \xe0 18, le service utilise les m\xe9thodes d'extension pour enregistrer les diff\xe9rents concepts."}),"\n",(0,s.jsxs)(r.p,{children:["\xc0 la ligne 21, le ",(0,s.jsx)(r.strong,{children:"host"})," est construit en fonction de la configuration initiale."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:'private IHost? _host;\r\n\r\npublic App()\r\n{\r\n    var builder = Host.CreateDefaultBuilder();\r\n\r\n    //Enregistrement des services\r\n    builder.ConfigureServices((context, services) =>\r\n    {            \r\n        services.AddSingleton<MainWindow>(); //Fen\xeatre principale\r\n\r\n        //Enregistrement du contexte    \r\n        services.AddDbContext<SuperCarteContext>(options => options.UseSqlServer(context.Configuration.GetConnectionString("DefaultConnection")));\r\n\r\n        //Appel des m\xe9thodes d\'extension                        \r\n        services.EnregistrerRepositories();\r\n        services.EnregistrerServices();            \r\n        services.EnregistrerValidateurs();\r\n        services.EnregistrerViewModels();\r\n    });\r\n\r\n    _host = builder.Build();\r\n}\n'})}),"\n",(0,s.jsxs)(r.p,{children:["La m\xe9thode ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"OnStartup()"})})," est appel\xe9 au d\xe9marrage de l'application, apr\xe8s le constructeur. Elle d\xe9marre le ",(0,s.jsx)(r.strong,{children:"host"})," et ensuite indique au programme d'afficher la fen\xeatre principale de l'application."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"protected override async void OnStartup(StartupEventArgs e)\r\n{\r\n    await _host!.StartAsync();\r\n\r\n    var fenetreInitiale = _host.Services.GetRequiredService<MainWindow>();\r\n    fenetreInitiale.Show(); //Affiche la fen\xeatre initiale\r\n    base.OnStartup(e);\r\n}\n"})}),"\n",(0,s.jsx)(r.p,{children:"D\xe9marrez l'application. Il y a 2 fen\xeatres."}),"\n",(0,s.jsxs)(r.p,{children:["Ouvrez le fichier ",(0,s.jsx)(r.strong,{children:"App.xaml"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-xaml",children:'<Application x:Class="SuperCarte.WPF.App"\r\n             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"\r\n             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"\r\n             xmlns:local="clr-namespace:SuperCarte.WPF"\r\n             StartupUri="MainWindow.xaml">\r\n    <Application.Resources>\r\n         \r\n    </Application.Resources>\r\n</Application>\n'})}),"\n",(0,s.jsxs)(r.p,{children:["\xc0 la ligne 5, il y a la propri\xe9t\xe9 ",(0,s.jsx)(r.strong,{children:"StartupUri"}),". Cette propri\xe9t\xe9 indique \xe9galement la fen\xeatre de d\xe9marrage. Il faut retirer cette propri\xe9t\xe9 pour ne pas interf\xe9rer avec l'injection de d\xe9pendances."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-xaml",children:'<Application x:Class="SuperCarte.WPF.App"\r\n             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"\r\n             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"\r\n             xmlns:local="clr-namespace:SuperCarte.WPF">\r\n    <Application.Resources>\r\n         \r\n    </Application.Resources>\r\n</Application>\n'})}),"\n",(0,s.jsx)(r.p,{children:"D\xe9marrez de nouveau l'application et il aura seulement une fen\xeatre."}),"\n",(0,s.jsx)(r.h2,{id:"hello-world",children:"Hello World"}),"\n",(0,s.jsxs)(r.p,{children:["Pour avoir un premier contenu visuel, il faut modifier le fichier ",(0,s.jsx)(r.strong,{children:"MainWindows.xaml"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-xaml",children:'<Window x:Class="SuperCarte.WPF.MainWindow"\r\n        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"\r\n        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"\r\n        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"\r\n        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"\r\n        xmlns:local="clr-namespace:SuperCarte.WPF"\r\n        mc:Ignorable="d"\r\n        Title="Super Carte App" Height="450" Width="800">\r\n    <Grid>\r\n        <Label Content="Hello World!!!"></Label>\r\n    </Grid>\r\n</Window>\n'})}),"\n",(0,s.jsxs)(r.p,{children:["\xc0 la ligne 8, la propri\xe9t\xe9 ",(0,s.jsx)(r.strong,{children:"Title"})," de la balise ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"<Window>"})})," permet de mettre le titre de la fen\xeatre."]}),"\n",(0,s.jsxs)(r.p,{children:["\xc0 la ligne 10, il y a un ",(0,s.jsx)(r.strong,{children:"Label"})," pour afficher du texte statique.  L'int\xe9rieur de la balise ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"<Grid>"})}),", c'est le contenu de la fen\xeatre."]}),"\n",(0,s.jsx)(r.h1,{id:"annexe---remove-migration",children:"Annexe - Remove-Migration"}),"\n",(0,s.jsx)(r.p,{children:"Pour \xeatre en mesure de supprimer des migrations, il faut remettre la base de donn\xe9es \xe0 l'\xe9tat correct."}),"\n",(0,s.jsx)(r.p,{children:"Par exemple, voici 4 migrations."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"CreationBD\r\nAjoutTableUtilisateur\r\nAjoutTableEnsemble -- Probl\xe9matique\r\nAjoutTableCategorie -- Correct\r\n\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Il faut remettre la base de donn\xe9es \xe0 un \xe9tat valide. Le dernier \xe9tat valide est ",(0,s.jsx)(r.strong,{children:"AjoutTableUtilisateur"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-powershell",children:"Update-Database -StartupProject SuperCarte.EF -Migration AjoutTableUtilisateur\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Ensuite, il faut utiliser la commande ",(0,s.jsx)(r.strong,{children:(0,s.jsx)(r.code,{children:"Remove-Migration"})}),". Cette commande enl\xe8ve seulement la derni\xe8re migration. Il faudra l'ex\xe9cuter 2 fois pour retirer la migration probl\xe9matique."]}),"\n",(0,s.jsxs)(r.p,{children:["Pour effacer ",(0,s.jsx)(r.strong,{children:"AjoutTableCategorie"})]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"Remove-Migration -StartupProject SuperCarte.EF \n"})}),"\n",(0,s.jsxs)(r.p,{children:["Pour effacer ",(0,s.jsx)(r.strong,{children:"AjoutTableEnsemble"})]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"Remove-Migration -StartupProject SuperCarte.EF \n"})}),"\n",(0,s.jsxs)(r.p,{children:["Malheureusement, la partie de ",(0,s.jsx)(r.strong,{children:"AjoutTableCategorie"})," doit \xeatre effac\xe9e, m\xeame si elle est valide."]})]})}function u(e={}){const{wrapper:r}={...(0,i.a)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},1151:(e,r,n)=>{n.d(r,{Z:()=>l,a:()=>a});var s=n(7294);const i={},t=s.createContext(i);function a(e){const r=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(t.Provider,{value:r},e.children)}}}]);