"use strict";(self.webpackChunknotes_de_cours_4_n_1_2024=self.webpackChunknotes_de_cours_4_n_1_2024||[]).push([[6989],{7135:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>d});var t=n(5893),s=n(1151);const i={sidebar_position:228,draft:!1},a="Seed Categorie, Ensemble, Carte",o={id:"WPF partie 2/seed",title:"Seed Categorie, Ensemble, Carte",description:"Les tables Categorie, Ensemble et Cartes ne contiennent pas de donn\xe9es. Il faut donc cr\xe9er une nouvelle migration qui contient ce nouveau Seed.",source:"@site/docs/72-WPF partie 2/seed.md",sourceDirName:"72-WPF partie 2",slug:"/WPF partie 2/seed",permalink:"/4N1_2024/docs/WPF partie 2/seed",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:228,frontMatter:{sidebar_position:228,draft:!1},sidebar:"NotesSidebar",previous:{title:"Date et Champ texte num\xe9rique",permalink:"/4N1_2024/docs/WPF partie 2/champ_numerique"},next:{title:"Liste des cat\xe9gories",permalink:"/4N1_2024/docs/WPF partie 2/lister_categorie"}},l={},d=[{value:"SuperCarte.EF",id:"supercarteef",level:2}];function c(e){const r={admonition:"admonition",code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.h1,{id:"seed-categorie-ensemble-carte",children:"Seed Categorie, Ensemble, Carte"}),"\n",(0,t.jsxs)(r.p,{children:["Les tables ",(0,t.jsx)(r.strong,{children:"Categorie"}),", ",(0,t.jsx)(r.strong,{children:"Ensemble"})," et ",(0,t.jsx)(r.strong,{children:"Cartes"})," ne contiennent pas de donn\xe9es. Il faut donc cr\xe9er une nouvelle migration qui contient ce nouveau ",(0,t.jsx)(r.strong,{children:"Seed"}),"."]}),"\n",(0,t.jsx)(r.h2,{id:"supercarteef",children:"SuperCarte.EF"}),"\n",(0,t.jsxs)(r.p,{children:["Dans la m\xe9thode ",(0,t.jsx)(r.strong,{children:"Seed()"})," de la classe ",(0,t.jsx)(r.strong,{children:"SuperCarteContext"}),", il faut ajouter les donn\xe9es. Il est important de ne pas supprimer les donn\xe9es existantes, car la migration va croire qu'ils ne sont plus l\xe0, et donc qu'il faudrait les supprimer."]}),"\n",(0,t.jsxs)(r.p,{children:["Pour ajouter des donn\xe9es, il faut cr\xe9er un tableau qui contient les objets et l'ajouter \xe0 l'entit\xe9 avec la m\xe9thode ",(0,t.jsx)(r.strong,{children:"HasData"}),"."]}),"\n",(0,t.jsx)(r.admonition,{type:"note",children:(0,t.jsx)(r.p,{children:"Les autres tables sont aussi remplies \xe0 cause des d\xe9pendances des cl\xe9s \xe9trang\xe8res."})}),"\n",(0,t.jsx)(r.p,{children:"Voici la m\xe9thode au complet."}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-csharp",children:'private void Seed(ModelBuilder modelBuilder)\r\n{\r\n    //Les donn\xe9es \xe0 ajouter\r\n    Role[] roles = \r\n    {\r\n        new Role() \r\n        { \r\n            RoleId = 1,\r\n            Nom = "Administrateur"                \r\n        },\r\n        new Role()\r\n        {\r\n            RoleId = 2,\r\n            Nom = "Utilisateur"\r\n        },\r\n    };\r\n\r\n    Utilisateur[] utilisateurs =\r\n    {\r\n        new Utilisateur()\r\n        {\r\n            UtilisateurId = 1,\r\n            Prenom = "Fran\xe7ois",\r\n            Nom = "St-Hilaire",\r\n            NomUtilisateur = "fsthilaire",\r\n            MotPasseHash = "$2y$11$IY6NG9FkTSI1dnjLfSbuOuNkuyI7IZHxHSOD5Td6AlwvroUz/vzLK", //Native3! avec Bcrypt\r\n            RoleId = 1 //Admin\r\n        },\r\n        new Utilisateur()\r\n        {\r\n            UtilisateurId = 2,\r\n            Prenom = "Benoit",\r\n            Nom = "Tremblay",\r\n            NomUtilisateur = "btremblay",\r\n            MotPasseHash = "$2y$11$ewK3YsMGQ1IMKEzJUAjyVe0P19I0gEbTO998mwfVbSSA8nZ6MG/ha", //Web4MVC! avec Bcrypt\r\n            RoleId = 2 //Utilisateur\r\n        },\r\n        new Utilisateur() \r\n        {\r\n            UtilisateurId = 3,\r\n            Prenom = "Tony",\r\n            Nom = "Stark",\r\n            NomUtilisateur = "tstark",\r\n            MotPasseHash = "$2y$11$VfcNowkWResPQKl0AA3MJ.w1LXBqmMM77YKlyf32Glr9TWG4xxyD2", //#NotAdmin! avec Bcrypt\r\n            RoleId = 2 //Utilisateur\r\n        }\r\n    };\r\n\r\n//highlight-start\r\n    Categorie[] categories =\r\n    {\r\n        new Categorie()\r\n        {\r\n            CategorieId = 1,\r\n            Nom = "Animaux magiques",\r\n            Description = null\r\n        },\r\n        new Categorie()\r\n        {\r\n            CategorieId = 2,\r\n            Nom = "Orcs",\r\n            Description = "Les orcs sont une race de guerrier."\r\n        },\r\n        new Categorie()\r\n        {\r\n            CategorieId = 3,\r\n            Nom = "Mages",\r\n            Description = "Les mages ont des pouvoirs magiques."\r\n        }\r\n    };\r\n\r\n    Ensemble[] ensembles =\r\n    {\r\n        new Ensemble()\r\n        {\r\n            EnsembleId = 1,\r\n            Nom = "Ensemble de d\xe9part",\r\n            Disponibilite = new DateTime(2020,5,12)\r\n        }\r\n    };\r\n\r\n    Carte[] cartes =\r\n    {\r\n        new Carte()\r\n        {\r\n            CarteId = 1,\r\n            Nom = "Lion des marais",\r\n            Armure = 0,\r\n            Vie = 12,\r\n            Attaque = 2,\r\n            EstRare = false,\r\n            PrixRevente = 0.02m,\r\n            CategorieId = 1,\r\n            EnsembleId = 1\r\n        },\r\n        new Carte()\r\n        {\r\n            CarteId = 2,\r\n            Nom = "Corbeau vampire",\r\n            Armure = 0,\r\n            Vie = 2,\r\n            Attaque = 12,\r\n            EstRare = true,\r\n            PrixRevente = 1.20m,\r\n            CategorieId = 1,\r\n            EnsembleId = 1\r\n        },\r\n        new Carte()\r\n        {\r\n            CarteId = 3,\r\n            Nom = "Grunty",\r\n            Armure = 5,\r\n            Vie = 25,\r\n            Attaque = 5,\r\n            EstRare = false,\r\n            PrixRevente = 0.20m,\r\n            CategorieId = 2,\r\n            EnsembleId = 1\r\n        }\r\n    };\r\n//highlight-end\r\n\r\n    //Ajout dans les tables\r\n    modelBuilder.Entity<Role>().HasData(roles);\r\n    modelBuilder.Entity<Utilisateur>().HasData(utilisateurs);\r\n\t//highlight-start\r\n    modelBuilder.Entity<Categorie>().HasData(categories);\r\n    modelBuilder.Entity<Ensemble>().HasData(ensembles);\r\n    modelBuilder.Entity<Carte>().HasData(cartes);\r\n\t//highlight-end\r\n}\n'})}),"\n",(0,t.jsxs)(r.p,{children:["Dans la ",(0,t.jsx)(r.strong,{children:"Console du Gestionnaire de package"}),", inscrivez la commande ci-dessous. Il est important que le ",(0,t.jsx)(r.strong,{children:"Projet par d\xe9faut"})," de ",(0,t.jsx)(r.strong,{children:"Entity Framework"})," soit s\xe9lectionn\xe9 dans la console. Pour ce projet, ce doit \xeatre ",(0,t.jsx)(r.strong,{children:"SuperCarte.EF"}),". \xc0 ce stade, il y a ",(0,t.jsx)(r.strong,{children:"plusieurs projets"})," et celui s\xe9lectionn\xe9 par d\xe9faut sera ",(0,t.jsx)(r.strong,{children:"WPF"}),". Il est important de le modifier dans la liste."]}),"\n",(0,t.jsxs)(r.p,{children:["Pour ce projet, utilisez cette chaine de connexion. Le nom de la base de donn\xe9es est ",(0,t.jsx)(r.strong,{children:"eDA_4N1_SuperCarte"}),". Modifiez le ",(0,t.jsx)(r.strong,{children:"DA"})," par votre num\xe9ro d'admission."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-powershell",children:'$env:MIGRATION_CONNECTION_STRING = "Server=localhost\\SQLExpress;Database=eDA_4N1_SuperCarte;Trusted_Connection=True;"\n'})}),"\n",(0,t.jsxs)(r.p,{children:["Voici la commande avec le ",(0,t.jsx)(r.strong,{children:"Trusted_Connection=True;"})," , si vous avez l'erreur ",(0,t.jsx)(r.strong,{children:"SSL"}),"."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-powershell",children:'$env:MIGRATION_CONNECTION_STRING = "Server=localhost\\SQLExpress;Database=eDA_4N1_SuperCarte;Trusted_Connection=True;Trust Server Certificate=True;"\n'})}),"\n",(0,t.jsxs)(r.p,{children:["Ensuite, il faut cr\xe9er la migration ",(0,t.jsx)(r.strong,{children:"Seed_Carte"})," avec ",(0,t.jsx)(r.strong,{children:"Add-Migration"}),"."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"Add-Migration Seed_Carte -StartupProject SuperCarte.EF\n"})}),"\n",(0,t.jsxs)(r.p,{children:["Appliquez les modifications \xe0 la base de donn\xe9es. Sp\xe9cifiez la migration ",(0,t.jsx)(r.strong,{children:"Seed_Carte"}),"."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-powershell",children:"Update-Database -StartupProject SuperCarte.EF -Migration Seed_Carte\n"})})]})}function u(e={}){const{wrapper:r}={...(0,s.a)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},1151:(e,r,n)=>{n.d(r,{Z:()=>o,a:()=>a});var t=n(7294);const s={},i=t.createContext(s);function a(e){const r=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(i.Provider,{value:r},e.children)}}}]);