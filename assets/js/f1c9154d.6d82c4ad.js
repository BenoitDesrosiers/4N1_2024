"use strict";(self.webpackChunknotes_de_cours_4_n_1_2024=self.webpackChunknotes_de_cours_4_n_1_2024||[]).push([[6425],{4088:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>u,frontMatter:()=>a,metadata:()=>l,toc:()=>c});var i=r(5893),s=r(1151);const a={sidebar_position:305,draft:!1},t="Navigateur",l={id:"WPF partie 3/navigateur",title:"Navigateur",description:"Dans ce document, vous impl\xe9menterez la m\xe9canique de navigation entre les diff\xe9rentes vues.",source:"@site/docs/74-WPF partie 3/navigateur.md",sourceDirName:"74-WPF partie 3",slug:"/WPF partie 3/navigateur",permalink:"/4N1_2024/docs/WPF partie 3/navigateur",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:305,frontMatter:{sidebar_position:305,draft:!1},sidebar:"NotesSidebar",previous:{title:"Code Partie 3",permalink:"/4N1_2024/docs/WPF partie 3/wpf_partie3_source"},next:{title:"Menu",permalink:"/4N1_2024/docs/WPF partie 3/menu"}},o={},c=[{value:"Navigation",id:"navigation",level:2},{value:"Classe d&#39;assistance - Navigateur",id:"classe-dassistance---navigateur",level:2},{value:"Ajout de r\xe9f\xe9rences dans Usings.cs",id:"ajout-de-r\xe9f\xe9rences-dans-usingscs",level:2},{value:"Enregistrement du service - App.xaml.cs",id:"enregistrement-du-service---appxamlcs",level:2},{value:"Int\xe9gration du navigateur - MainWindowVM",id:"int\xe9gration-du-navigateur---mainwindowvm",level:2},{value:"Liaison du navigateur - MainWindow.xaml",id:"liaison-du-navigateur---mainwindowxaml",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"navigateur",children:"Navigateur"}),"\n",(0,i.jsx)(n.p,{children:"Dans ce document, vous impl\xe9menterez la m\xe9canique de navigation entre les diff\xe9rentes vues."}),"\n",(0,i.jsx)(n.p,{children:"Vous ajouterez \xe9galement un menu \xe0 l'application."}),"\n",(0,i.jsx)(n.p,{children:"Ensuite, vous allez faire la vue de gestion pour \xeatre en mesure de cr\xe9er et de modifier des \xe9l\xe9ments de la base de donn\xe9es. Il faudra mettre en place la validation du formulaire et \xe9galement la navigation entre la liste et la gestion."}),"\n",(0,i.jsxs)(n.p,{children:["Finalement, vous allez impl\xe9menter un ",(0,i.jsx)(n.strong,{children:"ComboBox"})," pour sp\xe9cifier la valeur d'une cl\xe9 \xe9trang\xe8re."]}),"\n",(0,i.jsx)(n.h2,{id:"navigation",children:"Navigation"}),"\n",(0,i.jsxs)(n.p,{children:["Pour \xeatre en mesure de passer d'une vue \xe0 l'autre, il faut une m\xe9canique de navigation. Pr\xe9sentement, la navigation se fait dans ",(0,i.jsx)(n.strong,{children:"MainWindowVM.cs"}),", en changeant ",(0,i.jsx)(n.strong,{children:"VMActif"}),". Ce n'est pas trop efficace."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"WPF"})," n'offre pas de m\xe9canique int\xe9gr\xe9e, car le choix du type de vue est tr\xe8s vari\xe9. Il est possible de faire un changement de contr\xf4le utilisateur dans une fen\xeatre principal comme pour ce projet. Il est possible de g\xe9rer de nouvelles fen\xeatres, de faire une application avec des pages WPF ou un m\xe9lange de tout ceci."]}),"\n",(0,i.jsxs)(n.p,{children:["La navigation est propre \xe0 la vue. Dans certaines technologies, c'est enti\xe8rement la vue qui g\xe8re le changement, car c'est plus facile. Dans d'autres, il est plus pratique de le faire par le ",(0,i.jsx)(n.strong,{children:"ViewModel"}),". Parfois, il faut faire un m\xe9lange des deux."]}),"\n",(0,i.jsxs)(n.p,{children:["Il est important que le ",(0,i.jsx)(n.strong,{children:"ViewModel"})," ne connaisse pas la m\xe9canique de changement de ",(0,i.jsx)(n.strong,{children:"Vue"}),". Il doit seulement indiquer qu'il faut changer de ",(0,i.jsx)(n.strong,{children:"ViewModel"})," et c'est la couche ",(0,i.jsx)(n.strong,{children:"Vue"})," qui g\xe8re la m\xe9canique."]}),"\n",(0,i.jsxs)(n.p,{children:["Pour ce projet, ce sera le ",(0,i.jsx)(n.strong,{children:"ViewModel"})," qui va demander les changements de ",(0,i.jsx)(n.strong,{children:"Vue"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"classe-dassistance---navigateur",children:"Classe d'assistance - Navigateur"}),"\n",(0,i.jsxs)(n.p,{children:["Une classe d'assistance, d'aide ou ",(0,i.jsx)(n.strong,{children:"helper"})," en anglais est une classe qui assiste un \xe9l\xe9ment logiciel pour effectuer une t\xe2che pr\xe9cise."]}),"\n",(0,i.jsxs)(n.p,{children:["Elle est parfois nomm\xe9e ",(0,i.jsx)(n.strong,{children:"fournisseur"})," ou ",(0,i.jsx)(n.strong,{children:"provider"}),", car elle fournit un service pr\xe9cis \xe0 une composante."]}),"\n",(0,i.jsx)(n.p,{children:"Il peut y avoir des classes d'assistance \xe0 toutes les couches de l'application."}),"\n",(0,i.jsxs)(n.p,{children:["Le navigateur est une classe d'assistance pour le ",(0,i.jsx)(n.strong,{children:"ViewModel"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Dans le projet ",(0,i.jsx)(n.strong,{children:"SuperCarte.WPF"}),", cr\xe9ez le dossier ",(0,i.jsx)(n.strong,{children:"Aides"}),". Ce dossier contiendra les classes d'assistances."]}),"\n",(0,i.jsxs)(n.p,{children:["Cr\xe9ez l'interface ",(0,i.jsx)(n.strong,{children:"INavigateur.cs"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",metastring:"showLineNumbers ",children:'namespace SuperCarte.WPF.Aides;\r\n\r\n/// <summary>\r\n/// Interface qui contient la m\xe9canique de navigation\r\n/// </summary>\r\npublic interface INavigateur\r\n{\r\n    BaseVM VMActif { get; }\r\n\r\n    /// <summary>\r\n    /// Naviger vers un ViewModel\r\n    /// </summary>\r\n    /// <typeparam name="TViewModel">Type du ViewModel</typeparam>\r\n    void Naviguer<TViewModel>() where TViewModel : BaseVM;\r\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["L'interface poss\xe8de la propri\xe9t\xe9 ",(0,i.jsx)(n.strong,{children:"VMActif"})," (ligne 8). Cette propri\xe9t\xe9 indique \xe0 la fen\xeatre principale qu'elle est le ",(0,i.jsx)(n.strong,{children:"ViewModel"})," qu'elle doit utiliser."]}),"\n",(0,i.jsxs)(n.p,{children:["Ensuite, la m\xe9thode ",(0,i.jsx)(n.strong,{children:"Naviguer"})," est g\xe9n\xe9rique (ligne 14). Il faudra sp\xe9cifier le type du ",(0,i.jsx)(n.strong,{children:"ViewModel"})," qui doit \xeatre affich\xe9. Le type g\xe9n\xe9rique peut \xeatre uniquement une classe qui h\xe9rite de la classe abstraite ",(0,i.jsx)(n.strong,{children:"BaseVM"})," (where)."]}),"\n",(0,i.jsxs)(n.p,{children:["Cr\xe9ez la classe ",(0,i.jsx)(n.strong,{children:"Navigateur.cs"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",metastring:"showLineNumbers ",children:'using CommunityToolkit.Mvvm.ComponentModel;\r\nusing Microsoft.Extensions.DependencyInjection;\r\n\r\nnamespace SuperCarte.WPF.Aides;\r\n\r\n/// <summary>\r\n/// Classe qui contient la m\xe9canique de navigation de l\'application\r\n/// </summary>\r\npublic class Navigateur : ObservableObject, INavigateur\r\n{\r\n    private readonly IServiceProvider _serviceProvider;\r\n    private BaseVM _vmActif;\r\n\r\n    /// <summary>\r\n    /// Constructeur\r\n    /// </summary>\r\n    /// <param name="serviceProvider">Service Provider</param>\r\n    public Navigateur(IServiceProvider serviceProvider)\r\n\t{\r\n        _serviceProvider = serviceProvider;\r\n    }    \r\n\r\n    public void Naviguer<TViewModel>() where TViewModel : BaseVM\r\n    {        \r\n        VMActif = _serviceProvider.GetRequiredService<TViewModel>();         \r\n    }\r\n\r\n    public BaseVM VMActif\r\n    {\r\n        get \r\n        { \r\n            return _vmActif; \r\n        }\r\n        private set\r\n        {\r\n            SetProperty(ref _vmActif, value);\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["La classe a besoin du ",(0,i.jsx)(n.strong,{children:"ServiceProvider"})," pour cr\xe9er des instances de ",(0,i.jsx)(n.strong,{children:"ViewModel"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["La m\xe9thode ",(0,i.jsx)(n.strong,{children:"Naviguer"})," utilise le ",(0,i.jsx)(n.strong,{children:"ServiceProvider"})," pour cr\xe9er une instance en fonction du type du ",(0,i.jsx)(n.strong,{children:"ViewModel"})," demand\xe9."]}),"\n",(0,i.jsxs)(n.p,{children:["L'instance est associ\xe9e \xe0 la propri\xe9t\xe9 ",(0,i.jsx)(n.strong,{children:"VMActif"}),". Cette propri\xe9t\xe9 sera li\xe9e dans la fen\xeatre principale. Pour cette raison, la classe doit h\xe9riter de ",(0,i.jsx)(n.strong,{children:"ObservableObject"})," de la librairie ",(0,i.jsx)(n.strong,{children:"MVVM Toolkit"})," pour avoir acc\xe8s \xe0 la m\xe9canique de notification."]}),"\n",(0,i.jsx)(n.h2,{id:"ajout-de-r\xe9f\xe9rences-dans-usingscs",children:"Ajout de r\xe9f\xe9rences dans Usings.cs"}),"\n",(0,i.jsxs)(n.p,{children:["Dans le fichier ",(0,i.jsx)(n.strong,{children:"Usings.cs"}),", ajoutez le nouveau ",(0,i.jsx)(n.strong,{children:"namespace"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",metastring:"showLineNumbers",children:"global using SuperCarte.WPF; //Les classes \xe0 la racine de l'application WPF\r\nglobal using SuperCarte.EF.Data; //Les classes du mod\xe8le du contexte\r\nglobal using SuperCarte.EF.Data.Context; // La classe du contexte\r\nglobal using System;\r\nglobal using System.Collections.Generic;\r\nglobal using System.Threading.Tasks;\r\n\r\nglobal using SuperCarte.Core.Services;\r\nglobal using SuperCarte.Core.Models;\r\nglobal using SuperCarte.WPF.ViewModels;\r\nglobal using SuperCarte.WPF.ViewModels.Bases;\r\n\r\n//highlight-next-line\r\nglobal using SuperCarte.WPF.Aides;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"enregistrement-du-service---appxamlcs",children:"Enregistrement du service - App.xaml.cs"}),"\n",(0,i.jsx)(n.p,{children:"Il faut enregistrer le navigateur dans les services."}),"\n",(0,i.jsxs)(n.p,{children:["L'enregistrement se fait directement dans la classe ",(0,i.jsx)(n.strong,{children:"App.xaml.cs"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Voici le nouveau constructeur."}),"\n",(0,i.jsx)(n.p,{children:"\xc0 la ligne 19, l'enregistrement du navigateur est fait avec un singleton. Il faut avoir seulement une instance de cette classe."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",metastring:"showLineNumbers",children:'public App()\r\n{\r\n    //Modification de la langue dans l\'extension et du thread principal\r\n    CultureInfo.DefaultThreadCurrentCulture = new CultureInfo("fr-CA");\r\n    WPFLocalizeExtension.Engine.LocalizeDictionary.Instance.SetCurrentThreadCulture = true;\r\n    WPFLocalizeExtension.Engine.LocalizeDictionary.Instance.Culture = CultureInfo.DefaultThreadCurrentCulture;\r\n    \r\n    var builder = Host.CreateDefaultBuilder();\r\n\r\n    //Enregistrement des services\r\n    builder.ConfigureServices((context, services) =>\r\n    {            \r\n        services.AddSingleton<MainWindow>(); //Fen\xeatre principale\r\n\r\n        //Enregistrement du contexte    \r\n        services.AddDbContext<SuperCarteContext>(options => options.UseSqlServer(context.Configuration.GetConnectionString("DefaultConnection")));\r\n\r\n//highlight-start\r\n        //Enregistrement des classes d\'assistance\r\n        services.AddSingleton<INavigateur, Navigateur>();\r\n//highlight-end\r\n\r\n        //Appel des m\xe9thodes d\'extension                        \r\n        services.EnregistrerRepositories();\r\n        services.EnregistrerServices();            \r\n        services.EnregistrerValidateurs();\r\n        services.EnregistrerViewModels();\r\n    });\r\n\r\n    _host = builder.Build();\r\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"int\xe9gration-du-navigateur---mainwindowvm",children:"Int\xe9gration du navigateur - MainWindowVM"}),"\n",(0,i.jsxs)(n.p,{children:["Il faut modifier la classe ",(0,i.jsx)(n.strong,{children:"MainWindowVM.cs"})," pour qu'elle utilise le navigateur."]}),"\n",(0,i.jsx)(n.p,{children:"La classe a plusieurs changements."}),"\n",(0,i.jsxs)(n.p,{children:["Le constructeur re\xe7oit maintenant le ",(0,i.jsx)(n.strong,{children:"Navigateur"})," au lieu du ",(0,i.jsx)(n.strong,{children:"ServiceProvider"})," comme d\xe9pendance."]}),"\n",(0,i.jsx)(n.p,{children:"\xc0 la ligne 13, il y a l'assignation de la vue de d\xe9part en utilisant le navigateur."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",metastring:"showLineNumbers",children:"namespace SuperCarte.WPF.ViewModels;\r\n\r\npublic class MainWindowVM : BaseVM\r\n{\r\n    private readonly INavigateur _navigateur;\r\n\r\n    public MainWindowVM(INavigateur navigateur)\r\n\t{   \r\n        //S\xe9lectionner le ViewModel de d\xe9marrage        \r\n        _navigateur = navigateur;\r\n\r\n        //Vue initiale\r\n        _navigateur.Naviguer<ListeCartesVM>();\r\n    }\r\n\r\n    public INavigateur Navigateur\r\n    { \r\n        get\r\n        {\r\n            return _navigateur;\r\n        }\r\n    }   \r\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["La propri\xe9t\xe9 de liaison est maintenant le ",(0,i.jsx)(n.strong,{children:"Navigateur"})," et non directement ",(0,i.jsx)(n.strong,{children:"VMActif"}),". La m\xe9canique de notification est dans le ",(0,i.jsx)(n.strong,{children:"Navigateur"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Il n'est pas possible de le faire comme ci-dessous. Car la ",(0,i.jsx)(n.strong,{children:"Vue"})," est li\xe9e \xe0 la propri\xe9t\xe9 parent et elle ne consid\xe8rera pas la notification de changement de la propri\xe9t\xe9 enfant ",(0,i.jsx)(n.strong,{children:"_navigateur.ActiveVM"})," comme lui appartenant. La notification doit se faire directement sur la propri\xe9t\xe9 qui est li\xe9e. Il n'est pas possible de recevoir la notification par des interm\xe9diaires."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",metastring:'showLineNumbers title="NE PAS COPIER"',children:"public BaseVM ActiveVM\r\n{\r\n    get\r\n    {\r\n        return _navigateur.ActiveVM;\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"liaison-du-navigateur---mainwindowxaml",children:"Liaison du navigateur - MainWindow.xaml"}),"\n",(0,i.jsxs)(n.p,{children:["Il faut modifier la liaison du composant ",(0,i.jsx)(n.strong,{children:"<ContentControl>"})," pour utiliser le navigateur."]}),"\n",(0,i.jsxs)(n.p,{children:["Le changement est \xe0 la ligne 27. ",(0,i.jsx)(n.strong,{children:'<ContentControl  Content="{Binding Navigateur.VMActif}" />'}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",metastring:"showLineNumbers",children:'<Window x:Class="SuperCarte.WPF.MainWindow"\r\n        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"\r\n        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"\r\n        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"\r\n        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"\r\n        xmlns:local="clr-namespace:SuperCarte.WPF"  \r\n        xmlns:vm="clr-namespace:SuperCarte.WPF.ViewModels"\r\n        xmlns:v="clr-namespace:SuperCarte.WPF.Views"                \r\n        mc:Ignorable="d"         \r\n        d:DataContext="{d:DesignInstance Type=vm:MainWindowVM}"\r\n        Title="Super Carte App" \r\n        Height="450" Width="800" WindowState="Maximized">\r\n    <Window.Resources>\r\n        \x3c!--Assignation du ViewModel \xe0 Vue--\x3e\r\n        <DataTemplate DataType="{x:Type TypeName=vm:HelloWordVM}">\r\n            \x3c!--\xc0 retirer \xe9ventuellement--\x3e\r\n            <v:UcHelloWorld />\r\n        </DataTemplate>\r\n        <DataTemplate DataType="{x:Type TypeName=vm:ListeCategoriesVM}">\r\n            <v:UcListeCategories />\r\n        </DataTemplate>\r\n        <DataTemplate DataType="{x:Type TypeName=vm:ListeCartesVM}">\r\n            <v:UcListesCartes />\r\n        </DataTemplate>\r\n    </Window.Resources>\r\n    <Grid>\r\n\t//highlight-next-line\r\n        <ContentControl  Content="{Binding Navigateur.VMActif}" />\r\n    </Grid>\r\n</Window>\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Le Binding est donc fait sur la propri\xe9t\xe9 ",(0,i.jsx)(n.strong,{children:"Navigateur"})," de ",(0,i.jsx)(n.strong,{children:"MainWindowVM"})," qui est le ",(0,i.jsx)(n.strong,{children:"DataContext"})," pour cette vue."]}),"\n",(0,i.jsx)(n.p,{children:"D\xe9marrez l'application et la liste de carte sera la vue initiale."})]})}function u(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},1151:(e,n,r)=>{r.d(n,{Z:()=>l,a:()=>t});var i=r(7294);const s={},a=i.createContext(s);function t(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);