<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-04 WPF/partie_1" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">WPF partie 1 | Notes de cours 4N1 2024</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-site.example.com/4N1_2024/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-site.example.com/4N1_2024/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-site.example.com/4N1_2024/docs/04 WPF/partie_1"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="WPF partie 1 | Notes de cours 4N1 2024"><meta data-rh="true" name="description" content="Pour faire des applications natives Windows, .Net a 3 plateformes principales : WinForm , Universal Windows Platforme (UWP) et Windows Presentation Form (WPF)."><meta data-rh="true" property="og:description" content="Pour faire des applications natives Windows, .Net a 3 plateformes principales : WinForm , Universal Windows Platforme (UWP) et Windows Presentation Form (WPF)."><link data-rh="true" rel="icon" href="/4N1_2024/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-site.example.com/4N1_2024/docs/04 WPF/partie_1"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/4N1_2024/docs/04 WPF/partie_1" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/4N1_2024/docs/04 WPF/partie_1" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/4N1_2024/blog/rss.xml" title="Notes de cours 4N1 2024 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/4N1_2024/blog/atom.xml" title="Notes de cours 4N1 2024 Atom Feed"><link rel="stylesheet" href="/4N1_2024/assets/css/styles.f6e1b814.css">
<script src="/4N1_2024/assets/js/runtime~main.7ef95b34.js" defer="defer"></script>
<script src="/4N1_2024/assets/js/main.0a992cc4.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/4N1_2024/"><div class="navbar__logo"><img src="/4N1_2024/img/logo420.svg" alt="Cégep de Drummondville" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/4N1_2024/img/logo420.svg" alt="Cégep de Drummondville" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">4n1 Native III</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/4N1_2024/docs/preparation_environnement">Notes de cours</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/4N1_2024/docs/preparation_environnement">Installation des logiciels requis</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4N1_2024/docs/00 Intro Csharp/Introduction_CSharp">00 Intro Csharp</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4N1_2024/docs/01 Révision SQL/introduction_SQL_Server">01 Révision SQL</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4N1_2024/docs/02 LINQ/collections">02 LINQ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4N1_2024/docs/03 Injection de dépendance/app_sans_main">03 Injection de dépendance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/4N1_2024/docs/04 WPF/partie_1">04 WPF</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/4N1_2024/docs/04 WPF/partie_1">WPF partie 1</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/4N1_2024/docs/planning">planning</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/4N1_2024/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">04 WPF</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">WPF partie 1</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>WPF partie 1</h1>
<p>Pour faire des applications natives Windows, <strong>.Net</strong> a 3 plateformes principales : <strong>WinForm</strong> , <strong>Universal Windows Platforme (UWP)</strong> et <strong>Windows Presentation Form (WPF)</strong>.</p>
<p>Malgré que <strong>WPF</strong> existe depuis 2006, la plateforme utilise le langage <strong>XAML</strong> pour réaliser les interfaces graphiques. Un premier avantage de <strong>XAML</strong> par rapport à <strong>WinForm</strong> est que <strong>XAML</strong> permet d&#x27;être facilement <strong>responsive</strong>. Un deuxième avantage est que les composants sont <strong>liables (bindables)</strong> à des propriétés. Il est possible de séparer facilement les classes graphiques de la logique d&#x27;interaction.  Il est donc possible de faire d&#x27;utiliser des patrons de conception comme <strong>MVVM</strong> facilement.</p>
<p><strong>XAML</strong> est également utilisé pour la création des interfaces graphiques de <strong>MAUI</strong>, la nouvelle librairie <strong>multiplateforme</strong> de Microsoft.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="présentation-de-lapplication">Présentation de l&#x27;application<a href="#présentation-de-lapplication" class="hash-link" aria-label="Direct link to Présentation de l&#x27;application" title="Direct link to Présentation de l&#x27;application">​</a></h2>
<p>L&#x27;application permet de gérer les cartes de jeux du style <strong>Heartstone</strong> pour des joueurs. Il s&#x27;agit du jeu <strong>Super Carte</strong>. Très original comme nom.</p>
<p>Les cartes ont des caractéristiques propres pour déterminer leur pointage de vie, d’armure et de force.</p>
<p>Chaque joueur possède des cartes qui lui permettront de jouer des parties. Les joueurs peuvent visualiser ses propres cartes et également toutes les cartes du système.</p>
<p>Les administrateurs de l&#x27;application sont en mesure de créer de nouvelles cartes. Les cartes appartiennent à un ensemble de cartes. Périodiquement, les administrateurs créent un nouvel ensemble de cartes.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="structure-de-lapplication">Structure de l&#x27;application<a href="#structure-de-lapplication" class="hash-link" aria-label="Direct link to Structure de l&#x27;application" title="Direct link to Structure de l&#x27;application">​</a></h2>
<p>L&#x27;application <strong>SuperCarteApp</strong> qui sera créée aura 3 projets.</p>
<ul>
<li>
<p><strong>SuperCarte.WPF</strong></p>
<p>Ce projet consiste à l&#x27;interface visuelle <strong>UI</strong> de l&#x27;application. Il contient également la structure <strong>MVVM</strong> pour gérer les interactions avec l&#x27;interface graphique.</p>
</li>
<li>
<p><strong>SuperCarte.Core</strong></p>
<p>Ce projet consiste à la logique de l&#x27;application. Il contient les classes de type <strong>Service</strong>, de type <strong>Repository</strong>, de type <strong>Validateur</strong> et les classes du modèle du domaine.</p>
</li>
<li>
<p><strong>SuperCarte.EF</strong></p>
<p>Ce projet consiste à la communication avec la base de données. Il contient le <strong>contexte</strong> et les classes du modèle de données.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="concepts-présentés">Concepts présentés<a href="#concepts-présentés" class="hash-link" aria-label="Direct link to Concepts présentés" title="Direct link to Concepts présentés">​</a></h2>
<p>Dans ce document, vous allez créer une base de données en <strong>Code First</strong> à partir du <strong>contexte</strong>.</p>
<p>Ensuite, vous allez créer un <strong>Repository</strong> générique pour optimiser la réutilisation de code.</p>
<p>Finalement, vous allez créer la base du projet <strong>WPF</strong> pour intégrer le fichier de configuration et l&#x27;injection de dépendances.</p>
<h1>Approche Code First du Contexte</h1>
<p>Pour ce projet, l&#x27;approche <strong>Code First</strong> sera utilisée pour créer le contexte.</p>
<p>L&#x27;avantage du <strong>Code First</strong> est que la base de données se met à jour par <strong>migration</strong>. La <strong>migration</strong> consiste à générer des fichiers de création et de mise à jour de la base de données à partir du code de programmation. Dans ce projet, ce sera du <strong>C#</strong>. Ce code est facilement intégrable à <strong>Git</strong> et se partage facilement entre les membres de l&#x27;équipe. Un fichier de <strong>migration</strong> contient le code pour appliquer les modifications et le code pour les annuler. Il est donc facile de faire des retours en arrière et de se mettre rapidement a une version spécifique de la base de données. Il suffit d&#x27;exécuter la dernière version des fichiers de migration pour avoir la base de données à jour. Il est également possible de revenir à une ancienne version facilement en exécutant le fichier de migration correspondant.</p>
<p>Un autre avantage est qu&#x27;il est possible de créer le contexte selon des standards internes. Par exemple, la pluralisation ne fonctionne pas bien en français. Il est donc possible de mettre un préfixe ou un suffixe a des éléments pour différencier une référence unitaire ou une collection.</p>
<p>Il est important que <strong>la base de données n&#x27;existe pas</strong> dans votre <strong>SQL Server</strong> lors de l&#x27;exécution de la première migration.</p>
<p>Le site <strong>Entity Framework Tutorial</strong> (anglais seulement) explique plusieurs éléments du fonctionnement du contexte. C&#x27;est un très bon tutoriel. <strong><a href="https://www.entityframeworktutorial.net/efcore/entity-framework-core.aspx" target="_blank" rel="noopener noreferrer">https://www.entityframeworktutorial.net/efcore/entity-framework-core.aspx</a></strong></p>
<p>Voici le site officiel de Microsoft pour la migration de <strong>Entity Framework Core</strong>. <strong><a href="https://learn.microsoft.com/fr-ca/ef/core/managing-schemas/migrations/?tabs=vs" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/fr-ca/ef/core/managing-schemas/migrations/?tabs=vs</a></strong></p>
<p>L&#x27;approche utilisée dans ce document pour gérer la migration est directement par la librairie de classe. La migration sera indépendante du projet <strong>exécutable</strong> (WPF, WinForm, Console, ASP.NET MVC, Blazor...). Cette approche doit ajouter des configurations dans le contexte, mais permet d&#x27;être indépendant de l&#x27;exécutable. Il est possible pour un programmeur de gérer la base de données sans avoir accès à la solution complète. L&#x27;approche présentée dans ce document nécessite de spécifier <strong>une chaine de connexion en mémoire</strong>, mais elle ne nécessite pas un projet de démarrage.</p>
<p>Il est possible de gérer la migration à partir du projet <strong>exécutable</strong>. L&#x27;avantage d&#x27;avoir un projet exécutable lors de la mise en place de la migration est qu&#x27;il est possible d&#x27;utiliser le fichier de configuration du projet pour se synchroniser avec la base de données. <strong>Par contre</strong>, la mise en place d&#x27;un projet démarrable peut demander du temps. Si le projet démarrable est mal configuré, la migration ne fonctionnera pas. Il est possible que la solution possède plusieurs projets de démarrage (WPF et API). Il faut donc que chacun des projets soit en mesure de gérer la migration.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="diagramme-entité-association">Diagramme entité-association<a href="#diagramme-entité-association" class="hash-link" aria-label="Direct link to Diagramme entité-association" title="Direct link to Diagramme entité-association">​</a></h2>
<p>Voici le DEA initial de l&#x27;application. Le DEA évoluera en cours de route pour pratiquer les migrations en cours de projet.</p>
<img src="/4N1_2024/img/13_dea_supercarte.png">
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="création-du-projet---supercarteef">Création du projet - SuperCarte.EF<a href="#création-du-projet---supercarteef" class="hash-link" aria-label="Direct link to Création du projet - SuperCarte.EF" title="Direct link to Création du projet - SuperCarte.EF">​</a></h2>
<p>Pour débuter, il faut créer le projet qui contiendra le <strong>contexte</strong> et les classes du modèle.</p>
<p>Créez un projet de type <strong>Bibliothèque de classe</strong>. Il est important <strong>de ne pas choisir</strong> la version <strong>.NET Framework</strong>.</p>
<ul>
<li><strong>Nom du projet</strong> : SuperCarte.EF</li>
<li><strong>Nom de la solution</strong> : SuperCarteApp</li>
<li><strong>Infrastructure</strong> : .NET 7</li>
</ul>
<p>Remarquez que le nom de la solution n&#x27;est pas identique au projet, car la solution représente l&#x27;application et le projet une partie de l&#x27;application.</p>
<p>Supprimez la classe <strong>Class1.cs</strong>.</p>
<p>Une <strong>Bibliothèque de classe</strong> est une librairie interne. Ce type de projet n&#x27;est pas en mesure de s&#x27;exécuter de façon autonome. Pour être utilisable, ce projet doit être intégré dans un projet <strong>exécutable</strong> (WPF, WinForm, Console, ASP.NET MVC, Blazor...).</p>
<p>Ce projet contiendra uniquement le <strong>contexte</strong> et les classes du modèle de données.</p>
<p>Dans la <strong>Console du Gestionnaire de package</strong>, installez les 2 librairies ci-dessous.</p>
<p>La première librairie est pour le serveur utilisé avec le contexte. Dans notre cas, c&#x27;est <strong>SQL Server</strong>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Install-Package Microsoft.EntityFrameworkCore.SqlServer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>La 2e librairie est pour les outils de migration. C&#x27;est la même librairie que pour l&#x27;outil <strong><code>Scaffold-DbContext</code></strong> de l&#x27;approche <strong>Database First</strong>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Install-Package Microsoft.EntityFrameworkCore.Tools</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="création-du-modèle">Création du modèle<a href="#création-du-modèle" class="hash-link" aria-label="Direct link to Création du modèle" title="Direct link to Création du modèle">​</a></h2>
<p>Il faut reproduire les classes du modèle pour représenter le <strong>DEA</strong>.</p>
<p>En premier lieu, il faut créer toutes les classes vides, car les propriétés de navigation font des références circulaires. Si la classe n&#x27;existe pas, Visual Studio va indiquer une erreur.</p>
<p>Créez le dossier <strong>Data</strong>.</p>
<p>Créez toutes les classes ci-dessous dans le dossier <strong>Data</strong>.</p>
<ul>
<li>Role.cs</li>
<li>Utilisateur.cs</li>
<li>Categorie.cs</li>
<li>Ensemble.cs</li>
<li>Carte.cs</li>
<li>UtilisateurCarte.cs</li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Une propriété de navigation qui représente la relation <strong>1 à Plusieurs</strong> auront le suffixe <strong>Liste</strong> pour les différencier des relations <strong>Plusieurs à 1</strong>, car il s&#x27;agit d&#x27;une collection d&#x27;éléments.</p><p>Pour une propriété de navigation qui représente une relation <strong>Plusieurs à 1</strong>, le nom de la propriété de navigation sera le nom de la classe.</p></div></div>
<p>Voici le code de la classe <strong>Role.cs</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.EF.Data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Role</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int RoleId { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string Nom { get; set; } = null!;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ICollection&lt;Utilisateur&gt; UtilisateurListe { get; set; } = new List&lt;Utilisateur&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Voici le code de la classe <strong>Utilisateur.cs</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.EF.Data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Utilisateur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int UtilisateurId {  get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string Prenom { get; set; } = null!;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string Nom { get; set; } = null!;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string NomUtilisateur { get; set; } = null!;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string MotPasseHash { get; set; } = null!;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int RoleId { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Role Role { get; set; } = null!;   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Voici le code de  la classe <strong>Categorie.cs</strong>.</p>
<p>Remarquez que le champ <strong>Description</strong> est <strong>nullable</strong> comme dans le <strong>DEA</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.EF.Data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Categorie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int CategorieId { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string Nom { get; set; } = null!;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string? Description { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ICollection&lt;Carte&gt; CarteListe { get; set; } = new List&lt;Carte&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Voici le code de la classe <strong>Ensemble.cs</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.EF.Data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Ensemble</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int EnsembleId { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string Nom { get; set; } = null!;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DateTime Disponibilite { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ICollection&lt;Carte&gt; CarteListe { get; set; } = new List&lt;Carte&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Voici le code de la classe <strong>Carte.cs</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.EF.Data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Carte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int CarteId { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string Nom { get; set; } = null!;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public short Vie { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public short Armure { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public short Attaque { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public bool EstRare { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public decimal PrixRevente { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int CategorieId { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int EnsembleId { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Categorie Categorie { get; set; } = null!;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Ensemble Ensemble { get; set; } = null!;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>La classe <strong>UtilisateurCarte.cs</strong> reste vide pour l&#x27;instant.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="création-du-contexte">Création du contexte<a href="#création-du-contexte" class="hash-link" aria-label="Direct link to Création du contexte" title="Direct link to Création du contexte">​</a></h2>
<p>Pour que la migration fonctionne, il faut avoir un <strong>contexte</strong>, une configuration de base, des <strong>DBSet</strong>.</p>
<p>Chacune des classes qui sont inscrites dans un <strong>DbSet</strong> doit avoir une clé primaire. Par convention, la propriété qui se nomme <strong>Id</strong> ou <strong>[Nom de la Classe]Id</strong>  dans la classe du modèle est automatiquement considérée comme la clé primaire.</p>
<p>Également, pour les clés étrangères, il faut la propriété de navigation <strong>Plusieurs à 1</strong> et une propriété du même nom avec <strong>Id</strong> comme suffixe. Par convention, une clé étrangère a le même nom que la clé primaire de la table parent. Donc pour une clé étrangère qui utilise la table <strong>Maison</strong>, la propriété de navigation serait <strong>Maison</strong> et la propriété de la clé serait <strong>MaisonId</strong>. Par défaut, la clé étrangère est <strong><code>ON DELETE CASCADE</code></strong> et <strong><code>ON UPDATE NO ACTION</code></strong>. Si la classe parent possède une collection de la classe enfant, le lien sera fait automatiquement. Si la table avait 2 clés étrangères sur la même table, il faudrait configurer la relation dans le contexte.</p>
<p>Par exemple, pour la classe <strong>Carte.cs</strong>, il y a la clé étrangère vers la table parent <strong>Categorie</strong>. Mais il serait possible de modifier la convention en effectuant le 2e exemple. Il faut par contre que le couple de propriétés <strong>Navigation et clé étrangère</strong> respecte la convention.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//Convention</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public int CategorieId { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public Categorie Categorie { get; set; } = null!;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/***/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//Ceci ferait également une relation entre la table Categorie et Carte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public int CatId { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public Categorie Cat { get; set; } = null!;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Créez le dossier <strong>Data\Context</strong>.</p>
<p>Créez la classe <strong>SuperCarteContext</strong> dans le dossier <strong>Data\Context</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using Microsoft.EntityFrameworkCore;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.EF.Data.Context;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Contexte pour la base de de données SuperCarte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SuperCarteContext : DbContext</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Constructeur pour la migration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	public SuperCarteContext() : base()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Constructeur pour l&#x27;utilisation en programme</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;options&quot;&gt;Option de la base de données&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public SuperCarteContext(DbContextOptions&lt;SuperCarteContext&gt; options)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        : base(options)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#if DEBUG //Permet d&#x27;inclure cette méthode uniquement si l&#x27;application est en mode DEBUG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Vérifie si la configuration n&#x27;a pas été spécifiée par un fichier de configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (optionsBuilder.IsConfigured == false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Aucune configuration à partir d&#x27;un fichier de configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Option de base pour la migration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            string? chaineConnexion = Environment.GetEnvironmentVariable(&quot;MIGRATION_CONNECTION_STRING&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Vérifie si la variable n&#x27;est pas vide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (string.IsNullOrEmpty(chaineConnexion) == false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //La variable n&#x27;est pas vide, la chaine de connexion est appliquée</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                optionsBuilder.UseSqlServer(chaineConnexion);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //Il n&#x27;y a aucune chaine de connexion.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                throw new Exception(&quot;La variable MIGRATION_CONNECTION_STRING n&#x27;est pas spécifiée. Effectuez la commande suivante dans la Console du Gestionnaire de package : $env:MIGRATION_CONNECTION_STRING=\&quot;[ma chaine de connexion]\&quot; &quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#endif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;Role&gt; RoleTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;Utilisateur&gt; UtilisateurTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;Categorie&gt; CategorieTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;Ensemble&gt; EnsembleTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;Carte&gt; CarteTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Premièrement, la classe hérite de <strong>DbContext</strong>. Cette classe contient toute la mécanique de communication et de synchronisation du modèle objet avec la base de données. La classe spécifique <strong>SuperCarteContext</strong> contient uniquement la définition de la base de données relationnelle.</p>
<p>Avec le nom des tables de cette base de données, il serait possible d&#x27;utiliser la convention du pluriel. Par contre, avec l&#x27;évolution de la base de données , il serait possible qu&#x27;une nouvelle table se termine par <strong>s</strong> s&#x27;ajoute. Il ne serait donc pas possible de mettre la règle du pluriel.</p>
<p>Il est possible de choisir le nom des <strong>DbSet</strong>. Pour ce projet, le suffixe <strong>Tb</strong> sera ajouté pour indiquer que c&#x27;est la table.</p>
<p>La table <strong>UtilisateurCarte</strong> est volontairement <strong>exclue</strong> des <strong>DbSet</strong> pour l&#x27;instant, car elle n&#x27;a pas de clé primaire unique, mais une clé primaire composée. Ce concept sera présenté à la section 2.5.2.</p>
<p>La méthode <strong><code>OnConfiguring</code></strong> contient la logique pour la configuration du serveur par un fichier externe ou par une variable d&#x27;environnement. La clause <strong><code>#if DEBUG</code></strong> indique au compilateur de tenir compte du code seulement si l&#x27;application est en mode <strong>Debug</strong>. Il ne faut pas que cette configuration soit accessible en production.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="variable-denvironnement-migration_connection_string">Variable d&#x27;environnement <code>MIGRATION_CONNECTION_STRING</code><a href="#variable-denvironnement-migration_connection_string" class="hash-link" aria-label="Direct link to variable-denvironnement-migration_connection_string" title="Direct link to variable-denvironnement-migration_connection_string">​</a></h3>
<p>Il faut assigner la chaine de connexion dans la variable d&#x27;environnement <strong><code>MIGRATION_CONNECTION_STRING</code></strong>.</p>
<p>Il faut faire cette étape à chaque démarrage de <strong>Visual Studio</strong> s&#x27;il est nécessaire d&#x27;effectuer des migrations.</p>
<p>Dans la <strong>Console du Gestionnaire de package</strong>, inscrivez la commande ci-dessous. Il est important que le <strong>Projet par défaut</strong> de <strong>Entity Framework</strong> soit sélectionné dans la console. Pour ce projet, ce doit être <strong>SuperCarte.EF</strong>. À ce stade, il y a un seul projet, <strong>SuperCarte.EF</strong> sera le seul de la liste.</p>
<p>Pour ce projet, utilisez cette chaine de connexion. Le nom de la base de données est <strong>eDA_4N1_SuperCarte</strong>. Modifiez le <strong>DA</strong> par votre numéro d&#x27;admission.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$env:MIGRATION_CONNECTION_STRING = &quot;Server=localhost\SQLExpress;Database=eDA_4N1_SuperCarte;Trusted_Connection=True;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Voici la commande avec le <strong><code>Trusted_Connection=True;</code></strong> , si vous avez l&#x27;erreur <strong>SSL</strong>.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$env:MIGRATION_CONNECTION_STRING = &quot;Server=localhost\SQLExpress;Database=eDA_4N1_SuperCarte;Trusted_Connection=True;Trust Server Certificate=True;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Si vous oubliez cette étape, vous allez avoir ce message lors de l&#x27;utilisation des commandes de migration. C&#x27;est l&#x27;exception de la ligne 46 de la classe du contexte.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">La variable SQL_CONNECTION_STRING n&#x27;est pas spécifiée. Effectuez la commande suivante dans la Console du Gestionnaire de package : $env:MIGRATION_CONNECTION_STRING=&quot;{ma chaine de connexion}&quot; </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="création-du-fichier-de-migration">Création du fichier de migration<a href="#création-du-fichier-de-migration" class="hash-link" aria-label="Direct link to Création du fichier de migration" title="Direct link to Création du fichier de migration">​</a></h3>
<p>Le contexte n&#x27;est pas complet, mais il est possible de créer une base de données.</p>
<p>Il faut créer un fichier de migration. La syntaxe de la commande est ceci.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Add-Migration [nom migration] -StartupProject [Nom Projet Entity Framework]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Dans la <strong>Console du Gestionnaire de package</strong>, inscrivez la commande ci-dessous. Il est important que le <strong>Projet par défaut</strong> de <strong>Entity Framework</strong> soit sélectionné dans la console, même s&#x27;il est indiqué dans la ligne de commande. Pour ce projet, ce doit être <strong>SuperCarte.EF</strong>.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Add-Migration CreationBD -StartupProject SuperCarte.EF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Il y a maintenant un dossier <strong>Migration</strong>. À l&#x27;intérieur, il y a un fichier avec un <strong>timestamp</strong> avec le nom de la migration. L&#x27;outil <strong>Add-Migration</strong> s&#x27;occupe d&#x27;analyser le contexte et de créer le fichier de migration correspondant. Il serait possible de faire ce fichier manuellement ou à partir d&#x27;une autre librairie.</p>
<p>Voici le fichier. La méthode <strong><code>Up</code></strong> permet d&#x27;appliquer la migration à la base de données et la méthode <strong><code>Down</code></strong> est de la retirer. Il n&#x27;est pas recommandé de modifier ce fichier s&#x27;il a été généré par un outil., car il ne sera plus en <strong>synchronisation</strong> avec le <strong>contexte</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using System;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using Microsoft.EntityFrameworkCore.Migrations;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#nullable disable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.EF.Migrations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;inheritdoc /&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public partial class CreationBD : Migration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /// &lt;inheritdoc /&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protected override void Up(MigrationBuilder migrationBuilder)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            migrationBuilder.CreateTable(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name: &quot;CategorieTb&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                columns: table =&gt; new</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    CategorieId = table.Column&lt;int&gt;(type: &quot;int&quot;, nullable: false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        .Annotation(&quot;SqlServer:Identity&quot;, &quot;1, 1&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Nom = table.Column&lt;string&gt;(type: &quot;nvarchar(max)&quot;, nullable: false),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Description = table.Column&lt;string&gt;(type: &quot;nvarchar(max)&quot;, nullable: true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                constraints: table =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    table.PrimaryKey(&quot;PK_CategorieTb&quot;, x =&gt; x.CategorieId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            migrationBuilder.CreateTable(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name: &quot;EnsembleTb&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                columns: table =&gt; new</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    EnsembleId = table.Column&lt;int&gt;(type: &quot;int&quot;, nullable: false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        .Annotation(&quot;SqlServer:Identity&quot;, &quot;1, 1&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Nom = table.Column&lt;string&gt;(type: &quot;nvarchar(max)&quot;, nullable: false),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Disponibilite = table.Column&lt;DateTime&gt;(type: &quot;datetime2&quot;, nullable: false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                constraints: table =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    table.PrimaryKey(&quot;PK_EnsembleTb&quot;, x =&gt; x.EnsembleId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            migrationBuilder.CreateTable(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name: &quot;RoleTb&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                columns: table =&gt; new</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    RoleId = table.Column&lt;int&gt;(type: &quot;int&quot;, nullable: false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        .Annotation(&quot;SqlServer:Identity&quot;, &quot;1, 1&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Nom = table.Column&lt;string&gt;(type: &quot;nvarchar(max)&quot;, nullable: false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                constraints: table =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    table.PrimaryKey(&quot;PK_RoleTb&quot;, x =&gt; x.RoleId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            migrationBuilder.CreateTable(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name: &quot;CarteTb&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                columns: table =&gt; new</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    CarteId = table.Column&lt;int&gt;(type: &quot;int&quot;, nullable: false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        .Annotation(&quot;SqlServer:Identity&quot;, &quot;1, 1&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Nom = table.Column&lt;string&gt;(type: &quot;nvarchar(max)&quot;, nullable: false),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Vie = table.Column&lt;short&gt;(type: &quot;smallint&quot;, nullable: false),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Armure = table.Column&lt;short&gt;(type: &quot;smallint&quot;, nullable: false),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Attaque = table.Column&lt;short&gt;(type: &quot;smallint&quot;, nullable: false),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    EstRare = table.Column&lt;bool&gt;(type: &quot;bit&quot;, nullable: false),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    PrixRevente = table.Column&lt;decimal&gt;(type: &quot;decimal(18,2)&quot;, nullable: false),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    CategorieId = table.Column&lt;int&gt;(type: &quot;int&quot;, nullable: false),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    EnsembleId = table.Column&lt;int&gt;(type: &quot;int&quot;, nullable: false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                constraints: table =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    table.PrimaryKey(&quot;PK_CarteTb&quot;, x =&gt; x.CarteId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    table.ForeignKey(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        name: &quot;FK_CarteTb_CategorieTb_CategorieId&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        column: x =&gt; x.CategorieId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        principalTable: &quot;CategorieTb&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        principalColumn: &quot;CategorieId&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        onDelete: ReferentialAction.Cascade);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    table.ForeignKey(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        name: &quot;FK_CarteTb_EnsembleTb_EnsembleId&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        column: x =&gt; x.EnsembleId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        principalTable: &quot;EnsembleTb&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        principalColumn: &quot;EnsembleId&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        onDelete: ReferentialAction.Cascade);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            migrationBuilder.CreateTable(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name: &quot;UtilisateurTb&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                columns: table =&gt; new</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    UtilisateurId = table.Column&lt;int&gt;(type: &quot;int&quot;, nullable: false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        .Annotation(&quot;SqlServer:Identity&quot;, &quot;1, 1&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Prenom = table.Column&lt;string&gt;(type: &quot;nvarchar(max)&quot;, nullable: false),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Nom = table.Column&lt;string&gt;(type: &quot;nvarchar(max)&quot;, nullable: false),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    NomUtilisateur = table.Column&lt;string&gt;(type: &quot;nvarchar(max)&quot;, nullable: false),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    MotPasseHash = table.Column&lt;string&gt;(type: &quot;nvarchar(max)&quot;, nullable: false),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    RoleId = table.Column&lt;int&gt;(type: &quot;int&quot;, nullable: false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                constraints: table =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    table.PrimaryKey(&quot;PK_UtilisateurTb&quot;, x =&gt; x.UtilisateurId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    table.ForeignKey(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        name: &quot;FK_UtilisateurTb_RoleTb_RoleId&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        column: x =&gt; x.RoleId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        principalTable: &quot;RoleTb&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        principalColumn: &quot;RoleId&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        onDelete: ReferentialAction.Cascade);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            migrationBuilder.CreateIndex(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name: &quot;IX_CarteTb_CategorieId&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                table: &quot;CarteTb&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                column: &quot;CategorieId&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            migrationBuilder.CreateIndex(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name: &quot;IX_CarteTb_EnsembleId&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                table: &quot;CarteTb&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                column: &quot;EnsembleId&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            migrationBuilder.CreateIndex(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name: &quot;IX_UtilisateurTb_RoleId&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                table: &quot;UtilisateurTb&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                column: &quot;RoleId&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /// &lt;inheritdoc /&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protected override void Down(MigrationBuilder migrationBuilder)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            migrationBuilder.DropTable(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name: &quot;CarteTb&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            migrationBuilder.DropTable(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name: &quot;UtilisateurTb&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            migrationBuilder.DropTable(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name: &quot;CategorieTb&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            migrationBuilder.DropTable(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name: &quot;EnsembleTb&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            migrationBuilder.DropTable(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name: &quot;RoleTb&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Les fichiers de migration sont incrémentaux. La génération d&#x27;une migration se base sur le fichier <strong>snapshot</strong> du dossier de migration. Il est important d&#x27;utiliser la commande <strong><code>Remove-Migration</code></strong> pour retirer une migration de la liste et non supprimer le fichier manuellement. L&#x27;annexe à la fin du document explique le fonctionnement du <strong><code>Remove-Migration</code></strong>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="synchronisation-de-la-base-de-données">Synchronisation de la base de données<a href="#synchronisation-de-la-base-de-données" class="hash-link" aria-label="Direct link to Synchronisation de la base de données" title="Direct link to Synchronisation de la base de données">​</a></h3>
<p>Pour synchroniser une migration avec la base de données, il faut utiliser l&#x27;utilitaire <strong>Update-Database</strong>.</p>
<p>Voici la syntaxe.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Update-Database -StartupProject [Nom Projet Entity Framework] -Migration [Nom migration]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Si l&#x27;argument <strong><code>-Migration</code></strong> n&#x27;est pas spécifié, ce sera toutes les migrations qui seront appliquées.</p>
<p>Également, dans la chaine de connexion de la variable <strong><code>MIGRATION_CONNECTION_STRING</code></strong>, il faut s&#x27;assurer que l&#x27;utilisateur spécifié soit en mesure de créer des bases de données. Le premier fichier de migration aura le code de création de la base de données.</p>
<p>Pour ce projet, utilisez cette commande.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Update-Database -StartupProject &quot;SuperCarte.EF&quot; -Migration CreationBD</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Ouvrez <strong>SSMS</strong> et la base de données sera présente.</p>
<p>Il y a par contre quelques erreurs. Les tables se terminent par <strong>Tb</strong>. Également, toutes les propriétés <strong><code>string</code></strong> sont des <strong><code>NVARCHAR(max)</code></strong>. Le champ <strong>CarteTb.PrixRevente</strong> est un <strong><code>DECIMAL(18,2)</code></strong>. Le champ <strong>EnsembleTb.Disponible</strong> est un <strong><code>datetime2</code></strong>. Également, le champ <strong>UtilisateurTb.NomUtilisateur</strong>, il n&#x27;est pas unique. Ceci ne respecte pas le <strong>DEA</strong>. Il faut configurer le contexte pour respecter le <strong>DEA</strong>.</p>
<img src="/4N1_2024/img/13_migration_1.png">
<p>L&#x27;utilisation de la migration permet également de conserver les données existantes dans une table.</p>
<p>Dans <strong>SSMS</strong>, insérez un rôle dans la table <strong>RoleTb</strong>.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">USE</span><span class="token plain"> eDA_4N1_SuperCarte</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> RoleTb</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Nom</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Administrateur&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>La clé primaire n&#x27;est pas spécifiée dans le <strong><code>INSERT</code></strong>. La migration considère que la clé primaire d&#x27;une table est <strong>auto incrémentée</strong> par défaut.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-du-contexte---onmodelcreating">Configuration du contexte - OnModelCreating<a href="#configuration-du-contexte---onmodelcreating" class="hash-link" aria-label="Direct link to Configuration du contexte - OnModelCreating" title="Direct link to Configuration du contexte - OnModelCreating">​</a></h2>
<p>Il est possible d&#x27;ajouter des configurations et des spécifications à la base de données.</p>
<p>Il est possible de spécifier le nom de la table pour chacune des classes, les clés primaires composées, des types de données spécifiques, des contraintes sur une colonne...</p>
<p>Il faut les ajouter dans la méthode <strong><code>OnModelCreating</code></strong> du contexte. Il s&#x27;agit du <strong>FluentAPI</strong>. Il est possible de faire plusieurs configurations avec <strong>DataAnnontation</strong> directement avec les classes du modèle, mais certaines configurations doivent être faites obligatoirement avec <strong>FluentAPI</strong>. Également, il y a certaines limitations selon la version de <strong>Entity Framework Core</strong> utilisée. Le <strong>FluentAPI</strong> permet de tout faire. Il est préférable de le faire dans un endroit centralisé.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="nom-des-tables">Nom des tables<a href="#nom-des-tables" class="hash-link" aria-label="Direct link to Nom des tables" title="Direct link to Nom des tables">​</a></h3>
<p>Pour débuter, il faut modifier le nom des tables pour retirer le suffixe <strong>Tb</strong> dans la base de données, mais il faut le conserver dans les <strong><code>DBSet</code></strong>.</p>
<p>Ajoutez la méthode ci-dessous dans la classe <strong>SuperCarteContext.cs</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Configuration spécifique de la base de données</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;param name=&quot;modelBuilder&quot;&gt;&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">protected override void OnModelCreating(ModelBuilder modelBuilder)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //Table Role</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    modelBuilder.Entity&lt;Role&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        entity.ToTable(&quot;Role&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //Table Utilisateur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    modelBuilder.Entity&lt;Utilisateur&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        entity.ToTable(&quot;Utilisateur&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //Table Categorie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    modelBuilder.Entity&lt;Categorie&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        entity.ToTable(&quot;Categorie&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //Table Ensemble</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    modelBuilder.Entity&lt;Ensemble&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        entity.ToTable(&quot;Ensemble&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //Table Carte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    modelBuilder.Entity&lt;Carte&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        entity.ToTable(&quot;Carte&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Pour chacune des <strong>entités (modèles/tables)</strong>, il faut utiliser le <strong><code>modelBuilder</code></strong> pour faire la configuration. Dans une modélisation de données, le terme <strong>Entité</strong> est utilisé pour représenter un concept. <strong>DEA</strong> est pour <strong>Diagramme Entité Association</strong>. Donc une <strong>entité</strong> dans une base de données est une table et pour un modèle objet une classe de modèle de données.</p>
<p>La méthode <strong><code>ToTable()</code></strong> permet d&#x27;indiquer le nom de la table dans la base de données. Il serait possible de s&#x27;adapter aux stadards propres de l&#x27;organisation/technologie en utilisant que des minuscules, <strong>PascalCase</strong>, <strong>camelCase</strong>, la pluralisation, le <strong>underscore</strong> pour une table pivot...</p>
<p>Dans la <strong>Console du gestionnaire de Package</strong>, créez la migration <strong>RenommerTables</strong>.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Add-Migration RenommerTables -StartupProject SuperCarte.EF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Si vous ouvrez le fichier <strong>xxx_RenommerTables.cs</strong> dans le dossier de migration, il y aura seulement la logique pour renommer les tables. En <strong>SQL</strong>, cette tâche demanderait beaucoup de code.</p>
<p>Appliquez la migration avec la commande <strong><code>Update-Database</code></strong>. Il faut spécifier la migration <strong><code>RenommerTables</code></strong>.</p>
<p>Pour ce projet, utilisez cette commande. Le nom de la base de données est <strong>eDA_4N1_SuperCarte</strong>. Modifiez le <strong>DA</strong> par votre numéro d&#x27;admission.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Update-Database -StartupProject SuperCarte.EF -Migration RenommerTables </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Ouvrez <strong>SSMS</strong> et la base de données sera présente avec les nouveaux noms.</p>
<img src="/4N1_2024/img/13_migration_2.png">
<p>Effectuez également la requête ci-dessous. L&#x27;enregistrement <strong>Administrateur</strong> est toujours là.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Role</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>La base de données a également une table <strong>__EFMigrationsHistory</strong>. Cette table permet de lister les migrations qui ont été appliquées sur la base de données.</p>
<p>La table a actuellement ces enregistrements.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MigrationId														ProductVersion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">20230315124209_CreationBD										7.0.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">20230315131307_RenommerTables									7.0.4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Pour revenir à l&#x27;état initial, il faut appliquer de nouveau la migration <strong><code>CreationBD</code></strong>.</p>
<p>Pour ce projet, utilisez cette commande.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Update-Database -Migration CreationBD</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Ouvrez <strong>SSMS</strong> et la base de données sera présente avec les anciens noms.</p>
<p>La table <strong>__EFMigrationsHistory</strong> a seulement cet enregistrement.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MigrationId														ProductVersion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">20230315124209_CreationBD										7.0.4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="créer-une-clé-primaire-composée">Créer une clé primaire composée<a href="#créer-une-clé-primaire-composée" class="hash-link" aria-label="Direct link to Créer une clé primaire composée" title="Direct link to Créer une clé primaire composée">​</a></h3>
<p>Il faut créer une clé primaire composée pour la table <strong>UtilisateurCarte</strong>.</p>
<p>Copiez ce code dans la classe <strong>UtilisateurCarte.cs</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.EF.Data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class UtilisateurCarte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int UtilisateurId { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int CarteId { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public short Quantite { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Utilisateur Utilisateur { get; set; } = null!;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Carte Carte { get; set; } = null!;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Copiez ce code dans la classe <strong>Carte.cs</strong> pour ajouter la collection <strong>UtilisateurCarteListe</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.EF.Data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Carte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int CarteId { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string Nom { get; set; } = null!;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public byte[]? Image { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public short Vie { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public short Armure { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public short Attaque { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public bool EstRare { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public decimal PrixRevente { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int CategorieId { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int EnsembleId { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Categorie Categorie { get; set; } = null!;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Ensemble Ensemble { get; set; } = null!;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ICollection&lt;UtilisateurCarte&gt; UtilisateurCarteListe { get; set; } = new List&lt;UtilisateurCarte&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Copiez ce code dans la classe <strong>Utilisateur.cs</strong> pour ajouter la collection <strong>UtilisateurCarteListe</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.EF.Data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Utilisateur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int UtilisateurId {  get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string Prenom { get; set; } = null!;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string Nom { get; set; } = null!;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string NomUtilisateur { get; set; } = null!;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string MotPasseHash { get; set; } = null!;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int RoleId { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Role Role { get; set; } = null!;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ICollection&lt;UtilisateurCarte&gt; UtilisateurCarteListe { get; set; } = new List&lt;UtilisateurCarte&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Copiez ce code dans la classe <strong>SuperCarteContext</strong>, pour ajouter le <strong><code>DBSet&lt;UtilisateurCarte&gt;</code></strong> dans le contexte. L&#x27;ajout est à la ligne 112. Il a y également la spécification du nom de la table à la ligne 94.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using Microsoft.EntityFrameworkCore;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.EF.Data.Context;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Contexte pour la base de de données SuperCarte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SuperCarteContext : DbContext</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Constructeur pour la migration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	public SuperCarteContext() : base()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Constructeur pour l&#x27;utilisation en programme</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;options&quot;&gt;Option de la base de données&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public SuperCarteContext(DbContextOptions&lt;SuperCarteContext&gt; options)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        : base(options)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#if DEBUG //Permet d&#x27;inclure cette méthode uniquement si l&#x27;application est en mode DEBUG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Vérifie si la configuration n&#x27;a pas été spécifiée par un fichier de configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (optionsBuilder.IsConfigured == false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Aucune configuration à partir d&#x27;un fichier de configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Option de base pour la migration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            string? chaineConnexion = Environment.GetEnvironmentVariable(&quot;MIGRATION_CONNECTION_STRING&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Vérifie si la variable n&#x27;est pas vide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (string.IsNullOrEmpty(chaineConnexion) == false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //La variable n&#x27;est pas vide, la chaine de connexion est appliquée</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                optionsBuilder.UseSqlServer(chaineConnexion);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //Il n&#x27;y a aucune chaine de connexion.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                throw new Exception(&quot;La variable MIGRATION_CONNECTION_STRING n&#x27;est pas spécifiée. Effectuez la commande suivante dans la Console du Gestionnaire de package : $env:MIGRATION_CONNECTION_STRING=\&quot;[ma chaine de connexion]\&quot; &quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#endif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Configuration spécifique de la base de données</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;modelBuilder&quot;&gt;&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected override void OnModelCreating(ModelBuilder modelBuilder)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Table Role</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelBuilder.Entity&lt;Role&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.ToTable(&quot;Role&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Table Utilisateur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelBuilder.Entity&lt;Utilisateur&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.ToTable(&quot;Utilisateur&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Table Categorie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelBuilder.Entity&lt;Categorie&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.ToTable(&quot;Categorie&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Table Ensemble</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelBuilder.Entity&lt;Ensemble&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.ToTable(&quot;Ensemble&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Table Carte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelBuilder.Entity&lt;Carte&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.ToTable(&quot;Carte&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Table UtilisateurCarte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelBuilder.Entity&lt;UtilisateurCarte&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.ToTable(&quot;UtilisateurCarte&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;Role&gt; RoleTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;Utilisateur&gt; UtilisateurTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;Categorie&gt; CategorieTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;Ensemble&gt; EnsembleTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;Carte&gt; CarteTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;UtilisateurCarte&gt; UtilisateurCarteTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Effectuez une nouvelle migration nommée <strong><code>AjouterTableUtilisateurCarte</code></strong>.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Add-Migration AjouterTableUtilisateurCarte -StartupProject SuperCarte.EF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Vous allez avoir ce message d&#x27;erreur.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">The entity type &#x27;UtilisateurCarte&#x27; requires a primary key to be defined. If you intended to use a keyless entity type, call &#x27;HasNoKey&#x27; in &#x27;OnModelCreating&#x27;. For more information on keyless entity types, see https://go.microsoft.com/fwlink/?linkid=2141943.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Ceci indique que la classe <strong>UtilisateurCarte</strong> n&#x27;a pas de clé primaire, car il n&#x27;y a pas de propriété <strong>UtilisateurCarteId</strong>. Le générateur de migration n&#x27;est pas en mesure de déterminer que les propriétés <strong>UtilisateurId</strong> et <strong>CarteId</strong> sont les clés primaires. Il faut donc le spécifier dans le contexte.</p>
<p>Modifiez la partie <strong>UtilisateurCarte</strong> dans la méthode <strong><code>OnModelCreating()</code></strong> du contexte.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//Table UtilisateurCarte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modelBuilder.Entity&lt;UtilisateurCarte&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entity.ToTable(&quot;UtilisateurCarte&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //Spécifie la clé primaire</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entity.HasKey(t =&gt; new { t.UtilisateurId, t.CarteId });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>La méthode <strong><code>HasKey()</code></strong> permet de spécifier la clé primaire. Si la clé est représentée par plusieurs champs, il faut créer un objet dynamique <strong><code>new {}</code></strong> et insérer toutes les propriétés qui représentent la clé primaire.</p>
<p>Il peut arriver qu&#x27;une table n&#x27;utilise pas une clé artificielle pour la clé primaire. Par exemple, la table <strong>Etudiant</strong> peut avoir comme clé primaire le champ <strong>DA</strong> et non <strong>EtudiantId</strong>. Il faudrait spécifier <strong><code>entity.HasKey(t =&gt; t.DA)</code></strong>.</p>
<p>Effectuez une nouvelle migration nommée <strong><code>AjouterTableUtilisateurCarte</code></strong>. Elle devrait fonctionner.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Add-Migration AjouterTableUtilisateurCarte</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Dans le fichier de migration <strong>xxx_AjouterTableUtilisateurCarte.cs</strong> du dossier <strong>Migrations</strong>, il y a seulement la logique de la création de la table <strong>UtilisateurCarte</strong>. Il prend en considération les anciennes migrations, dont <strong><code>RemommerTables</code></strong> même si elle n&#x27;est pas actuellement appliquée.</p>
<p>Appliquez les modifications à la base de données. Spécifiez la migration <strong><code>AjouterTableUtilisateurCarte</code></strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Update-Database -StartupProject SuperCarte.EF -Migration AjouterTableUtilisateurCarte</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Ouvrez <strong>SSMS</strong> et la base de données aura de nouveau les bons noms de table et la table <strong>UtilisateurCarte</strong> est présente avec ses clés primaires.</p>
<img src="/4N1_2024/img/13_migration_3.png">
<p>La table <strong>__EFMigrationsHistory</strong> a toutes les migrations qui ont été appliquées à la base de données. La migration <strong>RenommerTables</strong> a été exécutée de nouveau, car la version de la BD était celle de <strong>CreationBD</strong>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MigrationId														ProductVersion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">20230315124209_CreationBD										7.0.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">20230315131307_RenommerTables									7.0.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">20230315140002_AjouterTableUtilisateurCarte						7.0.4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="type-des-champs---string-decimal-et-date">Type des champs - string, decimal et date<a href="#type-des-champs---string-decimal-et-date" class="hash-link" aria-label="Direct link to Type des champs - string, decimal et date" title="Direct link to Type des champs - string, decimal et date">​</a></h3>
<p>Actuellement, toutes les chaines de caractères sont des <strong>NVARCHAR(MAX)</strong>. Il est de plus en plus fréquent de ne plus spécifier la longueur des chaines de caractères qui ne sont pas fixes, car il est difficile de déterminer la bonne longueur pour plusieurs champs. La longueur est souvent spécifiée par l&#x27;expérience, mais sans considération valable. Le <strong>NVARCHAR(MAX)</strong> va seulement utiliser l&#x27;espace nécessaire. La gestion des contraintes se fait plus au niveau du logiciel maintenant. Si la longueur maximale doit être modifiée, il n&#x27;est pas nécessaire de modifier la base de données, seulement la partie <strong>validation</strong> dans le logiciel.</p>
<p>Mais en tant que programmeur, il faut réaliser le <strong>DEA</strong> tel que produit par le concepteur. Si vous êtes le concepteur, posez-vous la question s&#x27;il est nécessaire de limiter la longueur d&#x27;un champ ou de ne pas permettre le <strong>unicode</strong>.</p>
<p>Le <strong><code>modelBuilder</code></strong> a la méthode <strong><code>Property()</code></strong> qui permet de spécifier les éléments spécifiques à un champ. La méthode <strong><code>Property()</code></strong> est chainable, donc il est possible d&#x27;ajouter toutes les spécifications d&#x27;un coup pour une propriété. Elle reçoit en paramètre une fonction <strong>Lambda</strong> pour spécifier la propriété. La variable <strong><code>t</code></strong> est utilisée pour <strong>Table</strong>. Ensuite, les autres méthodes chainables permettent de configurer la propriété/champ.</p>
<p>Pour spécifier la longueur maximale, c&#x27;est la méthode <strong><code>HasMaxLength()</code></strong> qui permet de la spécifier.</p>
<p>Dans le <strong>DEA</strong>, ce sont des <strong><code>VARCHAR</code></strong> et non des <strong><code>NVARCHAR</code></strong>. La méthode <strong><code>IsUnicode(false)</code></strong> permet d&#x27;indiquer que ce n&#x27;est pas un <strong><code>NVARCHAR</code></strong>.</p>
<p>Voici les exemples pour la configuration des différents cas. La classe complète sera fournise à la fin de la section.</p>
<p>Pour la table <strong>Role</strong></p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//Table Role</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modelBuilder.Entity&lt;Role&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entity.ToTable(&quot;Role&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entity.Property(t =&gt; t.Nom)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .IsUnicode(false) //VARCHAR ou CHAR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .HasMaxLength(25); //VARCHAR(25)        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Pour la table <strong>Utilisateur</strong>, le champ <strong>MotPasseHash</strong> est un <strong><code>CHAR(60)</code></strong>. La longueur d&#x27;un <strong>Hash</strong> est fixe à 60 caractères pour l&#x27;algorithme <strong>Bcrypt</strong>. Ce sera l&#x27;algorithme utilisé pour ce projet. Pour ce cas, il est pertinent pour le concepteur de fixer la longueur. La méthode <strong><code>IsFixedLength()</code></strong> permet d&#x27;indiquer que c&#x27;est un <strong><code>NCHAR</code></strong> ou un <strong><code>CHAR</code></strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//Table Utilisateur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modelBuilder.Entity&lt;Utilisateur&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entity.ToTable(&quot;Utilisateur&quot;);           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entity.Property(t =&gt; t.MotPasseHash)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .IsFixedLength(true) //CHAR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .HasMaxLength(60);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /*Autres colonnes à ajouter*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Pour la table <strong>Carte</strong>, le champ <strong>PrixRevente</strong> doit être un <strong><code>DECIMAL(8,2)</code></strong>. La méthode <strong><code>HasPrecision()</code></strong> permet de préciser la précision d&#x27;un <strong><code>DECIMAL</code></strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//Table Carte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modelBuilder.Entity&lt;Carte&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entity.ToTable(&quot;Carte&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entity.Property(t =&gt; t.PrixRevente)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .HasPrecision(8, 2); //DECIMAL(8,2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Pour la table <strong>Ensemble</strong>, le champ <strong>Disponibilite</strong> doit être de type <strong>DATE</strong>. Actuellement c&#x27;est un <strong>DATETIME2</strong>. La méthode <strong><code>HasColumnType()</code></strong> permet de spécifier directement un type. Il faut s&#x27;assurer que le type est compatible avec celui de la classe.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//Table Ensemble</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modelBuilder.Entity&lt;Ensemble&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entity.ToTable(&quot;Ensemble&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entity.Property(t =&gt; t.Disponibilite)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .HasColumnType(&quot;DATE&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Voici la classe <strong>SuperCarteContext.cs</strong> au complet avec tous les ajustements pour les champs.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using Microsoft.EntityFrameworkCore;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.EF.Data.Context;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Contexte pour la base de de données SuperCarte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SuperCarteContext : DbContext</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Constructeur pour la migration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	public SuperCarteContext() : base()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Constructeur pour l&#x27;utilisation en programme</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;options&quot;&gt;Option de la base de données&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public SuperCarteContext(DbContextOptions&lt;SuperCarteContext&gt; options)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        : base(options)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#if DEBUG //Permet d&#x27;inclure cette méthode uniquement si l&#x27;application est en mode DEBUG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Vérifie si la configuration n&#x27;a pas été spécifiée par un fichier de configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (optionsBuilder.IsConfigured == false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Aucune configuration à partir d&#x27;un fichier de configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Option de base pour la migration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            string? chaineConnexion = Environment.GetEnvironmentVariable(&quot;MIGRATION_CONNECTION_STRING&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Vérifie si la variable n&#x27;est pas vide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (string.IsNullOrEmpty(chaineConnexion) == false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //La variable n&#x27;est pas vide, la chaine de connexion est appliquée</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                optionsBuilder.UseSqlServer(chaineConnexion);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //Il n&#x27;y a aucune chaine de connexion.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                throw new Exception(&quot;La variable MIGRATION_CONNECTION_STRING n&#x27;est pas spécifiée. Effectuez la commande suivante dans la Console du Gestionnaire de package : $env:MIGRATION_CONNECTION_STRING=\&quot;[ma chaine de connexion]\&quot; &quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#endif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Configuration spécifique de la base de données</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;modelBuilder&quot;&gt;&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected override void OnModelCreating(ModelBuilder modelBuilder)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Table Role</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelBuilder.Entity&lt;Role&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.ToTable(&quot;Role&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.Nom)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .IsUnicode(false) //VARCHAR ou CHAR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .HasMaxLength(25); //VARCHAR(25)   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Table Utilisateur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelBuilder.Entity&lt;Utilisateur&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.ToTable(&quot;Utilisateur&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.Prenom)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .IsUnicode(false)                    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .HasMaxLength(50);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.Nom)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .HasMaxLength(50);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.NomUtilisateur)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .HasMaxLength(50);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.MotPasseHash)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .IsFixedLength(true) //CHAR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .HasMaxLength(60);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Table Categorie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelBuilder.Entity&lt;Categorie&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.ToTable(&quot;Categorie&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.Nom)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .HasMaxLength(35);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.Description)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .HasMaxLength(50);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Table Ensemble</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelBuilder.Entity&lt;Ensemble&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.ToTable(&quot;Ensemble&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.Nom)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .HasMaxLength(50);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.Disponibilite)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .HasColumnType(&quot;DATE&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Table Carte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelBuilder.Entity&lt;Carte&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.ToTable(&quot;Carte&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.Nom)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .HasMaxLength(100);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.PrixRevente)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .HasPrecision(8,2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Table UtilisateurCarte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelBuilder.Entity&lt;UtilisateurCarte&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.ToTable(&quot;UtilisateurCarte&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie la clé primaire</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.HasKey(t =&gt; new { t.UtilisateurId, t.CarteId });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;Role&gt; RoleTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;Utilisateur&gt; UtilisateurTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;Categorie&gt; CategorieTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;Ensemble&gt; EnsembleTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;Carte&gt; CarteTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;UtilisateurCarte&gt; UtilisateurCarteTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Créez la migration <strong>CorrectionType</strong>.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Add-Migration CorrectionType -StartupProject SuperCarte.EF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Appliquez les modifications à la base de données. Spécifiez la migration <strong><code>CorrectionType</code></strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Update-Database -StartupProject SuperCarte.EF -Migration CorrectionType</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Ouvrez <strong>SSMS</strong> et la base de données aura les nouveaux types pour les champs modifiés.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ajout-dune-contrainte-dunicité">Ajout d&#x27;une contrainte d&#x27;unicité<a href="#ajout-dune-contrainte-dunicité" class="hash-link" aria-label="Direct link to Ajout d&#x27;une contrainte d&#x27;unicité" title="Direct link to Ajout d&#x27;une contrainte d&#x27;unicité">​</a></h3>
<p>Pour la table <strong>Utilisateur</strong>, le champ <strong>NomUtilisateur</strong> doit être unique.</p>
<p>Cette contrainte est assez importante dans la base de données, car s&#x27;il y a un problème dans l&#x27;application pour faire la validation d&#x27;un doublon, l&#x27;application aurait une faille de sécurité.</p>
<p>Une contrainte d&#x27;unicité permet de créer un <strong>index</strong> de recherche sur le champ et d&#x27;indiquer la contrainte <strong>UNIQUE</strong>. Il faut donc créer un <strong>index</strong> dans le contexte et de le spécifier comme unique. La spécification est à la ligne 24. Par contre, dans la base de données, il n&#x27;y aura pas de contrainte explicite <strong>UNIQUE</strong> sur le champ. Ce sera uniquement l&#x27;index qui s&#x27;occupera de valider l&#x27;unicité. L&#x27;ajout de l&#x27;index unique est à la ligne 24 du code ci-dessous.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//Table Utilisateur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modelBuilder.Entity&lt;Utilisateur&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entity.ToTable(&quot;Utilisateur&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entity.Property(t =&gt; t.Prenom)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .IsUnicode(false)                    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .HasMaxLength(50);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entity.Property(t =&gt; t.Nom)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .HasMaxLength(50);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entity.Property(t =&gt; t.NomUtilisateur)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .HasMaxLength(50);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entity.Property(t =&gt; t.MotPasseHash)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .IsFixedLength(true) //CHAR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .HasMaxLength(60);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entity.HasIndex(t =&gt; t.NomUtilisateur).IsUnique(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Créez la migration <strong>UtilisateurNomUtilisateurUnique</strong>.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Add-Migration UtilisateurNomUtilisateurUnique -StartupProject SuperCarte.EF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Appliquez les modifications à la base de données. Spécifiez la migration <strong><code>UtilisateurNomUtilisateurUnique</code></strong>.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Update-Database -StartupProject SuperCarte.EF -Migration UtilisateurNomUtilisateurUnique</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Ouvrez <strong>SSMS</strong> et la base de données aura l&#x27;index avec la mention <strong>Unique</strong> sur le champ <strong>NomUtilisateur</strong>. Il n&#x27;aura pas de contrainte <strong>UNIQUE</strong> sur le champ, mais le résultat est le même.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mettre-on-delete-no-action-sur-les-clés-étrangères">Mettre ON DELETE NO ACTION sur les clés étrangères<a href="#mettre-on-delete-no-action-sur-les-clés-étrangères" class="hash-link" aria-label="Direct link to Mettre ON DELETE NO ACTION sur les clés étrangères" title="Direct link to Mettre ON DELETE NO ACTION sur les clés étrangères">​</a></h2>
<p>Par défaut, les clés étrangères ont la règle <strong><code>ON DELETE CASCADE</code></strong>. Dans certains cas, ce comportement peut être intéressant, car ceci permet de supprimer plusieurs enregistrements à partie de l&#x27;enregistrement parent.</p>
<p>Pour la table <strong>UtilisateurCarte</strong>, il pourrait être intéressant de conserver le <strong><code>ON DELETE CASCADE</code></strong> sur la clé étrangère <strong>UtilisateurId</strong>. Si l&#x27;utilisateur est supprimé, les cartes qu&#x27;ils possèdent le seront également.</p>
<p>Par contre, pour la clé étrangère carte, il n&#x27;est pas intéressant de le faire, car si une carte est supprimée, elle disparaitrait de tous les utilisateurs. L&#x27;administrateur avant de supprimer une carte qui est utilisée par des utilisateurs devra prendre une action spéciale s&#x27;il désire réellement supprimer la carte, soit en offrant une nouvelle carte en compensation. Il serait possible de gérer ce comportement dans le code uniquement, mais en cas de <strong>bug</strong>, les conséquences peuvent être importantes. Il peut être préférable de limiter ce comportement dans la base de données également.</p>
<p>Pour le <strong><code>ON UPDATE</code></strong>, il est toujours à **<code>NO ACTION</code>**avec <strong>Entity Framework</strong>, même si la table est configurée de cette façon dans la base de données.</p>
<p>Pour l&#x27;instant, toutes les clés étrangères auront <strong><code>ON DELETE NO ACTION</code></strong>. Pour <strong>Entity Framework</strong>, il faut mettre <strong><code>DeleteBehavior.ClientSetNull</code></strong>.</p>
<p>Il faut donc configurer manuellement dans le <strong>contexte</strong> la relation <strong>Plusieurs à 1</strong> avec la méthode <strong><code>HasOne()</code></strong>.</p>
<p>Pour la table <strong>Utilisateur</strong>, la relation est avec la table <strong>Role</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//Table Utilisateur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modelBuilder.Entity&lt;Utilisateur&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** Code précédent retiré pour l&#x27;exemple uniquement **/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entity.HasOne(t =&gt; t.Role).WithMany(p =&gt; p.UtilisateurListe)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .HasForeignKey(t =&gt; t.RoleId)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .OnDelete(DeleteBehavior.ClientSetNull);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>La méthode <strong><code>HasOne(t =&gt; t.Role)</code></strong> indique qu&#x27;il y a une relation <strong>Plusieurs à 1</strong> avec la table/modèle <strong>Role</strong>.</p>
<p>La méthode <strong><code>WithMany(p =&gt; p.UtilisateurListe)</code></strong> indique la relation <strong>1 à plusieurs</strong> de la table/modèle <strong>Role</strong> avec la table/modèle <strong>Utilisateur</strong>. La variable <strong><code>p</code></strong> est pour <strong>Table Parent</strong>.</p>
<p>La méthode <strong><code>HasForeignKey(t =&gt; t.RoleId)</code></strong> indique que la clé étrangère de la table/modèle <strong>Role</strong> est la propriété <strong>RoleId</strong>.</p>
<p>La méthode <strong><code>OnDelete(DeleteBehavior.ClientSetNull)</code></strong> permet d&#x27;indiquer que la règle est <strong><code>No Action</code></strong>. Malgré que l&#x27;option <strong><code>DeleteBehavior.NoAction</code></strong> existe, il est recommandé de prendre <strong><code>DeleteBehavior.ClientSetNull</code></strong>.</p>
<p>Pour la classe <strong>Carte</strong> et <strong>UtilisateurCarte</strong>, il y a 2 clés étrangères. Il faut le faire pour les 2 clés.</p>
<p>Pour la table <strong>Carte</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//Table Carte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modelBuilder.Entity&lt;Carte&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** Code précédent retiré pour l&#x27;exemple uniquement **/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entity.HasOne(t =&gt; t.Ensemble).WithMany(p =&gt; p.CarteListe)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .HasForeignKey(t =&gt; t.EnsembleId)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .OnDelete(DeleteBehavior.ClientSetNull);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entity.HasOne(t =&gt; t.Categorie).WithMany(p =&gt; p.CarteListe)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .HasForeignKey(t =&gt; t.CategorieId)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .OnDelete(DeleteBehavior.ClientSetNull);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Pour la table <strong>UtilisateurCarte</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//Table UtilisateurCarte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modelBuilder.Entity&lt;UtilisateurCarte&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** Code précédent retiré pour l&#x27;exemple uniquement **/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entity.HasOne(t =&gt; t.Utilisateur).WithMany(p =&gt; p.UtilisateurCarteListe)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .HasForeignKey(t =&gt; t.UtilisateurId)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .OnDelete(DeleteBehavior.ClientSetNull);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entity.HasOne(t =&gt; t.Carte).WithMany(p =&gt; p.UtilisateurCarteListe)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .HasForeignKey(t =&gt; t.CarteId)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .OnDelete(DeleteBehavior.ClientSetNull);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Voici le code du contexte <strong>SuperCarteContext.cs</strong> au complet.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using Microsoft.EntityFrameworkCore;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Reflection.Emit;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.EF.Data.Context;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Contexte pour la base de de données SuperCarte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SuperCarteContext : DbContext</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private bool _executerSeed = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Constructeur pour la migration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	public SuperCarteContext() : base()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Constructeur pour l&#x27;utilisation en programme</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;options&quot;&gt;Option de la base de données&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public SuperCarteContext(DbContextOptions&lt;SuperCarteContext&gt; options)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        : base(options)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#if DEBUG //Permet d&#x27;inclure cette méthode uniquement si l&#x27;application est en mode DEBUG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Vérifie si la configuration n&#x27;a pas été spécifiée par un fichier de configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (optionsBuilder.IsConfigured == false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Aucune configuration à partir d&#x27;un fichier de configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Option de base pour la migration            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            string? chaineConnexion = Environment.GetEnvironmentVariable(&quot;MIGRATION_CONNECTION_STRING&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Vérifie si la variable n&#x27;est pas vide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (string.IsNullOrEmpty(chaineConnexion) == false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //La variable n&#x27;est pas vide, la chaine de connexion est appliquée</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                optionsBuilder.UseSqlServer(chaineConnexion);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                _executerSeed = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //Il n&#x27;y a aucune chaine de connexion.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                throw new Exception(&quot;La variable MIGRATION_CONNECTION_STRING n&#x27;est pas spécifiée. Effectuez la commande suivante dans la Console du Gestionnaire de package : $env:MIGRATION_CONNECTION_STRING=\&quot;[ma chaine de connexion]\&quot; &quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#endif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Configuration spécifique de la base de données</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;modelBuilder&quot;&gt;&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected override void OnModelCreating(ModelBuilder modelBuilder)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Table Role</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelBuilder.Entity&lt;Role&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.ToTable(&quot;Role&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.Nom)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .IsUnicode(false) //VARCHAR ou CHAR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .HasMaxLength(25); //VARCHAR(25)   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Table Utilisateur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelBuilder.Entity&lt;Utilisateur&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.ToTable(&quot;Utilisateur&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.Prenom)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .HasMaxLength(50);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.Nom)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .HasMaxLength(50);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.NomUtilisateur)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .HasMaxLength(50);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.MotPasseHash)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .IsFixedLength(true) //CHAR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .HasMaxLength(60);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.HasIndex(t =&gt; t.NomUtilisateur).IsUnique(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.HasOne(t =&gt; t.Role).WithMany(p =&gt; p.UtilisateurListe)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .HasForeignKey(t =&gt; t.RoleId)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .OnDelete(DeleteBehavior.ClientSetNull);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Table Categorie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelBuilder.Entity&lt;Categorie&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.ToTable(&quot;Categorie&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.Nom)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .HasMaxLength(35);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.Description)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .HasMaxLength(50);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Table Ensemble</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelBuilder.Entity&lt;Ensemble&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.ToTable(&quot;Ensemble&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.Nom)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .HasMaxLength(50);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.Disponibilite)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .HasColumnType(&quot;DATE&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Table Carte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelBuilder.Entity&lt;Carte&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.ToTable(&quot;Carte&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.Nom)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .HasMaxLength(100);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.PrixRevente)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .HasPrecision(8,2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.HasOne(t =&gt; t.Ensemble).WithMany(p =&gt; p.CarteListe)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .HasForeignKey(t =&gt; t.EnsembleId)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .OnDelete(DeleteBehavior.ClientSetNull);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.HasOne(t =&gt; t.Categorie).WithMany(p =&gt; p.CarteListe)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .HasForeignKey(t =&gt; t.CategorieId)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .OnDelete(DeleteBehavior.ClientSetNull);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Table UtilisateurCarte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelBuilder.Entity&lt;UtilisateurCarte&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.ToTable(&quot;UtilisateurCarte&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie la clé primaire</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.HasKey(t =&gt; new { t.UtilisateurId, t.CarteId });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.HasOne(t =&gt; t.Utilisateur).WithMany(p =&gt; p.UtilisateurCarteListe)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .HasForeignKey(t =&gt; t.UtilisateurId)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .OnDelete(DeleteBehavior.ClientSetNull);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.HasOne(t =&gt; t.Carte).WithMany(p =&gt; p.UtilisateurCarteListe)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .HasForeignKey(t =&gt; t.CarteId)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .OnDelete(DeleteBehavior.ClientSetNull);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;Role&gt; RoleTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;Utilisateur&gt; UtilisateurTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;Categorie&gt; CategorieTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;Ensemble&gt; EnsembleTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;Carte&gt; CarteTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;UtilisateurCarte&gt; UtilisateurCarteTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Créez la migration <strong>FKOnDeleteNoAction</strong>.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Add-Migration FKOnDeleteNoAction -StartupProject SuperCarte.EF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Appliquez les modifications à la base de données. Spécifiez la migration <strong><code>UtilisateurNomUtilisateurUnique</code></strong>.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Update-Database -StartupProject SuperCarte.EF -Migration FKOnDeleteNoAction</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Ouvrez <strong>SSMS</strong> et les clés étrangères auront <strong>No Action</strong>.</p>
<p>Voici le résultat de la 7e section de <strong><code>sp_help Utilisateur </code></strong>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">constraint_type			constraint_name				delete_action	update_action	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FOREIGN KEY				FK_Utilisateur_Role_RoleId	No Action		No Action		</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>Ajouter des données - Seed</h1>
<p>Pour ajouter des données, il faut le faire dans la méthode <strong><code>OnModelCreating()</code></strong>. Cette action s&#x27;appelle <strong>Seed</strong> pour semer des données.</p>
<p>Avant de poursuivre, il faut retirer l&#x27;enregistrement de la table <strong>Role</strong> qui a été fait manuellement.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">DELETE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Role</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="préparation-du-contexte">Préparation du contexte<a href="#préparation-du-contexte" class="hash-link" aria-label="Direct link to Préparation du contexte" title="Direct link to Préparation du contexte">​</a></h2>
<p>Pour éviter que le <strong>Seed</strong> soit toujours exécuté en mémoire, il est préférable de modifier le contexte. Ce sera l&#x27;attribut <strong><code>_activerSeed</code></strong> qui s&#x27;occupera de ceci.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using Microsoft.EntityFrameworkCore;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Reflection.Emit;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.EF.Data.Context;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Contexte pour la base de de données SuperCarte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SuperCarteContext : DbContext</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private bool _executerSeed = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Constructeur pour la migration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	public SuperCarteContext() : base()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Constructeur pour l&#x27;utilisation en programme</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;options&quot;&gt;Option de la base de données&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public SuperCarteContext(DbContextOptions&lt;SuperCarteContext&gt; options)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        : base(options)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#if DEBUG //Permet d&#x27;inclure cette méthode uniquement si l&#x27;application est en mode DEBUG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Vérifie si la configuration n&#x27;a pas été spécifiée par un fichier de configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (optionsBuilder.IsConfigured == false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Aucune configuration à partir d&#x27;un fichier de configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Option de base pour la migration            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            string? chaineConnexion = Environment.GetEnvironmentVariable(&quot;MIGRATION_CONNECTION_STRING&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Vérifie si la variable n&#x27;est pas vide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (string.IsNullOrEmpty(chaineConnexion) == false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //La variable n&#x27;est pas vide, la chaine de connexion est appliquée</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                optionsBuilder.UseSqlServer(chaineConnexion);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                _executerSeed = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //Il n&#x27;y a aucune chaine de connexion.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                throw new Exception(&quot;La variable MIGRATION_CONNECTION_STRING n&#x27;est pas spécifiée. Effectuez la commande suivante dans la Console du Gestionnaire de package : $env:MIGRATION_CONNECTION_STRING=\&quot;[ma chaine de connexion]\&quot; &quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#endif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Configuration spécifique de la base de données</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;modelBuilder&quot;&gt;&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected override void OnModelCreating(ModelBuilder modelBuilder)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Table Role</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelBuilder.Entity&lt;Role&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.ToTable(&quot;Role&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.Nom)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .IsUnicode(false) //VARCHAR ou CHAR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .HasMaxLength(25); //VARCHAR(25)   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Table Utilisateur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelBuilder.Entity&lt;Utilisateur&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.ToTable(&quot;Utilisateur&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.Prenom)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .HasMaxLength(50);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.Nom)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .HasMaxLength(50);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.NomUtilisateur)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .HasMaxLength(50);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.MotPasseHash)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .IsFixedLength(true) //CHAR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .HasMaxLength(60);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.HasIndex(t =&gt; t.NomUtilisateur).IsUnique(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.HasOne(t =&gt; t.Role).WithMany(p =&gt; p.UtilisateurListe)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .HasForeignKey(t =&gt; t.RoleId)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .OnDelete(DeleteBehavior.ClientSetNull);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Table Categorie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelBuilder.Entity&lt;Categorie&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.ToTable(&quot;Categorie&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.Nom)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .HasMaxLength(35);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.Description)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .HasMaxLength(50);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Table Ensemble</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelBuilder.Entity&lt;Ensemble&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.ToTable(&quot;Ensemble&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.Nom)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .HasMaxLength(50);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.Disponibilite)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .HasColumnType(&quot;DATE&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Table Carte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelBuilder.Entity&lt;Carte&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.ToTable(&quot;Carte&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.Nom)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .IsUnicode(false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .HasMaxLength(100);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.Property(t =&gt; t.PrixRevente)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .HasPrecision(8,2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.HasOne(t =&gt; t.Ensemble).WithMany(p =&gt; p.CarteListe)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .HasForeignKey(t =&gt; t.EnsembleId)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .OnDelete(DeleteBehavior.ClientSetNull);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.HasOne(t =&gt; t.Categorie).WithMany(p =&gt; p.CarteListe)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .HasForeignKey(t =&gt; t.CategorieId)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .OnDelete(DeleteBehavior.ClientSetNull);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Table UtilisateurCarte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modelBuilder.Entity&lt;UtilisateurCarte&gt;(entity =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie le nom de la table dans la BD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.ToTable(&quot;UtilisateurCarte&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Spécifie la clé primaire</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.HasKey(t =&gt; new { t.UtilisateurId, t.CarteId });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.HasOne(t =&gt; t.Utilisateur).WithMany(p =&gt; p.UtilisateurCarteListe)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .HasForeignKey(t =&gt; t.UtilisateurId)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .OnDelete(DeleteBehavior.ClientSetNull);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entity.HasOne(t =&gt; t.Carte).WithMany(p =&gt; p.UtilisateurCarteListe)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .HasForeignKey(t =&gt; t.CarteId)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .OnDelete(DeleteBehavior.ClientSetNull);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if(_executerSeed == true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Seed(modelBuilder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Méthode qui s&#x27;occupe de la création des données</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private void Seed(ModelBuilder modelBuilder)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Les données à ajouter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;Role&gt; RoleTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;Utilisateur&gt; UtilisateurTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;Categorie&gt; CategorieTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;Ensemble&gt; EnsembleTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;Carte&gt; CarteTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DbSet&lt;UtilisateurCarte&gt; UtilisateurCarteTb { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>À la ligne 46, l&#x27;activation du <strong>Seed</strong> se fait uniquement si le contexte est initialisé en mode <strong>Migration</strong> dans la méthode <strong><code>OnConfiguring()</code></strong>.</p>
<p>À la ligne 160, il y a une vérification avant d&#x27;exécuter le **Seed **dans la méthode <strong><code>OnModelCreating()</code></strong>.</p>
<p>À la ligne 169, les données seront créées dans cette méthode.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="création-des-données">Création des données<a href="#création-des-données" class="hash-link" aria-label="Direct link to Création des données" title="Direct link to Création des données">​</a></h2>
<p>Pour ajouter des données, il faut envoyer un tableau des données dans la méthode <strong><code>HasData()</code></strong> de l&#x27;entité en question.</p>
<p>Il est obligatoire de spécifier les clés primaires et étrangères lors d&#x27;un <strong>Seed</strong> à partir de la migration avec <strong>Entity Framework</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Méthode qui s&#x27;occupe de la création des données</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private void Seed(ModelBuilder modelBuilder)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //Les données à ajouter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Role[] roles = </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        new Role() </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RoleId = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Nom = &quot;Administrateur&quot;                </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        new Role()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RoleId = 2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Nom = &quot;Utilisateur&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Utilisateur[] utilisateurs =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        new Utilisateur()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            UtilisateurId = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Prenom = &quot;François&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Nom = &quot;St-Hilaire&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            NomUtilisateur = &quot;fsthilaire&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MotPasseHash = &quot;$2y$11$IY6NG9FkTSI1dnjLfSbuOuNkuyI7IZHxHSOD5Td6AlwvroUz/vzLK&quot;, //Native3! avec Bcrypt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RoleId = 1 //Admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        new Utilisateur()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            UtilisateurId = 2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Prenom = &quot;Benoit&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Nom = &quot;Tremblay&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            NomUtilisateur = &quot;btremblay&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MotPasseHash = &quot;$2y$11$ewK3YsMGQ1IMKEzJUAjyVe0P19I0gEbTO998mwfVbSSA8nZ6MG/ha&quot;, //Web4MVC! avec Bcrypt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RoleId = 2 //Utilisateur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        new Utilisateur() </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            UtilisateurId = 3,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Prenom = &quot;Tony&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Nom = &quot;Stark&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            NomUtilisateur = &quot;tstark&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MotPasseHash = &quot;$2y$11$VfcNowkWResPQKl0AA3MJ.w1LXBqmMM77YKlyf32Glr9TWG4xxyD2&quot;, //#NotAdmin! avec Bcrypt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RoleId = 2 //Utilisateur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //Ajout dans les tables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    modelBuilder.Entity&lt;Role&gt;().HasData(roles);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    modelBuilder.Entity&lt;Utilisateur&gt;().HasData(utilisateurs);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Les utilisateurs ont un mot de passe en <strong>Hash</strong> avec l&#x27;algorithme <strong>Bcrypt</strong>. Le site web <strong><a href="https://bcrypt.online/" target="_blank" rel="noopener noreferrer">https://bcrypt.online/</a></strong> a permis de les générer manuellement pour les insérer directement. La librairie <strong>Bcrypt.Net</strong> sera utilisée dans l&#x27;application.</p>
<p>Créez la migration <strong>Seed_RoleEtUtilisateur</strong>.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Add-Migration Seed_RoleEtUtilisateur -StartupProject SuperCarte.EF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Appliquez les modifications à la base de données. Spécifiez la migration <strong><code>Seed_RoleEtUtilisateur</code></strong>.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Update-Database -StartupProject SuperCarte.EF -Migration Seed_RoleEtUtilisateur</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Pour votre <strong>TP 3</strong>, vous devez créer un jeu de données initial pour chacune des tables. Il devra être créé par un <strong>Seed</strong>.</p>
<p>Ouvrez <strong>SSMS</strong> et la base de données aura des données dans les tables <strong>Utilisateur</strong> et <strong>Role</strong>.</p>
<h1>Création du projet - SuperCarte.Core</h1>
<p>Il faut ajouter le projet <strong>Core</strong> dans la solution.</p>
<p>Ce projet aura les classes de type <strong>Service</strong>, de type <strong>Repository</strong>, de type <strong>Validateur</strong> et les modèles du domaine.</p>
<p>Créez un projet de type <strong>Bibliothèque de classe</strong>. Il est important <strong>de ne pas choisir</strong> la version <strong>.NET Framework</strong>.</p>
<ul>
<li><strong>Nom du projet</strong> : SuperCarte.Core</li>
<li><strong>Infrastructure</strong> : .NET 7</li>
</ul>
<p>Supprimez le fichier <strong>Class1.cs</strong>.</p>
<p>Créez un dossier <strong>Models</strong> à la racine du projet. Ce dossier contient les classes du modèle du domaine.</p>
<p>Il faut différencier les classes du modèle de données et du modèle du domaine.</p>
<ul>
<li><strong>Modèle de données</strong>
<ul>
<li>Il s&#x27;agit d&#x27;une classe qui représente une entité de la base de données. (Table ou Vue).</li>
<li>L&#x27;application ne doit pas travailler directement avec cette classe.</li>
</ul>
</li>
<li><strong>Modèle du domaine</strong>
<ul>
<li>Il s&#x27;agit d&#x27;une classe qui représente un élément du domaine de l&#x27;application. Elle peut être très similaire à une classe du modèle de données, mais peut également contenir des champs de plusieurs tables et de la logique propre.</li>
<li>La logique applicative travaille avec la classe du modèle de domaine.</li>
<li>Le <strong>Service</strong> s&#x27;occupe de faire la transition (<strong>mapping</strong>) entre la classe du modèle de données et la classe du domaine du domaine.</li>
<li>Le <strong>Repository</strong> peut également utiliser les classes du domaine pour insérer les données de plusieurs tables dans un seul objet.</li>
</ul>
</li>
</ul>
<p>Avec <strong>Entity Framework</strong>, il n&#x27;est pas recommandé que la classe du modèle de données soit également la classe du modèle du domaine. <strong>Dapper</strong> offre un plus grand contrôle sur la création de l&#x27;objet, il serait possible de donner les 2 rôles à la même classe.</p>
<p>Créez un dossier <strong>Repositories</strong> à la racine du projet. Ce dossier contiendra les classes de type <strong>Repository</strong>. Ce sont les classes qui contiennent les requêtes pour communiquer avec la base de données.</p>
<p>Créez un dossier <strong>Services</strong> à la racine du projet. Ce dossier contiendra les services de l&#x27;application. Les classes de type <strong>Service</strong> contiennent la logique de l&#x27;application. Elles s&#x27;occuperont de convertir les objets de données en objet du domaine et vice-versa dans un certain cas également.</p>
<p>Créez le dossier <strong>Validateurs</strong>. Les classes de type <strong>Validateur</strong> s&#x27;occupent de valider les données. Ce sont des outils que le service utilisera pour s&#x27;assurer que l&#x27;objet du domaine est conforme aux exigences du logiciel. Avant d&#x27;envoyer un objet à la base de données, il doit respecter les contraintes.</p>
<p>Créez le dossier <strong>Extensions</strong>. Il y aura des extensions pour faire la conversion entre les objets du modèle de données et du modèle du domaine.</p>
<p>Voici la structure complète des dossiers du projet <strong>SuperCarte.Core</strong>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SuperCarte.Core</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	- Extensions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	- Models</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	- Repositories</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	- Services</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	- Validateurs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ajout-des-dépendances-de-projet">Ajout des dépendances de projet<a href="#ajout-des-dépendances-de-projet" class="hash-link" aria-label="Direct link to Ajout des dépendances de projet" title="Direct link to Ajout des dépendances de projet">​</a></h2>
<p>Le projet <strong>SuperCarte.Core</strong> aura besoin du projet <strong>SuperCarte.EF</strong> pour utiliser le contexte.</p>
<p>Il faut l&#x27;ajouter dans les dépendances du projet.</p>
<p>Sélectionnez le dossier <strong>Dépendances</strong> du projet <strong>SuperCarte.Core</strong> et choisissez <strong>Ajouter une référence de projet</strong> dans le menu contextuel.</p>
<p>Dans la fenêtre, il faut cocher <strong>SuperCarte.EF</strong>. Vous venez d&#x27;intégrer une librairie interne au projet.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="classe-et-méthode-générique---théorie">Classe et méthode générique - Théorie<a href="#classe-et-méthode-générique---théorie" class="hash-link" aria-label="Direct link to Classe et méthode générique - Théorie" title="Direct link to Classe et méthode générique - Théorie">​</a></h2>
<p>Pour plus d&#x27;information : <a href="https://learn.microsoft.com/fr-fr/dotnet/csharp/fundamentals/types/generics" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/fr-fr/dotnet/csharp/fundamentals/types/generics</a></p>
<p>L&#x27;utilisation de classe générique permet de généraliser les classes afin d&#x27;éviter de créer plusieurs classes spécifiques et de méthodes spécifiques.</p>
<p>Les classes et les méthodes génériques ont à la fin de leur nom le <strong><code>&lt;&gt;</code></strong>. Le <strong><code>&lt;&gt;</code></strong> permet d&#x27;indiquer le type réel qui doit être utilisé pour l&#x27;instance de la classe ou pour l&#x27;utilisation de la méthode.</p>
<p>La classe générique la plus populaire en <strong>C#</strong> est <strong><code>List&lt;T&gt;</code></strong>. La lettre <strong><code>T</code></strong> est la norme pour indiquer que le type est générique.</p>
<p>Prenez par exemple qu&#x27;il faut avoir une collection de la classe <strong>Personne</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class Personne</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string Prenom { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public string Nom { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int Age { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Avant d&#x27;avoir une collection de type <strong><code>List&lt;T&gt;</code></strong>, il avait 2 options.</p>
<ul>
<li>
<p><strong>Créer une collection d&#x27;objets</strong></p>
<p>Par exemple, en <strong>C#</strong>, il y a la collection <strong>ArrayList</strong>. Voici la signature de la méthode <strong><code>Add(objet? value)</code></strong>. Cette collection permet d&#x27;ajouter des classes du type <strong>objet</strong>, donc tous les types de classes.</p>
<p>Il est possible d&#x27;ajouter plusieurs types de données dans la même collection. C&#x27;est rarement un comportement désiré dans une liste.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ArrayList listePersonne = new ArrayList();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">liste.Add(1); //Un entier</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">liste.Add(&quot;une string&quot;); //Une string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">liste.Add(3.04m); //Un decimal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">liste.Add(new DateTime(2011,11,11)); //Un objet DateTime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">liste.Add(new Personne() {Prenom = &quot;Francois&quot;, Nom = &quot;St-Hilaire&quot;, Age = 21}); //Un objet de type personne</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Créer une classe Collection spécifique à un type.</strong></p>
<p>Cette approche permet de créer une classe qui s&#x27;occupera d&#x27;ajouter des objets d&#x27;un seul type. Cette classe permet d&#x27;encapsuler la mécanique interne pour ajouter, pour enlever et pour obtenir uniquement pour le type <strong>Personne</strong>. Le gros désavantage est qu&#x27;il faut créer une classe <strong>Collection</strong> spécifique pour toutes les classes de l&#x27;application qui nécessite une collection.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class CollectionPersonne</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private ArrayList _arrPersonne = new ArrayList();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void Ajouter(Personne personne)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _arrPersonne.Add(personne);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Personne Obtenir(int index)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (index &lt; _arrPersonne.Count)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return (Personne)_arrPersonne[index];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new Exception($&quot;La liste a {_arrPersonne.Count} élément(s)&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Voici comment l&#x27;utiliser.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CollectionPersonne liste = new CollectionPersonne();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">liste.Ajouter(new Personne() { Prenom = &quot;Francois&quot;, Nom = &quot;St-Hilaire&quot;, Age = 21 });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">liste.Ajouter(new Personne() { Prenom = &quot;Stéphane&quot;, Nom = &quot;Janvier&quot;, Age = 61 });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Personne p2 = liste.Obtenir(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Console.WriteLine($&quot;La personne est {p2.Prenom} { p2.Nom }.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">liste.Ajouter(4); //Erreur du compilateur. Seulement le type **Personne** qui est accepté.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Classe générique</strong></p>
<p>Les classes génériques permettent de généraliser un comportement et de spécifier un type à une instance précise.</p>
<p>Voici une simplification de la classe <strong><code>List&lt;T&gt;</code></strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class ListeGenerique&lt;T&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private ArrayList _arr = new ArrayList();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void Ajouter(T valeur)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _arr.Add(valeur);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public T Obtenir(int index)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (index &lt; _arr.Count)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return (T)_arr[index];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new Exception($&quot;La liste a {_arr.Count} élément(s)&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Dans la déclaration de la classe, il y a le <strong><code>&lt;T&gt;</code></strong> qui indique qu&#x27;il faut obligatoirement spécifier un type lors de la création d&#x27;un objet.</p>
<p>Le type générique <strong><code>T</code></strong> est utilisé comme type pour le paramètre de la méthode <strong><code>void Ajouter(T valeur)</code></strong>.</p>
<p>Le type générique <strong><code>T</code></strong> est utilisé comme type de retour de la méthode <strong><code>T Obtenir(int index)</code></strong>.</p>
<p>Donc, si un objet est créé avec le type <strong>Personne</strong> <strong><code>new ListeGenerique&lt;Personne&gt;()</code></strong> , le compilateur va voir <strong><code>void Ajouter(Personne valeur)</code></strong> et  <strong><code>Personne Obtenir(int index)</code></strong>.</p>
<p>Voici comment l&#x27;utiliser.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ListeGenerique&lt;Personne&gt; liste = new ListeGenerique&lt;Personne&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">liste.Ajouter(new Personne() { Prenom = &quot;Francois&quot;, Nom = &quot;St-Hilaire&quot;, Age = 21 });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">liste.Ajouter(new Personne() { Prenom = &quot;Stéphane&quot;, Nom = &quot;Janvier&quot;, Age = 61 });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Personne p2 = liste.Obtenir(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Console.WriteLine($&quot;La personne est {p2.Prenom} { p2.Nom }.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">liste.Ajouter(4); //Erreur du compilateur</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Avec la même liste, il est possible de faire des ajouts de <strong>DateTime</strong> par exemple.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ListeGenerique&lt;DateTime&gt; listeDate = new ListeGenerique&lt;DateTime&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">listeDate.Ajouter(new DateTime(1967, 2, 1));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">listeDate.Ajouter(new DateTime(1957, 6, 29));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DateTime d2 = listeDate.Obtenir(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Console.WriteLine($&quot;La date est {d2}.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">listeDate.Ajouter(4); //Erreur du compilateur</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="généralisation-du-contexte">Généralisation du contexte<a href="#généralisation-du-contexte" class="hash-link" aria-label="Direct link to Généralisation du contexte" title="Direct link to Généralisation du contexte">​</a></h2>
<p>Les méthodes de base de la classe <strong>DBContext</strong> utilisent les types génériques. Il est donc possible de généraliser les requêtes de base et répétitives dans le <strong>Repository</strong>.</p>
<p>Voici une liste de requêtes <strong>classiques</strong> qui sont généralement identiques.</p>
<ul>
<li>Obtenir tous les éléments de la table</li>
<li>Ajouter un ou des éléments</li>
<li>Supprimer un ou des éléments</li>
<li>Enregistrer les modifications</li>
</ul>
<p>Créez le dossier <strong>Bases</strong> dans le dossier <strong>Repositories</strong>. Ce dossier contiendra les classes génériques de base.</p>
<p>L&#x27;injection de dépendances du <strong>Repository</strong> se fait par les interfaces. Il faut donc que les classes de base possèdent une interface.</p>
<p>Créez l&#x27;interface <strong>IBaseRepo</strong> dans le dossier <strong>Repositories\Bases</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.Core.Repositories.Bases;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Interface générique qui contient les opérations de base des tables de la base de données</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;typeparam name=&quot;TData&quot;&gt;Type du modèle de données / table&lt;/typeparam&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface IBaseRepo&lt;TData&gt; where TData : class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Obtenir la liste de tous les items en asynchrone.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;returns&gt;Liste des items&lt;/returns&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Task&lt;List&lt;TData&gt;&gt; ObtenirListeAsync();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Obtenir la liste de tous les items.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;returns&gt;Liste des items&lt;/returns&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    List&lt;TData&gt; ObtenirListe();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Ajouter une liste d&#x27;items dans la base de données en asynchrone.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;lstItem&quot;&gt;Liste des items à ajouter&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;enregistrer&quot;&gt;Enregistrer immédiatement ou non dans la base de données&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Task AjouterAsync(List&lt;TData&gt; lstItem, bool enregistrer);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Ajouter une liste d&#x27;items dans la base de données.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;lstItem&quot;&gt;Liste des items à ajouter&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;enregistrer&quot;&gt;Enregistrer immédiatement ou non dans la base de données&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void Ajouter(List&lt;TData&gt; lstItem, bool enregistrer);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Ajouter un item dans la base de données en asynchrone.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;item&quot;&gt;L&#x27;item à ajouter&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;enregistrer&quot;&gt;Enregistrer immédiatement ou non dans la base de données&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Task AjouterAsync(TData item, bool enregistrer);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Ajouter un item dans la base de données.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;item&quot;&gt;L&#x27;item à ajouter&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;enregistrer&quot;&gt;Enregistrer immédiatement ou non dans la base de données&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void Ajouter(TData item, bool enregistrer);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Supprimer une liste d&#x27;items dans la base de données en asynchrone.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;lstItem&quot;&gt;Liste des items à supprimer&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;enregistrer&quot;&gt;Enregistrer immédiatement ou non dans la base de données&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Task SupprimerAsync(List&lt;TData&gt; lstItem, bool enregistrer);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Supprimer une liste d&#x27;items dans la base de données.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;lstItem&quot;&gt;Liste des items à supprimer&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;enregistrer&quot;&gt;Enregistrer immédiatement ou non dans la base de données&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void Supprimer(List&lt;TData&gt; lstItem, bool enregistrer);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Supprimer un item dans la base de données en asynchrone.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;item&quot;&gt;L&#x27;item à supprimer&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;enregistrer&quot;&gt;Enregistrer immédiatement ou non dans la base de données&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Task SupprimerAsync(TData item, bool enregistrer);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Supprimer un item dans la base de données.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;item&quot;&gt;L&#x27;item à supprimer&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;enregistrer&quot;&gt;Enregistrer immédiatement ou non dans la base de données&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void Supprimer(TData item, bool enregistrer);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Enregistrer l&#x27;état actuel du contexte dans la base de données en asynchrone.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Task EnregistrerAsync();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Enregistrer l&#x27;état actuel du contexte dans la base de données.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void Enregistrer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>À la ligne 7, il y a la déclaration de l&#x27;interface avec un type générique.  Il est possible de renommer le <strong><code>T</code></strong> pour un nom plus spécifique <strong><code>TData</code></strong>. Par convention, le type générique débute toujours avec le préfixe <strong><code>T</code></strong>.</p>
<p>Il est possible de mettre des contraintes au type générique. Le mot-clé <strong><code>where</code></strong> permet de spécifier les contraintes. Dans ce cas-ci, il est seulement possible de spécifier un type qui est une classe. Donc, il n&#x27;est pas possible de spécifier <strong><code>IBaseRepo&lt;int&gt;</code></strong>, car le type <strong><code>int</code></strong> n&#x27;est pas une classe, mais un type primitif.</p>
<p>Pour plus d&#x27;information pour le <strong><code>where</code></strong> <a href="https://learn.microsoft.com/fr-ca/dotnet/csharp/language-reference/keywords/where-generic-type-constraint" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/fr-ca/dotnet/csharp/language-reference/keywords/where-generic-type-constraint</a></p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public interface IBaseRepo&lt;TData&gt; where TData : class</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Pour chacune des méthodes, il y a le <strong><code>TData</code></strong> pour le type d&#x27;un paramètre ou pour le retour.</p>
<p>Également, l&#x27;application doit pouvoir fonctionner en <strong>asynchrone</strong>. Par convention en <strong>C#</strong>, une méthode <strong>asynchrone</strong> doit avoir le suffixe <strong>Async</strong>, mais ce n&#x27;est pas obligatoire. De plus, les méthodes doivent retourner un type <strong><code>Task</code></strong> ou <strong><code>Task&lt;T&gt;</code></strong>. L&#x27;explication du fonctionnement de l&#x27;asynchrone sera expliquée dans la partie 2. Il faut également le méthode <strong>synchrone</strong>, car selon le cas d&#x27;utilisation, l&#x27;appel peut être obligatoirement synchrone.</p>
<p>Créez la classe <strong>BaseRepo</strong> dans le dossier <strong>Repositories\Bases</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using Microsoft.EntityFrameworkCore;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.EF.Data.Context;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.Core.Repositories.Bases;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Classe abstraite générique qui contient les opérations de base des tables de la base de données</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;typeparam name=&quot;TData&quot;&gt;Type du modèle de données / table&lt;/typeparam&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class BaseRepo&lt;TData&gt; : IBaseRepo&lt;TData&gt; where TData : class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected readonly SuperCarteContext _bd;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Constructeur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;bd&quot;&gt;Contexte de la base de données&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public BaseRepo(SuperCarteContext bd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _bd = bd;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public async Task&lt;List&lt;TData&gt;&gt; ObtenirListeAsync()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Équivalent à _db.TData.ToListAsync();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return await _bd.Set&lt;TData&gt;().ToListAsync();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public List&lt;TData&gt; ObtenirListe()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Équivalent à _db.TData.ToList();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return _bd.Set&lt;TData&gt;().ToList();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public async Task AjouterAsync(TData item, bool enregistrer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Add est déjà générique.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Sa définition réelle est _bd.Add&lt;TData&gt;().</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _bd.Add(item);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Vérifie si l&#x27;ajout doit être appliqué dans la base de données immédiatement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (enregistrer == true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //L&#x27;ajout doit être appliqué dans la base de données immédiatement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            await _bd.SaveChangesAsync();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //L&#x27;ajout est seulement en mémoire</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            await Task.CompletedTask;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void Ajouter(TData item, bool enregistrer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Add est déjà générique.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Sa définition réelle est _bd.Add&lt;TData&gt;().</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _bd.Add(item);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Vérifie si l&#x27;ajout doit être appliqué dans la base de données immédiatement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (enregistrer == true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //L&#x27;ajout doit être appliqué dans la base de données immédiatement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _bd.SaveChanges();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public async Task AjouterAsync(List&lt;TData&gt; lstItem, bool enregistrer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //AddRange est déjà générique.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Sa définition réelle est _bd.AddRange&lt;TData&gt;().</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _bd.AddRange(lstItem);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Vérifie si l&#x27;ajout doit être appliqué dans la base de données immédiatement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (enregistrer == true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //L&#x27;ajout doit être appliqué dans la base de données immédiatement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            await _bd.SaveChangesAsync();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //L&#x27;ajout est seulement en mémoire</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            await Task.CompletedTask;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void Ajouter(List&lt;TData&gt; lstItem, bool enregistrer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //AddRange est déjà générique.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Sa définition réelle est _bd.AddRange&lt;TData&gt;().</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _bd.AddRange(lstItem);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Vérifie si l&#x27;ajout doit être appliqué dans la base de données immédiatement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (enregistrer == true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //L&#x27;ajout doit être appliqué dans la base de données immédiatement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _bd.SaveChanges();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public async Task SupprimerAsync(TData item, bool enregistrer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Remove est déjà générique.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Sa définition réelle est _bd.Remove&lt;TData&gt;().</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _bd.Remove(item);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Vérifie si la suppression doit être appliquée dans la base de données immédiatement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (enregistrer == true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //La suppression doit être appliquée dans la base de données immédiatement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            await _bd.SaveChangesAsync();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //La suppression est seulement en mémoire</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            await Task.CompletedTask;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void Supprimer(TData item, bool enregistrer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Remove est déjà générique.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Sa définition réelle est _bd.Remove&lt;TData&gt;().</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _bd.Remove(item);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Vérifie si la suppression doit être appliquée dans la base de données immédiatement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (enregistrer == true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //La suppression doit être appliquée dans la base de données immédiatement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _bd.SaveChanges();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public async Task SupprimerAsync(List&lt;TData&gt; lstItem, bool enregistrer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //RemoveRange est déjà générique.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Sa définition réelle est _bd.RemoveRange&lt;TData&gt;().        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _bd.RemoveRange(lstItem);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Vérifie si la suppression doit être appliquée dans la base de données immédiatement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (enregistrer == true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //La suppression doit être appliquée dans la base de données immédiatement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            await _bd.SaveChangesAsync();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //La suppression est seulement en mémoire</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            await Task.CompletedTask;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void Supprimer(List&lt;TData&gt; lstItem, bool enregistrer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //RemoveRange est déjà générique.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Sa définition réelle est _bd.RemoveRange&lt;TData&gt;().        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _bd.RemoveRange(lstItem);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Vérifie si la suppression doit être appliquée dans la base de données immédiatement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (enregistrer == true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //La suppression doit être appliquée dans la base de données immédiatement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _bd.SaveChanges();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public async Task EnregistrerAsync()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Enregistre les ajouts, modifications et suppression en attente dans la mémoire du contexte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        await _bd.SaveChangesAsync();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void Enregistrer()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Enregistre les ajouts, modifications et suppressions en attente dans la mémoire du contexte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _bd.SaveChanges();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Les méthodes ressemblent à ce que vous avez déjà fait, mais elles sont génériques.</p>
<p>Également, le contexte utilise des méthodes <strong>asynchrones</strong>. Pour y avoir accès, il faut inclure <strong><code>using Microsoft.EntityFrameworkCore;</code></strong>.</p>
<ul>
<li><strong><code>ToListAsync()</code></strong></li>
<li><strong><code>SaveChangesAsync()</code></strong></li>
</ul>
<p>La déclaration de la classe <strong><code>public class BaseRepo&lt;TData&gt; : IBaseRepo&lt;TData&gt; where TData : class</code></strong> doit également inclure le <strong><code>&lt;TData&gt;</code></strong>. Elle doit la répliquer dans l&#x27;implémentation de l&#x27;interface avec la même contrainte <strong><code>where</code></strong>. Retirez le <strong><code>where</code></strong> et le compilateur indiquera que la classe est en erreur.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="obtenir-un-enregistrement-spécifique-par-sa-clé">Obtenir un enregistrement spécifique par sa clé<a href="#obtenir-un-enregistrement-spécifique-par-sa-clé" class="hash-link" aria-label="Direct link to Obtenir un enregistrement spécifique par sa clé" title="Direct link to Obtenir un enregistrement spécifique par sa clé">​</a></h3>
<p>Une opération de base dans les opérations de la base de données est d&#x27;obtenir un enregistrement spécifique en fonction de sa clé primaire.</p>
<p>Le nom du champ de la clé primaire change pour chacune des tables. Généralement, le type de la clé primaire un entier, mais ce n&#x27;est pas une garantie.</p>
<p>Il y a aussi le cas d&#x27;une clé primaire composée.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//Clé avec nom différent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Carte carte = _bd.CarteTb.Where(c =&gt; c.CarteId == carteId).FirtOrDefault();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Utilisateur utilisateur = _bd.UtilisateurTb.Where(c =&gt; c.UtilisateurId == utilisateurId).FirtOrDefault();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//Clé pas un entier. DA est une string, car les DA peuvent débuter par 0, pour ceux qui ont été inscrits entre 2000 et 2009</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Etudiant etudiant = _bd.EtudiantTb.Where(e =&gt; e.DA == da).FirstOrDefault();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//Clé composée</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UtilisateurCarte utilisateurCarte = _bd.UtilisateurCarteTb.Where(uc =&gt; uc.CarteId == carteId &amp;&amp; uc.utilisateurId == UtilisateurId).FirtOrDefault();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Est-ce possible de généraliser ceci ? Oui et non.</p>
<p>Le <strong>contexte</strong> possède une méthode <strong><code>Find()</code></strong> ou <strong><code>FindAsync()</code></strong>. Cette méthode permet de recevoir un enregistrement en fonction de sa clé primaire.</p>
<p>Cette méthode peut recevoir un <strong><code>params object?[]? keyValues </code></strong>. Le type est <strong><code>object</code></strong>, donc il peut recevoir une clé en <strong><code>int</code></strong>, en <strong><code>string</code></strong>, etc. selon le cas.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//Clé avec nom différent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Carte carte = _bd.CarteTb.Find(carteId).FirtOrDefault();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Utilisateur utilisateur = _bd.UtilisateurTb.Find(utilisateurId).FirtOrDefault();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//Clé pas un entier. DA est une string, car les DA peuvent débuter par 0, pour ceux qui ont été inscrits entre 2000 et 2009</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Etudiant etudiant = _bd.EtudiantTb.Find(da).FirstOrDefault();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Le mot-clé <strong><code>params</code></strong> d&#x27;ajouter des paramètres illimités (max réel de 65 535) à la méthode. Donc il est possible de faire <strong><code>Find(1, &quot;2&quot;, new DateTime(2022, 1, 3), 10.3m, true)</code></strong> ou <strong><code>Find(1, 2, 3)</code></strong>.  En réalité, il faudrait envoyer un tableau <strong>object[]</strong> en paramètre, mais le mot-clé <strong><code>params</code></strong> permet de le créer lors de l&#x27;appel de la méthode en fusionnant les paramètres. Donc **<code>Find(1, 2, 3)</code> ** est en réalité <strong><code>Find(new object{1, 2, 3})</code></strong>. Pour plus d&#x27;information pour le <strong><code>params</code></strong> <a href="https://learn.microsoft.com/fr-ca/dotnet/csharp/language-reference/keywords/params" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/fr-ca/dotnet/csharp/language-reference/keywords/params</a></p>
<p>Il est donc possible de récupérer un enregistrement qui a une clé primaire composée.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">UtilisateurCarte utilisateurCarte1 = _bd.UtilisateurCarteTb.Find(carteId, utilisateurId).FirtOrDefault();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UtilisateurCarte utilisateurCarte2 = _bd.UtilisateurCarteTb.Find(utilisateurId, carte).FirtOrDefault();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>L&#x27;ordre des clés a-t-il son importance ? La réponse est <strong>oui</strong>. Lequel des 2 appels est la bonne ? Il faut retourner dans la méthode <strong><code>OnModelCreating</code></strong> du <strong>contexte</strong> pour voir dans quel ordre les clés ont été spécifi ées.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">entity.HasKey(t =&gt; new { t.UtilisateurId, t.CarteId });</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>C&#x27;est donc <strong><code>UtilisateurCarte utilisateurCarte2 = _bd.UtilisateurCarteTb.Find(utilisateurId, carte).FirtOrDefault();</code></strong> qui serait la bonne. Il est possible de généraliser la méthode <strong>Find</strong> dans le <strong>Repo</strong>, mais il faut l&#x27;encadrer.</p>
<p>Le <strong>Repo</strong> générique ne permettra pas la gestion des clés multiples, car il y a trop de risque d&#x27;erreur que le programmeur doive toujours valider l&#x27;ordre des clés primaires. Ce sera une méthode spécifique pour les tables qui ont une clé primaire composée.</p>
<p>La méthode générique ressemblerait à celle-ci.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public Task&lt;TData?&gt; ObtenirParCleAsync(int id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return await _bd.FindAsync&lt;TData&gt;(id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Il y a 1 problème dans cette méthode. Elle fonctionne uniquement pour une clé primaire qui est un <strong>entier</strong>.</p>
<p>Il est possible de mettre plusieurs types génériques dans une classe.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class BaseRepo&lt;TData, TClePrimaire&gt; : IBaseRepo&lt;TData, TClePrimaire&gt; where TData : class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Code retiré pour simplifier</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Task&lt;TData?&gt; ObtenirParCleAsync(TClePrimaire clePrimaire)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return await _bd.FindAsync&lt;TData&gt;(clePrimaire);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Le nombre de types génériques d&#x27;une classe n&#x27;est pas limité à 1 uniquement. Il suffit de mettre une virgule dans le **<code>&lt;&gt;</code> ** pour ajouter des types génériques, par exemple  <strong><code>&lt;T1, T2, T3, T4&gt;</code></strong> . Lorsqu&#x27;il y a plusieurs types génériques, il est important de les nommer avec un nom significatif.</p>
<p><strong><code>TClePrimaire</code></strong> sert uniquement pour le paramètre de la méthode <strong><code>ObtenirParCleAsync()</code></strong>.</p>
<p>Mais est-ce le bon endroit pour mettre cette méthode ? Que devra-t-il être spécifié pour la table <strong>UtilisateurCarte</strong> ? Dans le cas ci-dessous, ce sera <strong><code>int</code></strong>, mais si le programmeur utilise quand même la méthode <strong><code>ObtenirParCleAsync()</code></strong>, il y aura une exception.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">var utilisateurCarteRepo BaseRepo&lt;UtilisateurCarte, int&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//La valeur 1 est-ce carteId ou utilisateurId ???</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utilisateurCarteRepo.ObtenirParCleAsync(1); //Il y aura une exception &quot;System.ArgumentException : &#x27;Entity type &#x27;UtilisateurCarte&#x27; is defined with a 2-part composite key, but 1 values were passed to the &#x27;Find&#x27; method.&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Cette approche va contre les principes <strong>SOLID</strong>. Il s&#x27;agit du <strong>L (Liskov substitution)</strong>. Ça ne s&#x27;applique pas nécessairement au type générique dans sa définition pure, mais l&#x27;idée est tout de même respectée. Ce principe consiste qu&#x27;une classe de **Base ** doit fonctionner pour tous les types de données. Il ne doit pas avoir de méthode disponible dans une classe dont le programmeur sait qu&#x27;un cas particulier va générer une exception si elle est utilisée. Donc par conception, le programmeur concepteur sait que la méthode <strong><code>ObtenirParCleAsync()</code></strong> va générer une exception pour le modèle de données <strong>UtilisateurCarte</strong>. Le programmeur qui n&#x27;est pas concepteur et qui voit cette méthode disponible, ne saura pas nécessairement qu&#x27;il ne peut pas l&#x27;utiliser, d&#x27;où l&#x27;importance de respecter le <strong>L</strong> de <strong>SOLID</strong>.</p>
<p>La solution a ce problème est de créer une classe de base intermédiaire.</p>
<p>Créez l&#x27;interface <strong>IBasePKUniqueRepo</strong> dans le dossier <strong>Repositories\Bases</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.Core.Repositories.Bases;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Interface générique qui contient les opérations de base des tables de la base de données pour une table à clé primaire unique</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;typeparam name=&quot;TData&quot;&gt;Type du modèle de données / table&lt;/typeparam&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;typeparam name=&quot;TClePrimaire&quot;&gt;Type de la clé primaire&lt;/typeparam&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface IBasePKUniqueRepo&lt;TData, TClePrimaire&gt; : IBaseRepo&lt;TData&gt; where TData : class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Obtenir un item spécifique en fonction de sa clé primaire en asynchrone.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;clePrimaire&quot;&gt;Valeur de la clé primaire&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;returns&gt;L&#x27;item ou null si non trouvé&lt;/returns&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Task&lt;TData?&gt; ObtenirParCleAsync(TClePrimaire clePrimaire);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Obtenir un item spécifique en fonction de sa clé primaire.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;clePrimaire&quot;&gt;Valeur de la clé primaire&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;returns&gt;L&#x27;item ou null si non trouvé&lt;/returns&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TData? ObtenirParCle(TClePrimaire clePrimaire);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Suprimer un item spécifique en fonction de sa clé primaire en asynchrone.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;clePrimaire&quot;&gt;Valeur de la clé primaire&lt;/param&gt;    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;enregistrer&quot;&gt;Enregistrer immédiatement ou non dans la base de données&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Task SupprimerParCleAsync(TClePrimaire clePrimaire, bool enregistrer);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Suprimer un item spécifique en fonction de sa clé primaire.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;clePrimaire&quot;&gt;Valeur de la clé primaire&lt;/param&gt;    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;enregistrer&quot;&gt;Enregistrer immédiatement ou non dans la base de données&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void SupprimerParCle(TClePrimaire clePrimaire, bool enregistrer);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Créez la classe <strong>BasePKUniqueRepo</strong> dans le dossier <strong>Repositories\Bases</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.EF.Data.Context;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.Core.Repositories.Bases;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Classe abstraite générique qui contient les opérations de base des tables de la base de données pour une table à clé primaire unique</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;typeparam name=&quot;TData&quot;&gt;Type du modèle de données / table&lt;/typeparam&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;typeparam name=&quot;TClePrimaire&quot;&gt;Type de la clé primaire&lt;/typeparam&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public abstract class BasePKUniqueRepo&lt;TData, TClePrimaire&gt; : BaseRepo&lt;TData&gt;, IBasePKUniqueRepo&lt;TData, TClePrimaire&gt; where TData : class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Constructeur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;bd&quot;&gt;Contexte de la base de données&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public BasePKUniqueRepo(SuperCarteContext bd) : base(bd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Vide, il sert uniquement a recevoir le contexte et à l&#x27;envoyer à la classe parent.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public async Task&lt;TData?&gt; ObtenirParCleAsync(TClePrimaire clePrimaire)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return await _bd.FindAsync&lt;TData&gt;(clePrimaire);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public TData? ObtenirParCle(TClePrimaire clePrimaire)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return _bd.Find&lt;TData&gt;(clePrimaire);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public async Task SupprimerParCleAsync(TClePrimaire clePrimaire, bool enregistrer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TData? item = await ObtenirParCleAsync(clePrimaire);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Vérifie si un item a été trouvé avec la clé spécifiée</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (item != null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Il y a un item avec la clé spécifiée</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            await SupprimerAsync(item, enregistrer);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Il n&#x27;y a pas d&#x27;item avec la clé spécifiée</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new Exception(&quot;Impossible de trouver l&#x27;item à supprimer avec la clé spécifiée.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void SupprimerParCle(TClePrimaire clePrimaire, bool enregistrer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TData? item = ObtenirParCle(clePrimaire);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Vérifie si un item a été trouvé avec la clé spécifiée</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (item != null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Il y a un item avec la clé spécifiée</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Supprimer(item, enregistrer);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Il n&#x27;y a pas d&#x27;item avec la clé spécifiée</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new Exception(&quot;Impossible de trouver l&#x27;item à supprimer avec la clé spécifiée.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>La classe a 2 méthodes spécifiques aux tables avec une clé primaire unique. Il est possible d&#x27;obtenir un item à partir de sa clé primaire et de le supprimer. Il y la version <strong>synchrone</strong> et <strong>asynchrone</strong>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="utilisation-du-repository---théorie">Utilisation du Repository - Théorie<a href="#utilisation-du-repository---théorie" class="hash-link" aria-label="Direct link to Utilisation du Repository - Théorie" title="Direct link to Utilisation du Repository - Théorie">​</a></h3>
<p>Pour utiliser un <strong>Repository</strong> générique, il faut l&#x27;injecter comme ceci. Voici l&#x27;exemple pour <strong>Carte</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public classe CarteService</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	private readonly IBasePKUniqueRepo&lt;Carte, int&gt; _baseRepoCarte;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	public CarteService(IBasePKUniqueRepo&lt;Carte, int&gt; baseRepoCarte)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		_baseRepoCarte = baseRepoCarte;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Par contre, si le logiciel doit obtenir les cartes qui ont plus de 10 points de vie, il faut une requête spécifique dans le <strong>Repository</strong>.</p>
<p>Il faut avoir une classe <strong>CarteRepo</strong>.</p>
<p>Il y a 2 options.</p>
<ul>
<li>
<p>Utiliser 2 <strong>Repositories</strong> par modèle de données.</p>
<p>Pour les modèles qui nécessitent des requêtes spécifiques, il serait possible d&#x27;injecter les 2 <strong>Repositories</strong> dans le <strong>Service</strong>.</p>
<p>Voici l&#x27;interface et la classe du <strong>Repository</strong> spécifique.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public interface ICarteRepo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	List&lt;Carte&gt; ObtenirListeParPointVieMin(int vie);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public classe CarteRepoICarteService</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private readonly SuperCarteContext _bd;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public CarteRepo(SuperCarteContext bd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _bd = bd;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	public List&lt;Carte&gt; ObtenirListeParPointVieMin(int vie)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return _bd.CarteTb.Where(c =&gt; c.vie &gt;= vie).ToList();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Et l&#x27;injection dans le <strong>Service</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public classe CarteService</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	private readonly IBaseRepo&lt;Carte&gt; _carteBaseRepo;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	private readonly ICarteRepo _carteSpecificRepo;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	public CarteService(IBaseRepo&lt;Carte&gt; _carteBaseRepo, ICarteRepo _carteSpecificRepo)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		_carteBaseRepo = carteBaseRepo;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		_carteSpecificRepo = carteSpecificRepo;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Hériter de <strong>BaseRepo</strong>.</p>
<p>Il y aurait seulement un <strong>Repository</strong>. Le <strong>Repository</strong> spécifique hériterait du <strong>Repository</strong> générique de base.</p>
<p>Voici l&#x27;interface et la classe du <strong>Repository</strong> spécifique.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public interface ICarteRepo : IBasePKUniqueRepo&lt;Carte,int&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	List&lt;Carte&gt; ObtenirListeParPointVieMin(int vie);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public classe CarteRepo : BasePKUniqueRepo&lt;Carte,int&gt;, ICarteService</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public CarteRepo(SuperCarteContext bd) : base(bd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	public List&lt;Carte&gt; ObtenirListeParPointVieMin(int vie)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return _bd.CarteTb.Where(c =&gt; c.vie &gt;= vie).ToList();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Et l&#x27;injection dans le <strong>Service</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public classe CarteService</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	private readonly ICarteRepo _carteRepo;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	public CarteService(ICarteRepo _carteRepo)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		_carteRepo = carteRepo;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<p>Les 2 approches ont leurs avantages et leurs inconvénients.</p>
<p>L&#x27;approche par héritage permet d&#x27;avoir un seul <strong>Repository</strong> qui contient toutes les méthodes nécessaires à l&#x27;entité. Par contre, ce n&#x27;est pas tous les <strong>Repository</strong> qui nécessitent des requêtes spécifiques. Dans une approche standardisée, il pourrait être exigé au programmeur de créer des classes spécifiques, même s&#x27;il n&#x27;y a pas de requête spécifique.</p>
<p>Dans une approche non standardisée, il faudrait injecter le <strong><code>BaseRepo&lt;TData&gt;</code></strong> dans le service lorsqu&#x27;il n&#x27;y a pas de requêtes spécifiques. Si un jour, il faut ajouter une requête spécifique, il faut créer le <strong>Repository</strong> spécifique et modifier tous les services qui utilisaient le <strong>Repository</strong> de base. Ceci peut demander beaucoup de refactorisation. Donc, si l&#x27;approche par</p>
<p>L&#x27;approche avec 2 <strong>Repositories</strong> a l&#x27;avantage de créer uniquement un <strong>Repo</strong> spécialisé lorsque nécessaire. Par contre, le programmeur doit basculer d&#x27;un <strong>Repository</strong> à l&#x27;autre selon le contexte. Aussi, à chaque fois qu&#x27;il faut injecter le <strong>Repository</strong> de base, il faut s&#x27;assurer de spécifier le type de la bonne clé primaire. Rien n&#x27;empêche également d&#x27;injecter la mauvaise classe de base, par exemple <strong><code>BaseRepo&lt;Carte&gt;</code></strong>.</p>
<p>Si l&#x27;enregistrement des services est bien fait dans l&#x27;injection des dépendances, le programme génèrera une exception lorsque la mauvaise classe de base sera utilisée. Par contre, si le programmeur l&#x27;ajoute dans l&#x27;enregistrement sans valider l&#x27;existence des autres, le programme va devenir non uniforme et moins maintenable dans le temps.</p>
<p>Principalement pour la dernière raison, l&#x27;approche par héritage sera utilisée et il faudra créer la classe et l&#x27;interface spécifique en tout temps, même si elle est vide. Le programme sera plus uniforme et plus facilement maintenable à long terme.  De plus, dans les applications d&#x27;envergure, les <strong>entités</strong> sans aucune requête spécifique sont assez rares.</p>
<p>Remarquez que les classes <strong>BaseRepo</strong> et <strong>BasePKUniqueRepo</strong> ont été déclarées dès le départ <strong><code>abstract</code></strong> pour éviter l&#x27;utilisation directe sans héritage.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="création-des-repositories-spécifiques">Création des Repositories spécifiques<a href="#création-des-repositories-spécifiques" class="hash-link" aria-label="Direct link to Création des Repositories spécifiques" title="Direct link to Création des Repositories spécifiques">​</a></h2>
<p>Il faut créer les classes spécifiques qui hériteront de la classe de base correspondante.</p>
<p>Pour l&#x27;instant, toutes les classes seront vides.</p>
<p>Toutes les classes et interfaces doivent être créées dans le dossier <strong>Repositories</strong>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rolerepo">RoleRepo<a href="#rolerepo" class="hash-link" aria-label="Direct link to RoleRepo" title="Direct link to RoleRepo">​</a></h3>
<p>Créez l&#x27;interface <strong>IRoleRepo</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.Core.Repositories.Bases;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.EF.Data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.Core.Repositories;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Interface qui contient les méthodes de communication avec la base de données pour la table Role</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface IRoleRepo : IBasePKUniqueRepo&lt;Role,int&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Créez la classe <strong>RoleRepo</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.Core.Repositories.Bases;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.EF.Data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.EF.Data.Context;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.Core.Repositories;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Classe qui contient les méthodes de communication avec la base de données pour la table Role</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class RoleRepo : BasePKUniqueRepo&lt;Role,int&gt;, IRoleRepo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Constructeur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;bd&quot;&gt;Contexte de la base de données&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public RoleRepo(SuperCarteContext bd) : base(bd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Vide, il sert uniquement a recevoir le contexte et à l&#x27;envoyer à la classe parent.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>La classe hérite de <strong><code>BasePKUniqueRepo&lt;Role,int&gt;</code></strong>, car il y a seulement une clé primaire et c&#x27;est un entier.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="utilisateurrepo">UtilisateurRepo<a href="#utilisateurrepo" class="hash-link" aria-label="Direct link to UtilisateurRepo" title="Direct link to UtilisateurRepo">​</a></h3>
<p>Créez l&#x27;interface <strong>IUtilisateurRepo</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.Core.Repositories.Bases;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.EF.Data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.Core.Repositories;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Interface qui contient les méthodes de communication avec la base de données pour la table Utilisateur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface IUtilisateurRepo : IBasePKUniqueRepo&lt;Utilisateur, int&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Créez la classe <strong>UtilisateurRepo</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.Core.Repositories.Bases;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.EF.Data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.EF.Data.Context;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.Core.Repositories;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Classe qui contient les méthodes de communication avec la base de données pour la table Utilisateur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class UtilisateurRepo : BasePKUniqueRepo&lt;Utilisateur, int&gt;, IUtilisateurRepo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Constructeur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;bd&quot;&gt;Contexte de la base de données&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public UtilisateurRepo(SuperCarteContext bd) : base(bd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Vide, il sert uniquement a recevoir le contexte et à l&#x27;envoyer à la classe parent.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>La classe hérite de <strong><code>BasePKUniqueRepo&lt;Utilisateur,int&gt;</code></strong>, car il y a seulement une clé primaire et c&#x27;est un entier.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ensemblerepo">EnsembleRepo<a href="#ensemblerepo" class="hash-link" aria-label="Direct link to EnsembleRepo" title="Direct link to EnsembleRepo">​</a></h3>
<p>Créez l&#x27;interface <strong>IEnsembleRepo</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.Core.Repositories.Bases;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.EF.Data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.Core.Repositories;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Interface qui contient les méthodes de communication avec la base de données pour la table Ensemble</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface IEnsembleRepo : IBasePKUniqueRepo&lt;Ensemble, int&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Créez la classe <strong>EnsembleRepo</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.Core.Repositories.Bases;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.EF.Data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.EF.Data.Context;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.Core.Repositories;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Classe qui contient les méthodes de communication avec la base de données pour la table Ensemble</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class EnsembleRepo : BasePKUniqueRepo&lt;Ensemble, int&gt;, IEnsembleRepo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Constructeur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;bd&quot;&gt;Contexte de la base de données&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public EnsembleRepo(SuperCarteContext bd) : base(bd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Vide, il sert uniquement a recevoir le contexte et à l&#x27;envoyer à la classe parent.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>La classe hérite de <strong><code>BasePKUniqueRepo&lt;Ensemble,int&gt;</code></strong>, car il y a seulement une clé primaire et c&#x27;est un entier.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="categorierepo">CategorieRepo<a href="#categorierepo" class="hash-link" aria-label="Direct link to CategorieRepo" title="Direct link to CategorieRepo">​</a></h3>
<p>Créez l&#x27;interface <strong>ICategorieRepo</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.Core.Repositories.Bases;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.EF.Data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.Core.Repositories;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Interface qui contient les méthodes de communication avec la base de données pour la table Categorie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface ICategorieRepo : IBasePKUniqueRepo&lt;Categorie, int&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Créez la classe <strong>CategorieRepo</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.Core.Repositories.Bases;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.EF.Data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.EF.Data.Context;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.Core.Repositories;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Classe qui contient les méthodes de communication avec la base de données pour la table Categorie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class CategorieRepo : BasePKUniqueRepo&lt;Categorie, int&gt;, ICategorieRepo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Constructeur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;bd&quot;&gt;Contexte de la base de données&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public CategorieRepo(SuperCarteContext bd) : base(bd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Vide, il sert uniquement a recevoir le contexte et à l&#x27;envoyer à la classe parent.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>La classe hérite de <strong><code>BasePKUniqueRepo&lt;Categorie,int&gt;</code></strong>, car il y a seulement une clé primaire et c&#x27;est un entier.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="carterepo">CarteRepo<a href="#carterepo" class="hash-link" aria-label="Direct link to CarteRepo" title="Direct link to CarteRepo">​</a></h3>
<p>Créez l&#x27;interface <strong>ICarteRepo</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.Core.Repositories.Bases;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.EF.Data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.Core.Repositories;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Interface qui contient les méthodes de communication avec la base de données pour la table Carte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface ICarteRepo : IBasePKUniqueRepo&lt;Carte, int&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Créez la classe <strong>CarteRepo</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.Core.Repositories.Bases;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.EF.Data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.EF.Data.Context;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.Core.Repositories;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Classe qui contient les méthodes de communication avec la base de données pour la table Carte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class CarteRepo : BasePKUniqueRepo&lt;Carte, int&gt;, ICarteRepo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Constructeur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;bd&quot;&gt;Contexte de la base de données&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public CarteRepo(SuperCarteContext bd) : base(bd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Vide, il sert uniquement a recevoir le contexte et à l&#x27;envoyer à la classe parent.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>La classe hérite de <strong><code>BasePKUniqueRepo&lt;Carte,int&gt;</code></strong>, car il y a seulement une clé primaire et c&#x27;est un entier.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="utilisateurcarterepo">UtilisateurCarteRepo<a href="#utilisateurcarterepo" class="hash-link" aria-label="Direct link to UtilisateurCarteRepo" title="Direct link to UtilisateurCarteRepo">​</a></h3>
<p>Créez l&#x27;interface <strong>IUtilisateurCarteRepoRepo</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.Core.Repositories.Bases;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.EF.Data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.Core.Repositories;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Interface qui contient les méthodes de communication avec la base de données pour la table Role</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface IUtilisateurCarteRepo : IBaseRepo&lt;UtilisateurCarte&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Créez la classe <strong>UtilisateurCarteRepoRepo</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.Core.Repositories.Bases;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.EF.Data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.EF.Data.Context;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.Core.Repositories;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Classe qui contient les méthodes de communication avec la base de données pour la table UtilisateurCarte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class UtilisateurCarteRepo : BaseRepo&lt;UtilisateurCarte&gt;, IUtilisateurCarteRepo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Constructeur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;bd&quot;&gt;Contexte de la base de données&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public UtilisateurCarteRepo(SuperCarteContext bd) : base(bd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Vide, il sert uniquement a recevoir le contexte et à l&#x27;envoyer à la classe parent.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>La classe hérite de <strong><code>BaseRepo&lt;UtilisateurCarte&gt;</code></strong>, car elle n&#x27;a pas de clé primaire unique.</p>
<h1>Préparation du projet WPF</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="création-du-projet-dans-une-solution-existante">Création du projet dans une solution existante<a href="#création-du-projet-dans-une-solution-existante" class="hash-link" aria-label="Direct link to Création du projet dans une solution existante" title="Direct link to Création du projet dans une solution existante">​</a></h2>
<p>Il faut ajouter le projet <strong>WPF</strong> dans la solution.</p>
<p>Pour ce faire, sélectionnez la solution <strong>SuperCarteApp</strong> en haut de l&#x27;<strong>Explorateur de solution</strong> et choisissez <strong>Ajouter -&gt; Nouveau projet...</strong> dans le menu contextuel.</p>
<p>Créez un projet de type <strong>Application WPF</strong>. Il est important <strong>de ne pas choisir</strong> la version <strong>.NET Framework</strong>.</p>
<ul>
<li><strong>Nom du projet</strong> : SuperCarte.WPF</li>
<li><strong>Infrastructure</strong> : .NET 7</li>
</ul>
<p>Ensuite, sélectionnez le projet <strong>SuperCarte.WPF</strong> en haut de l&#x27;<strong>Explorateur de solution</strong> et choisissez <strong>Définir en tant que projet de démarrage</strong> dans le menu contextuel.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ajout-des-dépendances-de-projet-1">Ajout des dépendances de projet<a href="#ajout-des-dépendances-de-projet-1" class="hash-link" aria-label="Direct link to Ajout des dépendances de projet" title="Direct link to Ajout des dépendances de projet">​</a></h2>
<p>Le projet <strong>SuperCarte.WPF</strong> aura besoin du projet <strong>SuperCarte.EF</strong> pour initialiser le contexte et <strong>SuperCarte.Core</strong>, car il utilisera des <strong>services</strong>.</p>
<p>Il faut l&#x27;ajouter dans les dépendances du projet.</p>
<p>Sélectionnez le dossier <strong>Dépendances</strong> du projet <strong>SuperCarte.WPF</strong> et choisissez <strong>Ajouter une référence de projet</strong> dans le menu contextuel.</p>
<p>Dans la fenêtre, il faut cocher <strong>SuperCarte.EF</strong> et <strong>SuperCarte.Core</strong>. Vous venez d&#x27;intégrer 2 librairies internes au projet.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fichier-usingscs">Fichier Usings.cs<a href="#fichier-usingscs" class="hash-link" aria-label="Direct link to Fichier Usings.cs" title="Direct link to Fichier Usings.cs">​</a></h2>
<p>Afin de réduire la taille des classes, les <strong><code>using</code></strong> qui seront beaucoup utilisés dans ce projet seront déclaré globalement.</p>
<p>Créez le fichier <strong>Usings.cs</strong> à la racine du projet <strong>SuperCarte.WPF</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">global using SuperCarte.WPF; //Les classes à la racine de l&#x27;application WPF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">global using SuperCarte.EF.Data; //Les classes du modèle du contexte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">global using SuperCarte.EF.Data.Context; // La classe du contexte</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">global using System;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">global using System.Collections.Generic;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">global using System.Threading.Tasks;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Au fur et à mesure que des classes s&#x27;ajouteront dans le projet, le fichier <strong>Usings.cs</strong> sera mis à jour.</p>
<p>Également, le fichier <strong>Usings.cs</strong> appartient uniquement au projet dans lequel il est créé.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fichier-de-configuration---appsettingsjson">Fichier de configuration - appsettings.json<a href="#fichier-de-configuration---appsettingsjson" class="hash-link" aria-label="Direct link to Fichier de configuration - appsettings.json" title="Direct link to Fichier de configuration - appsettings.json">​</a></h2>
<p>La librairie <strong>Microsoft.Extensions.Configuration.Json</strong> permet de lire un fichier de configuration en <strong>json</strong>.</p>
<p>Dans la <strong>Console du Gestionnaire de package</strong>, inscrivez cette ligne. Il est important que le <strong>Projet par défaut</strong> soit <strong>SuperCarte.WPF</strong> dans la console. La librairie s&#x27;installera dans le projet indiqué dans le champ <strong>Projet par défaut</strong>.</p>
<img src="/4N1_2024/img/13_package_console_1.png">
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Install-Package Microsoft.Extensions.Configuration.Json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Créez le fichier <strong>appsettings.json</strong> à la racine du projet <strong>SuperCarte.WPF</strong>. Prenez le modèle <strong>Fichier Texte</strong>.</p>
<p><strong>IMPORTANT</strong> : Pour que le fichier soit pris en compte par le compilateur, il faut indiquer dans ces propriétés qu&#x27;il doit être copié dans le dossier de compilation. Effectuez un <strong>clic droit</strong> sur le fichier <strong>appsettings.json</strong> et sélectionnez <strong>Propriétés</strong>. Pour le champ <strong>Copier dans le répertoire de sortie</strong>, il faut mettre la valeur <strong>Copier si plus récent</strong>.</p>
<img src="/4N1_2024/img/12_appsettings_01.png">
<p>Copiez ce code <strong>json</strong> dans le fichier.</p>
<p>Utilisez cette version si vous n&#x27;avez pas le message d&#x27;erreur du certificat <strong>SSL</strong>. Il faut également modifier le nom de la base de données pour celui que vous avez utilisé.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;ConnectionStrings&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;DefaultConnection&quot;: &quot;Server=localhost\SQLExpress;Database=eDA_4N1_SuperCarte;Trusted_Connection=True;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Utilisez cette version avec le paramètre <strong><code>Trust Server Certificate=true;</code></strong> si vous avez le message d&#x27;erreur du certificat <strong>SSL</strong>. Il faut également modifier le nom de la base de données pour celui que vous avez utilisé.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;ConnectionStrings&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;DefaultConnection&quot;: &quot;Server=localhost\SQLExpress;Database=eDA_4N1_SuperCarte;Trusted_Connection=True;Trust Server Certificate=true;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ajout-de-la-structure-pour-injection-des-dépendances">Ajout de la structure pour injection des dépendances<a href="#ajout-de-la-structure-pour-injection-des-dépendances" class="hash-link" aria-label="Direct link to Ajout de la structure pour injection des dépendances" title="Direct link to Ajout de la structure pour injection des dépendances">​</a></h2>
<p>Le projet <strong>WPF</strong> n&#x27;a pas de fichier <strong>program.cs</strong>. Ce type de projet n&#x27;est pas conçu à la base pour être dans la structure du <strong>hosting</strong> de <strong>.Net Core</strong>. Il faut donc l&#x27;adapter.</p>
<p>Le fichier de démarrage de l&#x27;application est <strong>App.xaml.cs</strong>. Il est inclus dans le fichier <strong>App.xaml</strong>.</p>
<p>Remarquez que la classe est <strong>partial</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public partial class App : Application</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Une classe partielle en <strong>.NET</strong> consiste à créer une classe dans plusieurs fichiers. Le fichier <strong>App.xaml</strong> est aussi une classe, sauf que le langage est <strong>XAML</strong>.</p>
<div class="language-xaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;Application x:Class=&quot;SuperCarte.WPF.App&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             xmlns:local=&quot;clr-namespace:SuperCarte.WPF&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             StartupUri=&quot;MainWindow.xaml&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;Application.Resources&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/Application.Resources&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/Application&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>À la ligne 1, le nom de la classe est indiqué.</p>
<p>C&#x27;est pour cette raison que le fichier <strong>App.xaml.cs</strong> est un sous-fichier de <strong>App.xaml</strong> dans l&#x27;<strong>Explorateur de solutions</strong>. Si la classe n&#x27;était pas partielle, il ne serait pas possible d&#x27;avoir 2 langages pour une même classe. La notion de classe partielle sert également à ajouter des fonctionnalités dans une classe générée automatiquement. Dans le <strong>TP 2</strong>, les classes du modèle sont <strong>partial</strong>. Il aurait été possible d&#x27;ajouter un 2e fichier interne pour ajouter des éléments à la classe de base.</p>
<p>À la ligne 5, c&#x27;est la fenêtre de démarrage. Pour une application <strong>WPF</strong>, la classe <strong>App</strong> est le conteneur des fenêtres. Une fenêtre est l&#x27;équivalent d&#x27;une page.</p>
<p>L&#x27;application <strong>WPF</strong> de ce projet sera comme un <strong>SPA</strong> ou une <strong>Application à page unique</strong>. Dans le cas d&#x27;une application native, il serait possible de dire un <strong>SWA</strong> pour une <strong>Application à fenêtre unique</strong>.</p>
<p>Les applications <strong>à fenêtres multiples</strong> sont de plus en plus rares, car de nombreux appareils ne sont pas en mesure de les gérer correctement. C&#x27;est une approche pour les systèmes d&#x27;exploitation ordinateur, comme <strong>Windows</strong> ou <strong>macOS</strong>, car ils sont en mesure de gérer le <strong>multifenêtre</strong>.</p>
<p>L&#x27;application aura seulement une seule fenêtre, le classe <strong>MainWindow.xaml</strong>. À l&#x27;intérieur de cette classe, il y aura un <strong>conteneur</strong> qui aura un <strong>contrôle utilisateur (user contrôle)</strong> qui s&#x27;occupera d&#x27;une vue spécifique. Ce conteneur changera de <strong>contrôle utilisateur</strong> lorsqu&#x27;une nouvelle vue devra être affichée. Il s&#x27;agit de la même méganique que Blazor ou Angular, mais pour une application native.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="classes-dextension-de-méthodes">Classes d&#x27;extension de méthodes<a href="#classes-dextension-de-méthodes" class="hash-link" aria-label="Direct link to Classes d&#x27;extension de méthodes" title="Direct link to Classes d&#x27;extension de méthodes">​</a></h3>
<p>Comme pour le projet de <strong>GestionPersonnage</strong>, des extensions seront utilisées pour gérer l&#x27;enregistrement des dépendances.</p>
<p>Créez les dossiers <strong>Extensions\ServiceCollections</strong> à la racine du projet <strong>SuperCarte.WPF</strong>.</p>
<p>Créez la classe <strong>SCRepositories.cs</strong> dans le dossier.</p>
<p>Les <strong>Repositories</strong> sont déjà créés, alors il faut les ajouter dans l&#x27;enregistrement. Remarquez que la création est maintenant en <strong>Scoped</strong>. L&#x27;instance du <strong>Repo</strong> sera partagée entre les différents services qui l&#x27;utilisent.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using Microsoft.Extensions.DependencyInjection;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.WPF.Extensions.ServiceCollections;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Classe d&#x27;extension qui permet d&#x27;enregistrer les classes de la catégorie Repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static class SCRepositoryExtensions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Méthode qui permet d&#x27;enregistrer les repositories de l&#x27;application</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;services&quot;&gt;La collection de services&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void EnregistrerRepositories(this IServiceCollection services)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        services.AddScoped&lt;IRoleRepo, RoleRepo&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        services.AddScoped&lt;IEnsembleRepo, EnsembleRepo&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        services.AddScoped&lt;ICategorieRepo, CategorieRepo&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        services.AddScoped&lt;IUtilisateurRepo, UtilisateurRepo&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        services.AddScoped&lt;ICarteRepo, CarteRepo&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        services.AddScoped&lt;IUtilisateurCarteRepo, UtilisateurCarteRepo&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Créez la classe <strong>SCServiceExtensions.cs</strong> dans le dossier .</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using Microsoft.Extensions.DependencyInjection;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.WPF.Extensions.ServiceCollections;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Classe d&#x27;extension qui permet d&#x27;enregistrer les classes de la catégorie Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static class SCServiceExtensions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Méthode qui permet d&#x27;enregistrer les services de l&#x27;application</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;services&quot;&gt;La collection de services&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void EnregistrerServices(this IServiceCollection services)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Créez la classe <strong>SCValidateurExtensions.cs</strong> dans le dossier . Cette classe s&#x27;occupera de l&#x27;enregistrement des <strong>Validateurs</strong>. Ce concept sera présenté dansun autre document.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using Microsoft.Extensions.DependencyInjection;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.WPF.Extensions.ServiceCollections;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Classe d&#x27;extension qui permet d&#x27;enregistrer les classes de la catégorie Validateur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static class SCValidateurExtensions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Méthode qui permet d&#x27;enregistrer les validateurs de l&#x27;application</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;services&quot;&gt;La collection de services&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void EnregistrerValidateurs(this IServiceCollection services)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Créez la classe <strong>SCViewModelExtensions.cs</strong> dans le dossier . Cette classe s&#x27;occupera de l&#x27;enregistrement des <strong>ViewModel</strong>. Ce concept sera présenté dans le prochain document.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using Microsoft.Extensions.DependencyInjection;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.WPF.Extensions.ServiceCollections;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Classe d&#x27;extension qui permet d&#x27;enregistrer les classes de la catégorie Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static class SCViewModelExtensions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Méthode qui permet d&#x27;enregistrer les ViewModels de l&#x27;application</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;services&quot;&gt;La collection de services&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void EnregistrerViewModels(this IServiceCollection services)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="création-du-host---appxamlcs">Création du Host - App.xaml.cs<a href="#création-du-host---appxamlcs" class="hash-link" aria-label="Direct link to Création du Host - App.xaml.cs" title="Direct link to Création du Host - App.xaml.cs">​</a></h3>
<p>Dans la <strong>Console du Gestionnaire de package</strong>, inscrivez cette ligne. Il est important que le <strong>Projet par défaut</strong> soit <strong>SuperCarte.WPF</strong> dans la console. La librairie s&#x27;installera dans le projet indiqué dans le champ <strong>Projet par défaut</strong>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Install-Package Microsoft.Extensions.Hosting</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Avec cette librairie, il sera possible de configurer l&#x27;application <strong>WPF</strong> avec le <strong>hosting</strong> d&#x27;application de <strong>.NET Core</strong>.</p>
<p>Copiez ce code dans le fichier <strong>App.xaml.cs</strong>.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using Microsoft.EntityFrameworkCore;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using Microsoft.Extensions.Configuration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using Microsoft.Extensions.DependencyInjection;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using Microsoft.Extensions.Hosting;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using SuperCarte.WPF.Extensions.ServiceCollections;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Windows;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace SuperCarte.WPF;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Interaction logic for App.xaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public partial class App : Application</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private IHost? _host;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	public App()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var builder = Host.CreateDefaultBuilder();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Enregistrement des services</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.ConfigureServices((context, services) =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            services.AddSingleton&lt;MainWindow&gt;(); //Fenêtre principale</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Enregistrement du contexte    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            services.AddDbContext&lt;SuperCarteContext&gt;(options =&gt; options.UseSqlServer(context.Configuration.GetConnectionString(&quot;DefaultConnection&quot;)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //Appel des méthodes d&#x27;extension                        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            services.EnregistrerRepositories();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            services.EnregistrerServices();            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            services.EnregistrerValidateurs();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            services.EnregistrerViewModels();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _host = builder.Build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Démarrage de l&#x27;application</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;e&quot;&gt;&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected override async void OnStartup(StartupEventArgs e)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        await _host!.StartAsync();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var fenetreInitiale = _host.Services.GetRequiredService&lt;MainWindow&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fenetreInitiale.Show(); //Affiche la fenêtre initiale</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        base.OnStartup(e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Fermeture de l&#x27;application</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;e&quot;&gt;&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected override async void OnExit(ExitEventArgs e)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        await _host!.StopAsync();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        base.OnExit(e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Voici le détail de la classe.</p>
<p>À la ligne 1 du bloc de code ci-dessous, il y a un attribut pour le <strong>host</strong> de l&#x27;application. Le <strong>host</strong>  doit être en attribut, car il sera utilisé dans plusieurs méthodes de la classe.</p>
<p>Ensuite, le constructeur de la classe s&#x27;occupe de configurer le <strong>host</strong> comme il a été fait dans le fichier <strong>Program.cs</strong> de l&#x27;application console.</p>
<p>À la ligne 5, le constructeur par défaut du <strong>host</strong> est créé.</p>
<p>À la ligne 10, il faut enregistrer la fenêtre principale dans les dépendances de l&#x27;application.</p>
<p>À la ligne 13, le contexte est enregistré avec le fichier de configuration.</p>
<p>Aux lignes 16 à 18, le service utilise les méthodes d&#x27;extension pour enregistrer les différents concepts.</p>
<p>À la ligne 21, le <strong>host</strong> est construit en fonction de la configuration initiale.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">private IHost? _host;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public App()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var builder = Host.CreateDefaultBuilder();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //Enregistrement des services</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    builder.ConfigureServices((context, services) =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        services.AddSingleton&lt;MainWindow&gt;(); //Fenêtre principale</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Enregistrement du contexte    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        services.AddDbContext&lt;SuperCarteContext&gt;(options =&gt; options.UseSqlServer(context.Configuration.GetConnectionString(&quot;DefaultConnection&quot;)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //Appel des méthodes d&#x27;extension                        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        services.EnregistrerRepositories();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        services.EnregistrerServices();            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        services.EnregistrerValidateurs();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        services.EnregistrerViewModels();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _host = builder.Build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>La méthode <strong><code>OnStartup()</code></strong> est appelé au démarrage de l&#x27;application, après le constructeur. Elle démarre le <strong>host</strong> et ensuite indique au programme d&#x27;afficher la fenêtre principale de l&#x27;application.</p>
<div class="language-c# codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c# codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">protected override async void OnStartup(StartupEventArgs e)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    await _host!.StartAsync();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var fenetreInitiale = _host.Services.GetRequiredService&lt;MainWindow&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fenetreInitiale.Show(); //Affiche la fenêtre initiale</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    base.OnStartup(e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Démarrez l&#x27;application. Il y a 2 fenêtres.</p>
<p>Ouvrez le fichier <strong>App.xaml</strong>.</p>
<div class="language-xaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;Application x:Class=&quot;SuperCarte.WPF.App&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             xmlns:local=&quot;clr-namespace:SuperCarte.WPF&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             StartupUri=&quot;MainWindow.xaml&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;Application.Resources&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/Application.Resources&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/Application&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>À la ligne 5, il y a la propriété <strong>StartupUri</strong>. Cette propriété indique également la fenêtre de démarrage. Il faut retirer cette propriété pour ne pas interférer avec l&#x27;injection de dépendances.</p>
<div class="language-xaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;Application x:Class=&quot;SuperCarte.WPF.App&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             xmlns:local=&quot;clr-namespace:SuperCarte.WPF&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;Application.Resources&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/Application.Resources&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/Application&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Démarrez de nouveau l&#x27;application et il aura seulement une fenêtre.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="hello-world">Hello World<a href="#hello-world" class="hash-link" aria-label="Direct link to Hello World" title="Direct link to Hello World">​</a></h2>
<p>Pour avoir un premier contenu visuel, il faut modifier le fichier <strong>MainWindows.xaml</strong>.</p>
<div class="language-xaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;Window x:Class=&quot;SuperCarte.WPF.MainWindow&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        xmlns:local=&quot;clr-namespace:SuperCarte.WPF&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mc:Ignorable=&quot;d&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Title=&quot;Super Carte App&quot; Height=&quot;450&quot; Width=&quot;800&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;Grid&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;Label Content=&quot;Hello World!!!&quot;&gt;&lt;/Label&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/Grid&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/Window&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>À la ligne 8, la propriété <strong>Title</strong> de la balise <strong><code>&lt;Window&gt;</code></strong> permet de mettre le titre de la fenêtre.</p>
<p>À la ligne 10, il y a un <strong>Label</strong> pour afficher du texte statique.  L&#x27;intérieur de la balise <strong><code>&lt;Grid&gt;</code></strong>, c&#x27;est le contenu de la fenêtre.</p>
<h1>Annexe - Remove-Migration</h1>
<p>Pour être en mesure de supprimer des migrations, il faut remettre la base de données à l&#x27;état correct.</p>
<p>Par exemple, voici 4 migrations.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CreationBD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AjoutTableUtilisateur</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AjoutTableEnsemble -- Problématique</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AjoutTableCategorie -- Correct</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Il faut remettre la base de données à un état valide. Le dernier état valide est <strong>AjoutTableUtilisateur</strong>.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Update-Database -StartupProject SuperCarte.EF -Migration AjoutTableUtilisateur</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Ensuite, il faut utiliser la commande <strong><code>Remove-Migration</code></strong>. Cette commande enlève seulement la dernière migration. Il faudra l&#x27;exécuter 2 fois pour retirer la migration problématique.</p>
<p>Pour effacer <strong>AjoutTableCategorie</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Remove-Migration -StartupProject SuperCarte.EF </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Pour effacer <strong>AjoutTableEnsemble</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Remove-Migration -StartupProject SuperCarte.EF </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Malheureusement, la partie de <strong>AjoutTableCategorie</strong> doit être effacée, même si elle est valide.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/4N1_2024/docs/03 Injection de dépendance/injection_dependance"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Injection de dépendances</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/4N1_2024/docs/planning"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">planning</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#présentation-de-lapplication" class="table-of-contents__link toc-highlight">Présentation de l&#39;application</a></li><li><a href="#structure-de-lapplication" class="table-of-contents__link toc-highlight">Structure de l&#39;application</a></li><li><a href="#concepts-présentés" class="table-of-contents__link toc-highlight">Concepts présentés</a></li><li><a href="#diagramme-entité-association" class="table-of-contents__link toc-highlight">Diagramme entité-association</a></li><li><a href="#création-du-projet---supercarteef" class="table-of-contents__link toc-highlight">Création du projet - SuperCarte.EF</a></li><li><a href="#création-du-modèle" class="table-of-contents__link toc-highlight">Création du modèle</a></li><li><a href="#création-du-contexte" class="table-of-contents__link toc-highlight">Création du contexte</a><ul><li><a href="#variable-denvironnement-migration_connection_string" class="table-of-contents__link toc-highlight">Variable d&#39;environnement <code>MIGRATION_CONNECTION_STRING</code></a></li><li><a href="#création-du-fichier-de-migration" class="table-of-contents__link toc-highlight">Création du fichier de migration</a></li><li><a href="#synchronisation-de-la-base-de-données" class="table-of-contents__link toc-highlight">Synchronisation de la base de données</a></li></ul></li><li><a href="#configuration-du-contexte---onmodelcreating" class="table-of-contents__link toc-highlight">Configuration du contexte - OnModelCreating</a><ul><li><a href="#nom-des-tables" class="table-of-contents__link toc-highlight">Nom des tables</a></li><li><a href="#créer-une-clé-primaire-composée" class="table-of-contents__link toc-highlight">Créer une clé primaire composée</a></li><li><a href="#type-des-champs---string-decimal-et-date" class="table-of-contents__link toc-highlight">Type des champs - string, decimal et date</a></li><li><a href="#ajout-dune-contrainte-dunicité" class="table-of-contents__link toc-highlight">Ajout d&#39;une contrainte d&#39;unicité</a></li></ul></li><li><a href="#mettre-on-delete-no-action-sur-les-clés-étrangères" class="table-of-contents__link toc-highlight">Mettre ON DELETE NO ACTION sur les clés étrangères</a></li><li><a href="#préparation-du-contexte" class="table-of-contents__link toc-highlight">Préparation du contexte</a></li><li><a href="#création-des-données" class="table-of-contents__link toc-highlight">Création des données</a></li><li><a href="#ajout-des-dépendances-de-projet" class="table-of-contents__link toc-highlight">Ajout des dépendances de projet</a></li><li><a href="#classe-et-méthode-générique---théorie" class="table-of-contents__link toc-highlight">Classe et méthode générique - Théorie</a></li><li><a href="#généralisation-du-contexte" class="table-of-contents__link toc-highlight">Généralisation du contexte</a><ul><li><a href="#obtenir-un-enregistrement-spécifique-par-sa-clé" class="table-of-contents__link toc-highlight">Obtenir un enregistrement spécifique par sa clé</a></li><li><a href="#utilisation-du-repository---théorie" class="table-of-contents__link toc-highlight">Utilisation du Repository - Théorie</a></li></ul></li><li><a href="#création-des-repositories-spécifiques" class="table-of-contents__link toc-highlight">Création des Repositories spécifiques</a><ul><li><a href="#rolerepo" class="table-of-contents__link toc-highlight">RoleRepo</a></li><li><a href="#utilisateurrepo" class="table-of-contents__link toc-highlight">UtilisateurRepo</a></li><li><a href="#ensemblerepo" class="table-of-contents__link toc-highlight">EnsembleRepo</a></li><li><a href="#categorierepo" class="table-of-contents__link toc-highlight">CategorieRepo</a></li><li><a href="#carterepo" class="table-of-contents__link toc-highlight">CarteRepo</a></li><li><a href="#utilisateurcarterepo" class="table-of-contents__link toc-highlight">UtilisateurCarteRepo</a></li></ul></li><li><a href="#création-du-projet-dans-une-solution-existante" class="table-of-contents__link toc-highlight">Création du projet dans une solution existante</a></li><li><a href="#ajout-des-dépendances-de-projet-1" class="table-of-contents__link toc-highlight">Ajout des dépendances de projet</a></li><li><a href="#fichier-usingscs" class="table-of-contents__link toc-highlight">Fichier Usings.cs</a></li><li><a href="#fichier-de-configuration---appsettingsjson" class="table-of-contents__link toc-highlight">Fichier de configuration - appsettings.json</a></li><li><a href="#ajout-de-la-structure-pour-injection-des-dépendances" class="table-of-contents__link toc-highlight">Ajout de la structure pour injection des dépendances</a><ul><li><a href="#classes-dextension-de-méthodes" class="table-of-contents__link toc-highlight">Classes d&#39;extension de méthodes</a></li><li><a href="#création-du-host---appxamlcs" class="table-of-contents__link toc-highlight">Création du Host - App.xaml.cs</a></li></ul></li><li><a href="#hello-world" class="table-of-contents__link toc-highlight">Hello World</a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>